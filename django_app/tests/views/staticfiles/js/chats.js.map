{"mappings":"A,C,K,I,E,W,E,C,E,E,C,E,E,E,iB,A,O,I,A,C,E,S,C,E,G,K,E,O,C,C,E,C,O,C,G,K,E,C,I,E,C,C,E,A,Q,C,C,E,C,I,E,C,G,E,Q,C,C,E,O,C,C,E,C,E,E,I,C,E,O,C,E,E,O,E,E,O,A,C,I,E,A,M,uB,E,I,O,E,I,C,mB,C,C,E,Q,C,S,C,C,C,E,C,C,E,C,C,E,E,iB,C,G,I,E,E,Q,C,E,Q,S,C,C,C,ECEA,MAAM,UAAuB,YAC3B,mBAAoB,CAClB,IAAI,CAAC,SAAS,CAAG;AAC2C,gEAAA,EACxD,IAAI,CAAC,OAAO,CAAC,aAAa,EAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAI,UACvD;AACC,QAAA,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAI;A;A;A;A;AAK9B,IAAA,CAAC,AACH,CACF,CACA,eAAe,MAAM,CAAC,kBAAmB,E,G,E,Q,S,C,C,C,ECbzC,IAAI,EAAW,OAAO,QAAW,AAE1B,OAAM,UAA0B,YAKrC,OAAO,CAAQ,CAAE,CACf,IAAI,EAAY,IAAI,EAAS,SAAS,CAAC,CACrC,qCAAsC,CAAA,EACtC,iBAAkB,EAClB,OAAQ,CAAA,CACV,EACA,CAAA,IAAI,CAAC,SAAS,CAAG,EAAU,QAAQ,CAAC,EACtC,CAEA,mBAAoB,CAClB,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,WAAW,EAAI,GAClC,CACF,CACA,eAAe,MAAM,CAAC,qBAAsB,E,G,E,Q,S,C,C,C,ECrB5C,MAAM,UAAmB,YACvB,mBAAoB,CAClB,IAAM,EAAc,UAKlB,IAAM,EAAW,MAAM,MACrB,mBAA8B,IAAI,CAAC,OAAO,CAAC,EAAE,EAAE,EAE3C,EAAc,MAAM,EAAS,IAAI,GAIvC,GAHA,IAAI,CAAC,WAAW,CAAG,EAAY,MAAM,CACrC,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,EAAY,MAAM,CAAC,WAAW,GAEhD,AAAqC,aAArC,EAAY,MAAM,CAAC,WAAW,GAAmB,CACnD,IAAM,EAAM,IAAI,YAAY,eAAgB,CAC1C,OAAQ,IAAI,AACd,GACA,SAAS,IAAI,CAAC,aAAa,CAAC,EAC9B,MACE,OAAO,UAAU,CAAC,EAfM,IAiB5B,EAEA,GACF,CACF,CACA,eAAe,MAAM,CAAC,cAAe,E,EE3BrC,OAAM,UAAuB,YAC3B,mBAAoB,CAClB,IAAM,EAAc,IAAI,CAAC,OAAO,CAAC,QAC3B,EAAmB,IAAI,CAAC,aAAa,CAAC,yBACtC,EAAiB,IAAI,CAAC,aAAa,CAAC,yBACpC,EACJ,IAAI,CAAC,aAAa,CAAC,oBAEjB,EAAoB,EAAE,CAE1B,GAAa,iBAAiB,SAAU,AAAC,QA4DjC,EA3DN,EAAI,cAAc,GAClB,IAAM,EACJ,SAAS,aAAa,CAAC,iBAEnB,EAAW,GAAc,WAC/B,GAAI,CAAC,GAAgB,CAAC,EACpB,OAGF,IAAI,EACF,SAAS,aAAa,CAAC,gBAEzB,EAAY,YAAY,CAAC,YAAa,GACtC,EAAY,YAAY,CAAC,YAAa,QACtC,GAAkB,aAAa,EAAa,GAE5C,IAAM,EAAY,CAChB,CAAC,aAAa,EAAE,EAAkB,MAAM,EAAI,KAAK,SAAS,EAAE,AAA6B,IAA7B,EAAkB,MAAM,CAAS,GAAK,IAAA,CAAK,CACvG,uBACD,AAEgC,CAAA,IAA7B,EAAkB,MAAM,EAC1B,CAAA,CAAS,CAAC,EAAE,EAAI,CAAC,EAAE,EAAE,CAAiB,CAAC,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC,AAAD,EAElD,EAAU,OAAO,CAAC,AAAC,IACjB,EAAY,WAAW,CAAC,EAAU,OACpC,GAEA,IAAI,EACF,SAAS,aAAa,CAAC,gBAEzB,EAAU,YAAY,CAAC,YAAa,MACpC,GAAkB,aAAa,EAAW,GAE1C,IAAM,EACJ,SAAS,aAAa,CAAC,kBACtB,OAAS,GAEZ,EAAU,MAAM,CACd,EACA,EAAkB,GAAG,CAAC,AAAA,GAAO,EAAI,EAAE,EACnC,EACA,EACA,IAAI,CAAC,OAAO,CAAC,SAAS,CACtB,IAAI,CAAC,OAAO,CAAC,SAAS,EAAI,GAC1B,IAAI,EAGJ,EAAU,aAAa,CAAC,qBACvB,QAGC,GACF,CAAA,EAAgB,OAAO,CAAC,MAAM,CAAG,EADnC,EAGA,EAAa,KAAK,GAKS,KAAA,KADrB,EAAgC,OAAQ,SAAS,IAIjD,EAAS,QAAQ,CAAC,UACpB,EAAU,uBAAwB,CAAE,MAAO,CAAE,MAAO,OAAQ,CAAE,GAE5D,EAAS,QAAQ,CAAC,oBACpB,EAAU,uBAAwB,CAChC,MAAO,CAAE,MAAO,iBAAkB,CACpC,GAEE,EAAS,QAAQ,CAAC,YACpB,EAAU,uBAAwB,CAAE,MAAO,CAAE,MAAO,SAAU,CAAE,GAGtE,GAEA,SAAS,IAAI,CAAC,gBAAgB,CAAC,uBAAwB,AAAC,IACtD,EAA+C,EAAK,MAAM,AAC5D,EACF,CACF,CACA,eAAe,MAAM,CAAC,kBAAmB,EC7FzC,OAAM,UAAoB,YACxB,mBAAoB,CAClB,IAAI,CAAC,OAAO,CAAC,WAAW,CAAG,MAC7B,CAKA,CAAA,CAAmB,GAEjB,IAAI,EAAqB,CAAA,EAOzB,GALA,AADiB,IAAI,CAAC,gBAAgB,CAAC,MAC9B,OAAO,CAAC,AAAC,IACY,UAAxB,EAAQ,WAAW,EACrB,CAAA,EAAqB,CAAA,CADvB,CAGF,GACI,CAAC,EAAoB,CACvB,IAAI,EACF,IAAI,CAAC,aAAa,CAAC,kCACnB,OAAO,CAAC,aAAa,CAAC,OACpB,EAAiB,GAAY,cAAc,MAC/C,GAAI,CAAC,GAAc,CAAC,EAClB,MAEF,CAAA,EAAe,WAAW,CAAG,QAC7B,IAAI,CAAC,OAAO,CAAC,EACf,CACF,CAQA,CAAA,CAAW,CAAC,CAAM,CAAE,CAAK,EACvB,IAAM,EACJ,IAAI,CAAC,aAAa,CAAC,+BACnB,OAAO,CACN,aAAa,CAAC,OACb,UAAU,CAAA,GACV,EAAmC,EAAS,aAAa,CAAC,KAC1D,EAA8C,EAAS,aAAa,CACtE,qBAQF,OANI,IACF,EAAK,WAAW,CAAG,EACnB,EAAK,YAAY,CAAC,OAAQ,CAAC,OAAO,EAAE,EAAA,CAAQ,GAElB,EAAS,OAAO,CAAC,MAAM,CAAG,EACtD,GAAiB,aAAa,cAAe,GACR,CACvC,CAOA,QAAQ,CAAM,CAAE,CAAK,CAAE,CACrB,IAAI,CAAC,CAAA,CAAmB,GACxB,IAAI,EAAO,IAAI,CAAC,aAAa,CAAC,CAAC,cAAc,EAAE,EAAO,EAAE,CAAC,GAAG,QAAQ,MAC/D,GACH,CAAA,EAAO,IAAI,CAAC,CAAA,CAAW,CAAC,EAAQ,EAAM,SAAS,CAAC,EAAG,IADrD,EAGA,IAAI,CAAC,aAAa,CAAC,OAAO,QAAQ,EACpC,CACF,CAEA,eAAe,MAAM,CAAC,eAAgB,ECtEtC,OAAM,UAAwB,YAE5B,aAAc,CACZ,KAAK,GACL,IAAI,CAAC,WAAW,CAAG,CAAA,EAEnB,IAAI,CAAC,YAAY,CAAG,IAAI,CAAC,aAAa,CAAC,yBACvC,IAAI,CAAC,QAAQ,CAAqC,IAAI,CAAC,aAAa,CAAC,yBACvE,CAEA,mBAAoB,CAEb,IAAI,CAAC,WAAW,EACnB,IAAI,CAAC,CAAA,CAAkB,GAEzB,IAAI,CAAC,WAAW,CAAG,CAAA,CACrB,CAEA,CAAA,CAAkB,CAAG,KAEnB,IAAI,CAAC,YAAY,EAAE,iBAAiB,QAAS,KACtC,IAAI,CAAC,YAAY,GAGlB,AAAoD,SAApD,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,iBACjC,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,gBAAiB,UAEhD,IAAI,CAAC,CAAA,CAAW,CAAC,KACjB,IAAI,CAAC,YAAY,CAAC,YAAY,CAAC,gBAAiB,SAEpD,GAEA,IAAI,CAAC,aAAa,CAAC,2BAA2B,iBAAiB,QAAS,KACtE,IAAI,CAAC,CAAA,CAAW,CAAC,KACjB,EAAa,KAAK,EACpB,GACA,IAAI,CAAC,aAAa,CAAC,2BAA2B,iBAAiB,QAAS,KACtE,IAAI,CAAC,YAAY,EAAE,aAAa,gBAAiB,SACjD,IAAI,CAAC,CAAA,CAAoB,CAAC,CAAA,EAC5B,GAEA,IAAI,EAAiD,IAAI,CAAC,aAAa,CAAC,kCACxE,EAAa,gBAAgB,CAAC,QAAS,UACrC,EAAa,QAAQ,CAAG,CAAA,EACxB,IAAI,CAAC,CAAA,CAAW,GAEhB,IAAI,EAAW,IAAI,CAAC,OAAO,CAAC,MACxB,GAAU,mBAC6B,EAAS,kBAAkB,CAAC,aAAa,CAAC,2BAA4B,QACtG,GAAU,uBACsB,EAAS,sBAAsB,CAAC,aAAa,CAAC,2BAA4B,QAE1E,SAAS,aAAa,CAAC,qBAAsB,OAE1F,GACA,IAAI,CAAC,aAAa,CAAC,kCAAkC,iBAAiB,QAAS,KAC7E,IAAI,CAAC,YAAY,EAAE,aAAa,gBAAiB,SACjD,IAAI,CAAC,YAAY,EAAE,OACrB,GAEA,IAAI,EAAiB,IAAI,CAAC,aAAa,CAAC,SACnC,IAGL,EAAe,gBAAgB,CAAC,SAAU,KACxC,GAAI,CAAC,EACH,MAAO,CAAA,EAET,IAAI,CAAC,CAAA,CAAoB,CAAC,CAAA,GAC1B,IAAI,CAAC,CAAA,CAAgB,CAAC,EAAe,KAAK,CAAE,CAAA,EAC9C,GACA,EAAe,gBAAgB,CAAC,OAAQ,KACtC,IAAI,CAAC,CAAA,CAAoB,CAAC,CAAA,EAC5B,GACA,EAAe,gBAAgB,CAAC,UAAW,AAAC,IAC1C,GAAI,CAAC,EACH,MAAO,CAAA,EAET,OAAsC,EAAK,GAAG,EAC5C,IAAK,SAGH,OAFA,EAAe,KAAK,CAAG,IAAI,CAAC,OAAO,CAAC,KAAK,EAAI,GAC7C,IAAI,CAAC,CAAA,CAAoB,CAAC,CAAA,GACnB,CAAA,CACT,KAAK,QAIH,OAHA,EAAI,cAAc,GAClB,IAAI,CAAC,CAAA,CAAgB,CAAC,EAAe,KAAK,CAAE,CAAA,GAC5C,IAAI,CAAC,CAAA,CAAoB,CAAC,CAAA,GACnB,CAAA,CACT,SACE,MAAO,CAAA,CACX,CACF,GAEA,SAAS,gBAAgB,CAAC,oBAAqB,AAAC,IAC9C,IAAI,EAAiC,EAAK,MAAM,AACzB,CAAA,sBAAnB,EAAQ,MAAM,EAA4B,EAAQ,UAAU,GAAK,IAAI,CAAC,OAAO,CAAC,MAAM,GACtF,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAG,EAAQ,KAAK,CACzC,IAAI,CAAC,CAAA,CAAgB,CAAC,EAAQ,KAAK,CAAE,CAAA,GAEzC,GAEF,CAAE,AAKF,EAAA,CAAW,CAAG,AAAC,IAGb,AADY,IAAI,CAAC,gBAAgB,CAAC,eAC5B,OAAO,CAAC,CAAC,EAAM,KACf,EAAK,OAAO,CAAC,IAAI,GAAK,EACxB,EAAK,KAAK,CAAC,OAAO,CAAG,QAErB,EAAK,KAAK,CAAC,OAAO,CAAG,MAEzB,EACF,CAAE,AAEF,EAAA,CAAW,CAAG,UACZ,IAAM,EAEF,SAAS,aAAa,CAAC,iCACxB,OAAS,EACZ,OAAM,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,YAAY,CAAC,CAAE,CACrD,OAAQ,OACR,QAAS,CAAC,eAAgB,mBAAoB,cAAe,CAAS,CAC1E,GACI,AAA+B,SAA/B,IAAI,CAAC,OAAO,CAAC,aAAa,CAC5B,OAAO,QAAQ,CAAC,IAAI,CAAG,SAEvB,IAAI,CAAC,OAAO,CAAC,OAAO,QAExB,CAAE,AAKF,EAAA,CAAoB,CAAG,AAAC,IACtB,IAAI,EAA4C,IAAI,CAAC,aAAa,CAAC,gCAC/D,EAAkD,EAAc,aAAa,CAAC,SAC9E,GACF,EAAe,KAAK,CAAG,IAAI,CAAC,QAAQ,CAAC,WAAW,EAAI,GACpD,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAG,OAC9B,EAAc,KAAK,CAAC,OAAO,CAAG,QAC9B,GAAgB,UAEhB,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAG,EAAe,KAAK,CAChD,EAAc,KAAK,CAAC,OAAO,CAAG,OAC9B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,OAAO,CAAG,QAC9B,IAAI,CAAC,YAAY,EAAE,QAEvB,CAAE,AAMF,EAAA,CAAgB,CAAG,CAAC,EAAU,KAC5B,IAAM,EAEJ,SAAS,aAAa,CAAC,iCACtB,OAAS,GAMZ,GALA,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,OAAO,CAAC,CAAE,CAC3C,OAAQ,OACR,QAAS,CAAC,eAAgB,mBAAoB,cAAe,CAAS,EACtE,KAAM,KAAK,SAAS,CAAC,CAAC,KAAM,CAAQ,EACtC,GACI,EAAgB,CAClB,IAAM,EAAuB,IAAI,YAAY,oBAAqB,CAChE,OAAQ,CACN,MAAO,EACP,WAAY,IAAI,CAAC,OAAO,CAAC,MAAM,CAC/B,OAAQ,mBACV,CACF,GACA,SAAS,aAAa,CAAC,EACzB,CACF,CAAE,AAEJ,CAEA,eAAe,MAAM,CAAC,oBAAqB,G,E,SC9K3C,IAAM,EAAuB,AAAC,IAC5B,IAAI,EAAgC,OAAQ,SAAS,AAC5B,MAAA,IAAd,GACT,EAAU,sBAGZ,IAAI,EAA8D,EAAI,MAAM,CACxE,GAAe,WAAa,YAC9B,CAAA,EAAgB,GAAe,QAAQ,WADzC,EAGA,GAAe,oBAAoB,YAAa,EAClD,EAIE,AADiB,SAAS,gBAAgB,CAAC,YAClC,OAAO,CAAC,AAAC,IAChB,EAAQ,gBAAgB,CAAC,YAAa,EACxC,EAIK,OAAM,UAAoB,YAC/B,aAAc,CACZ,KAAK,GACL,IAAI,CAAC,kBAAkB,CAAG,CAAA,EAC1B,IAAI,CAAC,sBAAsB,CAAG,CAAA,CAChC,CAEA,mBAAoB,CAClB,IAAM,EAAO,OAAO,UAAU,EAC9B,CAAA,IAAI,CAAC,SAAS,CAAG;AACwD,6EAAA,EAC/D,IAAI,CAAC,OAAO,CAAC,IAAI,CAClB;A;AAE0C,uDAAA,EACjC,AAAsB,OAAtB,IAAI,CAAC,OAAO,CAAC,IAAI,CAAY,SAAW,MACzC;A;AAE6C,kEAAA,EAChD,IAAI,CAAC,OAAO,CAAC,IAAI,EAAI,GACtB;AACD,gBAAA,EACE,AAAC,IAAI,CAAC,OAAO,CAAC,IAAI,CAKd,GAJA;A;A;AAGF,oBAAA,CAAC;AAGkB,uCAAA,EAAE,EAAK;AACwI,sLAAA,EAAE,EAAK;A;AAEjG,4FAAA,EAAE,EAAK;A;A;A;A;A;A;A;AAQ3F,QAAA,CAAC,CAGL,IAAI,CAAC,kBAAkB,CAAG,CAAA,EAC1B,IAAI,CAAC,cAAc,CAAC,CAAE,MAAO,KAAM,GAGnC,IAAM,EACJ,SAAS,aAAa,CAAC,2BAEnB,EAAa,SAAS,UAAU,CAAC,EAAc,OAAO,CAAE,CAAA,GAE9D,IAAI,CAAC,aAAa,CAAC,6BAA6B,YAAY,GAC5D,IAAI,CAAC,aAAa,CAAC,aAAa,iBAC9B,YACA,EAEJ,CAEA,CAAA,CAAa,CAAG,AAAC,IAEf,AADgB,IAAI,CAAC,gBAAgB,CAAC,6BAC5B,OAAO,CAAC,CAAC,EAAU,KAC3B,IAAM,EAAe,EAAS,YAAY,CAAC,aACtC,GAAiB,IAAI,CAAC,iBAAiB,EAQ5C,CAAA,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAG,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAAC,OAAO,CAAC,EAAc,CAAA,EAAG,EAAa,mCAAmC,EAAE,EAAS,EAAE,CAAC,uBAAuB,EAAE,EAAgB,EAAE,EAAE,EAAE,EAAgB,EAAE,IAAI,CAAC,CAAA,CACnO,EACF,CAAE,AAOF,CAAA,YAAc,CAAC,EAAS,KACtB,IAAI,EAAkB,SAAS,aAAa,CAAC,KAC7C,EAAgB,SAAS,CAAC,GAAG,CAAC,cAAe,CAAC,aAAa,EAAE,EAAA,CAAM,EACnE,EAAgB,WAAW,CAAG,EAC9B,IAAI,CAAC,YAAY,CAAC,EAAiB,IAAI,CAAC,aAAa,CAAC,oBACxD,CAAE,AAYF,CAAA,OAAS,CACP,EACA,EACA,EACA,EACA,EACA,EACA,KAGA,IAAI,EAAiB,CAAA,EACrB,OAAO,gBAAgB,CAAC,SAAU,AAAC,IACjC,GAAI,IAAI,CAAC,kBAAkB,CAAE,CAC3B,IAAI,CAAC,kBAAkB,CAAG,CAAA,EAC1B,MACF,CACA,EAAiB,CAAA,CACnB,GAEA,IAAI,CAAC,iBAAiB,CACpB,IAAI,CAAC,aAAa,CAAC,sBAErB,IAAI,EACF,IAAI,CAAC,aAAa,CAAC,gBAGjB,EAAoB,IAAI,CAAC,aAAa,CAAC,oBACvC,EACF,IAAI,CAAC,aAAa,CAAC,wBAEjB,EAAmB,IAAI,CAAC,aAAa,CAAC,wBACtC,EAAY,IAAI,UAAU,GAC1B,EAAkB,GAGhB,EAAgB,KACpB,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,UACtB,EAAU,KAAK,EACjB,EACA,IAAI,CAAC,gBAAgB,CAAC,UAAW,AAAC,IAChB,WAAZ,EAAI,GAAG,EAAiB,AAAwB,cAAxB,IAAI,CAAC,OAAO,CAAC,MAAM,EAC7C,GAEJ,GACA,SAAS,gBAAgB,CAAC,iBAAkB,GAE5C,EAAU,MAAM,CAAG,AAAC,IAClB,EAAU,IAAI,CACZ,KAAK,SAAS,CAAC,CACb,QAAS,EACT,UAAW,EACX,cAAe,EACf,WAAY,EACZ,IAAK,CACP,IAEF,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,YACtB,IAAM,EAAyB,IAAI,YAAY,uBAC/C,SAAS,aAAa,CAAC,EACzB,EAEA,EAAU,OAAO,CAAG,AAAC,IACd,IAAI,CAAC,iBAAiB,GAG3B,IAAI,CAAC,iBAAiB,CAAC,SAAS,CAC9B,8DACF,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,QACxB,EAEA,EAAU,OAAO,CAAG,AAAC,IACnB,EAAgB,KAAK,CAAC,OAAO,CAAG,OAC5B,GACF,CAAA,EAAiB,WAAW,CAAG,mBADjC,EAG4B,YAAxB,IAAI,CAAC,OAAO,CAAC,MAAM,EACrB,CAAA,IAAI,CAAC,OAAO,CAAC,MAAM,CAAG,UADxB,EAGA,IAAM,EAAqB,IAAI,YAAY,kBAC3C,SAAS,aAAa,CAAC,EACzB,EAEA,EAAU,SAAS,CAAG,AAAC,IACrB,IAAI,EACJ,GAAI,CACF,EAAW,KAAK,KAAK,CAAC,EAAM,IAAI,CAClC,CAAE,MAAO,EAAK,CACZ,QAAQ,GAAG,CAAC,8BAA+B,EAC7C,CAEA,GAAI,AAAkB,SAAlB,EAAS,IAAI,CACf,GAAmB,EAAS,IAAI,CAChC,IAAI,CAAC,iBAAiB,EAAE,OAAO,QAC1B,GAAI,AAAkB,eAAlB,EAAS,IAAI,CACtB,EAAkB,OAAO,CAAC,SAAS,CAAG,EAAS,IAAI,MAC9C,GAAI,AAAkB,WAAlB,EAAS,IAAI,CACtB,EAAiB,GAAG,CAClB,EAAS,IAAI,CAAC,SAAS,CACvB,EAAS,IAAI,CAAC,GAAG,CACjB,EAAS,IAAI,CAAC,cAAc,OAEzB,GAAI,AAAkB,UAAlB,EAAS,IAAI,CAAc,CACpC,IAAI,EAAQ,IAAI,CAAC,aAAa,CAAC,2BAC3B,EAAY,GAAO,cAAc,gCACjC,GAAS,IACX,EAAU,WAAW,CAAG,EAAS,IAAI,CACrC,EAAM,eAAe,CAAC,WAIxB,IAAI,EAAgC,OAAQ,SAAS,AAC5B,MAAA,IAAd,GAA8B,IAAI,CAAC,sBAAsB,GAClE,EAAU,qBAAsB,CAAE,MAAO,CAAE,MAAO,EAAS,IAAI,AAAC,CAAE,GAClE,IAAI,CAAC,sBAAsB,CAAG,CAAA,EAElC,MAAO,GAAI,AAAkB,aAAlB,EAAS,IAAI,CACtB,IAAI,CAAC,WAAW,CAAC,EAAS,IAAI,CAAE,WAC3B,GAAI,AAAkB,QAAlB,EAAS,IAAI,CAAY,CAClC,EAAiB,aAAa,CAAC,EAAS,IAAI,CAAC,UAAU,EACvD,GAAmB,aAAa,EAAS,IAAI,CAAC,UAAU,EACxD,IAAI,CAAC,CAAA,CAAa,CAAC,GACnB,IAAM,EAAuB,IAAI,YAAY,oBAAqB,CAChE,OAAQ,CACN,MAAO,EAAS,IAAI,CAAC,KAAK,CAC1B,WAAY,EAAS,IAAI,CAAC,UAAU,AACtC,CACF,GACA,SAAS,aAAa,CAAC,EACzB,MAAO,GAAI,AAAkB,UAAlB,EAAS,IAAI,CAAc,CACpC,IAAI,CAAC,aAAa,CAAC,+BAA+B,gBAChD,UAEF,IAAI,EAAwB,IAAI,CAAC,aAAa,CAAC,uCAC3C,GACF,CAAA,EAAsB,SAAS,CAAG,EAAS,IAAI,AAAJ,CAE/C,CAIA,GAAI,CAAC,EAAgB,CAEnB,IAAM,EAAU,IAAI,CAAC,qBAAqB,GACpC,EAAiB,EAAQ,GAAG,CAAK,CAAA,EAAQ,MAAM,CAAK,CAAA,IAAI,CAAC,cAAc,EAAI,EAAQ,MAAK,AAAL,CAAK,CAC9F,CAAA,IAAI,CAAC,cAAc,CAAG,EAAQ,MAAM,CAChC,EAJiB,IAKnB,IAAI,CAAC,kBAAkB,CAAG,CAAA,EAC1B,IAAI,CAAC,cAAc,CAAC,CAAE,MAAO,KAAM,KAEnC,EAAiB,CAAA,EACjB,IAAI,CAAC,cAAc,GACnB,OAAO,QAAQ,CAAC,EAAG,KAGvB,CACF,CACF,CAAE,AACJ,CACA,eAAe,MAAM,CAAC,eAAgB,EC3R/B,OAAM,UAAkB,YAC3B,mBAAoB,CAChB,IAAI,CAAC,SAAS,CAAG;A;A;AAGT,gBAAA,EACI,IAAI,CAAC,OAAO,CAAC,KAAK,CACZ;AAC0C,oEAAA,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;AACzE,gBAAA,CAAC,CACS;A;AAEV,gBAAA,CAAC;A;A;A;A;A;A;A;A;A;A;A;A;AAcuE,wFAAA,EACpE,IAAI,CAAC,OAAO,CAAC,WAAW,CAC3B,SAAS,EAAE,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC;A;AAEvC,QAAA,CAAC,CAED,IAAI,CAAC,gBAAgB,CAAG,IAAI,CAAC,aAAa,CACtC,kCAEJ,IAAI,CAAC,aAAa,CAAG,IAAI,CAAC,aAAa,CAAC,+BAExC,IAAI,CAAC,UAAU,CAAG,IAAI,CAAC,aAAa,CAAC,yBAErC,IAAI,CAAC,KAAK,CAAG,IAAI,CAAC,aAAa,CAAC,sBAChC,IAAI,CAAC,OAAO,CAAG,IAAI,CAAC,aAAa,CAAC,wBAElC,IAAI,CAAC,UAAU,EAAE,iBAAiB,QAAS,IAAI,CAAC,QAAQ,EACxD,IAAI,CAAC,OAAO,EAAE,iBAAiB,QAAS,IAAI,CAAC,QAAQ,EACrD,IAAI,CAAC,KAAK,EAAE,iBAAiB,UAAW,AAAC,IACrC,GAAI,CAAC,IAAI,CAAC,KAAK,CACX,MAAO,CAAA,EAEX,OAAsC,EAAG,GAAG,EACxC,IAAK,SAGD,OAFA,IAAI,CAAC,KAAK,CAAC,KAAK,CAAG,IAAI,CAAC,OAAO,CAAC,KAAK,EAAI,GACzC,IAAI,CAAC,QAAQ,GACN,CAAA,CACX,KAAK,QAGD,OAFA,EAAE,cAAc,GAChB,IAAI,CAAC,MAAM,CAAC,CAAA,GACL,CAAA,CACX,SACI,MAAO,CAAA,CACf,CACJ,GACA,IAAI,CAAC,KAAK,EAAE,iBAAiB,SAAU,AAAC,IACpC,IAAI,CAAC,MAAM,CAAC,CAAA,EAChB,GACA,IAAI,CAAC,KAAK,EAAE,iBAAiB,OAAQ,AAAC,IAClC,IAAI,CAAC,MAAM,CAAC,CAAA,EAChB,GAEK,IAAI,CAAC,OAAO,CAAC,SAAS,EACvB,SAAS,gBAAgB,CAAC,oBAAqB,IAAI,CAAC,CAAA,CAAgB,EAGxE,SAAS,gBAAgB,CAAC,oBAAqB,AAAC,IAC5C,IAAI,EAAiC,EAAK,MAAM,AACzB,CAAA,eAAnB,EAAQ,MAAM,EAAqB,EAAQ,UAAU,GAAK,IAAI,CAAC,OAAO,CAAC,SAAS,GAC5E,IAAI,CAAC,KAAK,EACV,CAAA,IAAI,CAAC,KAAK,CAAC,KAAK,CAAG,EAAQ,KAAK,AAAL,EAE/B,IAAI,CAAC,MAAM,CAAC,CAAA,GAEpB,EAEJ,CAEA,SAAW,KACP,IAAI,CAAC,gBAAgB,EAAE,aAAa,SAAU,IAC9C,IAAI,CAAC,aAAa,EAAE,gBAAgB,UACpC,IAAI,CAAC,KAAK,EAAE,OAChB,CAAE,AAEF,CAAA,SAAW,KACP,IAAI,CAAC,gBAAgB,EAAE,gBAAgB,UACvC,IAAI,CAAC,aAAa,EAAE,aAAa,SAAU,IAC3C,IAAI,CAAC,UAAU,EAAE,OACrB,CAAE,AAEF,EAAA,CAAgB,CAAG,AAAC,IAChB,IAAI,CAAC,OAAO,CAAC,KAAK,CAAG,EAAE,MAAM,CAAC,KAAK,CACnC,IAAI,CAAC,OAAO,CAAC,SAAS,CAAG,EAAE,MAAM,CAAC,UAAU,CAC5C,SAAS,mBAAmB,CAAC,oBAAqB,IAAI,CAAC,CAAA,CAAgB,EACnE,IAAI,CAAC,KAAK,EAAI,IAAI,CAAC,OAAO,GAC1B,IAAI,CAAC,KAAK,CAAC,KAAK,CAAG,EAAE,MAAM,CAAC,KAAK,CACjC,IAAI,CAAC,OAAO,CAAC,WAAW,CAAG,CAAA,EAAG,EAAE,MAAM,CAAC,KAAK,CAAA,CAAE,CAC9C,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,MAAM,CAAC,yBAC9B,OAAO,QAAQ,CAAC,EAAG,IAAI,CAAC,OAAO,CAAC,qBAAqB,GAAG,MAAM,EAEtE,CAAE,AAKF,CAAA,OAAS,AAAC,IACN,IAAM,EAAW,IAAI,CAAC,KAAK,EAAE,MAO7B,GANA,IAAI,CAAC,IAAI,CAAC,GACV,IAAI,CAAC,OAAO,CAAC,KAAK,CAAG,EACjB,IAAI,CAAC,OAAO,EACZ,CAAA,IAAI,CAAC,OAAO,CAAC,WAAW,CAAG,GAAY,EAD3C,EAGA,IAAI,CAAC,QAAQ,GACT,EAAgB,CAChB,IAAM,EAAuB,IAAI,YAAY,oBAAqB,CAC9D,OAAQ,CACJ,MAAO,EACP,WAAY,IAAI,CAAC,OAAO,CAAC,SAAS,CAClC,OAAQ,YACZ,CACJ,GACA,SAAS,aAAa,CAAC,EAC3B,CACJ,CAAE,AAEF,CAAA,KAAO,AAAC,IACJ,IAAM,EAEF,SAAS,aAAa,CAAC,iCACxB,OAAS,GACZ,MAAM,CAAC,MAAM,EAAE,IAAI,CAAC,OAAO,CAAC,SAAS,CAAC,OAAO,CAAC,CAAE,CAC5C,OAAQ,OACR,QAAS,CAAC,eAAgB,mBAAoB,cAAe,CAAS,EACtE,KAAM,KAAK,SAAS,CAAC,CAAC,KAAM,CAAQ,EACxC,EACJ,CAAE,AACN,CAEA,eAAe,MAAM,CAAC,aAAc,EChJpC,OAAM,UAAiB,YACrB,mBAAoB,CAClB,IAAI,CAAC,SAAS,CAAG;A;A;A;A;A;A;A;AAQjB,IAAA,CAAC,CAED,IAAM,EAAa,CAAC,EAAM,KACxB,SAAS,EAAS,CAAG,EACnB,EAAI,aAAa,CAAC,OAAO,CAAC,YAAa,GACvC,EAAI,aAAa,CAAC,OAAO,CAAC,aAAc,GACxC,EAAI,cAAc,EACpB,CACA,SAAS,gBAAgB,CAAC,OAAQ,GAClC,SAAS,WAAW,CAAC,QACrB,SAAS,mBAAmB,CAAC,OAAQ,EACvC,EAEA,IAAI,CAAC,aAAa,CAAC,WAAW,iBAAiB,QAAS,KACtD,IAAM,EAAS,IAAI,CAAC,OAAO,CAAC,qBAAqB,cAC/C,0BAEF,EAAW,GAAQ,UAAW,GAAQ,UACxC,EACF,CACF,CACA,eAAe,MAAM,CAAC,YAAa,EC/BnC,OAAM,UAAyB,YAC7B,mBAAoB,CAClB,IAAM,EACJ,IAAI,CAAC,gBAAgB,CAAC,0BAGlB,EAAuB,KAC3B,IAAI,EAAoB,EAAE,CAC1B,EAAU,OAAO,CAAC,AAAC,IACb,EAAS,OAAO,EAClB,EAAkB,IAAI,CAAC,CACrB,GAAI,EAAS,KAAK,CAClB,KAAM,IAAI,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE,EAAS,EAAE,CAAC,EAAE,CAAC,GAAG,WACtD,EAEJ,GACA,IAAM,EAAM,IAAI,YAAY,uBAAwB,CAClD,OAAQ,CACV,GACA,SAAS,IAAI,CAAC,aAAa,CAAC,EAC9B,EAGA,IAGA,EAAU,OAAO,CAAC,AAAC,IACjB,EAAS,gBAAgB,CAAC,SAAU,EACtC,GAGA,SAAS,IAAI,CAAC,gBAAgB,CAAC,eAAgB,AAAC,IAC9C,IAAM,EAA0C,EAAK,MAAM,CAAC,OAAO,CACjE,2BAEF,EAAa,aAAa,CAAC,eAAe,MAAM,GAChD,IAAI,CAAC,aAAa,CAAC,sBAAsB,YAAY,EACvD,EACF,CACF,CACA,eAAe,MAAM,CAAC,oBAAqB,ECxC3C,OAAM,UAAwB,YAC5B,aAAa,CAAS,CAAE,CACtB,IAAI,EAAgB,CAClB,OAAQ,EACR,KAAM,GACN,MAA+B,EAAE,AACnC,EAEM,EAAW;A;A;A;AAIjB,IAAA,CAAC,AAED,CAAA,IAAI,CAAC,SAAS,CAAG;A;A;A;A;A;AAMD,oBAAA,EAAE;A;A;A;AAIF,oBAAA,EAAE;A;A;A;AAIF,oBAAA,EAAE;A;A;A;AAIF,oBAAA,EAAE;A;A;A;AAIF,oBAAA,EAAE;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;AAkB+D,qFAAA,EAAE,EAAU;AACrB,4EAAA,EAAE,EAAU;AACH,qFAAA,EAAE,EAAU;AACrB,4EAAA,EAAE,EAAU;AACH,qFAAA,EAAE,EAAU;AACrB,4EAAA,EAAE,EAAU;A;A;A;A;A;AAMH,qFAAA,EAAE,EAAU;AACrB,4EAAA,EAAE,EAAU;AACH,qFAAA,EAAE,EAAU;AACrB,4EAAA,EAAE,EAAU;AACH,qFAAA,EAAE,EAAU;AACrB,4EAAA,EAAE,EAAU;A;A;AAG3D,6BAAA,EAAE,EAAU;AACmB,4DAAA,EAAE,EAAU;A;A;A;A;A;A;AAOpE,IAAA,CAAC,CAKD,IAAM,EAAe,MAAO,EAAQ,CAAC,IAGnC,IAAM,EAEF,SAAS,aAAa,CAAC,iCACtB,OAAS,GACd,GAAI,CACF,MAAM,MAAM,CAAC,SAAS,EAAE,EAAU,CAAC,CAAC,CAAE,CACpC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAe,CACjB,EACA,KAAM,KAAK,SAAS,CAAC,EACvB,EACF,CAAE,MAAO,EAAK,CACR,EAhBc,IAiBhB,OAAO,UAAU,CAAC,KAChB,EAAa,EAAQ,EACvB,EAAG,IAEP,CACF,EAKM,EAAY,AAAC,IAEjB,IAAI,EAAS,IAAI,CAAC,gBAAgB,CAAC,wBACnC,EAAO,OAAO,CAAC,AAAC,IACd,EAAM,YAAY,CAAC,SAAU,GAC/B,GACA,CAAM,CAAC,EAAW,CAAC,eAAe,CAAC,UACnC,CAAM,CAAC,EAAW,CAAC,KAAK,GACpB,EAAc,MAAM,EAAI,GAC1B,CAAM,CAAC,EAAW,CAAC,SAAS,CAAC,MAAM,CAAC,iCACpC,CAAM,CAAC,EAAW,CAAC,SAAS,CAAC,GAAG,CAAC,mCAEjC,CAAM,CAAC,EAAW,CAAC,SAAS,CAAC,GAAG,CAAC,iCACjC,CAAM,CAAC,EAAW,CAAC,SAAS,CAAC,MAAM,CAAC,iCAExC,EAGI,EACF,IAAI,CAAC,gBAAgB,CAAC,0BAExB,EAAY,OAAO,CAAC,CAAC,EAAY,KAC/B,EAAW,gBAAgB,CAAC,QAAS,KACnC,EAAc,MAAM,CAAG,SAAS,EAAW,OAAO,CAAC,MAAM,EAAI,KAC7D,IACA,EAAU,EACZ,GACA,EAAW,gBAAgB,CAAC,YAAa,KACvC,EAAY,OAAO,CAAC,AAAC,IACnB,EAAI,SAAS,CAAC,MAAM,CAAC,+BACvB,GACA,IAAK,IAAI,EAAI,EAAG,GAAK,EAAa,IAChC,CAAW,CAAC,EAAE,CAAC,SAAS,CAAC,GAAG,CAAC,+BAEjC,GACA,EAAW,gBAAgB,CAAC,aAAc,KACxC,EAAY,OAAO,CAAC,AAAC,IACnB,EAAI,SAAS,CAAC,MAAM,CAAC,+BACvB,EACF,EACF,GAGA,IAAI,CAAC,aAAa,CAAC,oCAAoC,iBACrD,QACA,KACE,EAAU,EACZ,GAKF,IAAM,EAAY,IAAI,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE,EAAA,CAAW,EACzD,IAAI,CAAC,aAAa,CAAC,0BAA0B,iBAC3C,QACA,AAAC,IACC,EAAI,cAAc,GAGlB,AADY,IAAI,CAAC,gBAAgB,CAAC,mBAC5B,OAAO,CAAC,AAAC,IACb,GAAI,EAAK,OAAO,CAAE,CAChB,IAAM,EAAO,IAAI,CAAC,aAAa,CAAC,CAAC,MAAM,EAAE,EAAK,EAAE,CAAC,EAAE,CAAC,GAAG,YACnD,GACF,EAAc,KAAK,CAAC,IAAI,CAAC,EAE7B,CACF,GACA,EAAc,IAAI,CAAG,GAAW,OAAS,GACzC,IACA,EAAU,EACZ,GAEF,GAAW,iBAAiB,QAAS,KACnC,EAAU,KAAK,CAAC,MAAM,CAAG,OACzB,EAAU,KAAK,CAAC,MAAM,CAAG,CAAA,EAAG,EAAU,YAAY,CAAC,EAAE,CAAC,AACxD,GAGA,IAAI,CAAC,aAAa,CAAC,8BAA8B,iBAC/C,QACA,KACE,EAAU,EACZ,EAEJ,CAGA,mBAAoB,CACd,IAAI,CAAC,OAAO,CAAC,EAAE,EACjB,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC,OAAO,CAAC,EAAE,CAErC,CACF,CACA,eAAe,MAAM,CAAC,mBAAoB,G,E,QC/M1C,OAAM,UAAqB,YAEvB,aAAc,CACV,KAAK,GACL,IAAI,CAAC,QAAQ,CAAG,IAAI,CAAC,aAAa,CAAC,WACvC,CAEA,mBAAoB,CAEX,IAAI,CAAC,QAAQ,GAKlB,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,WAAY,AAAC,IACxB,UAAZ,EAAI,GAAG,EAAgB,CAAC,EAAI,QAAQ,EAAI,IAAI,CAAC,QAAQ,GACrD,EAAI,cAAc,GACd,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,IACxB,IAAI,CAAC,OAAO,CAAC,SAAS,gBAGlC,GAGA,IAAI,CAAC,QAAQ,CAAC,gBAAgB,CAAC,QAAS,KACpC,IAAI,CAAC,CAAA,CAAa,EACtB,GAEJ,CAEA,CAAA,CAAa,CAAG,KACP,IAAI,CAAC,QAAQ,GAGlB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAG,OAC7B,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAC,MAAM,CAAG,CAAA,EAAG,IAAI,CAAC,QAAQ,CAAC,YAAY,CAAC,EAAE,CAAC,CAClE,CAAE,AAMF,CAAA,SAAW,IACA,IAAI,CAAC,aAAa,CAAC,aAAa,MAAM,QAAU,EAC1D,AAKD,CAAA,MAAQ,KACC,IAAI,CAAC,QAAQ,GAGlB,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAG,GACtB,IAAI,CAAC,CAAA,CAAa,GACtB,CAAC,AAEL,CACA,eAAe,MAAM,CAAC,gBAAiB,EC1DvC,OAAM,UAAoB,YACxB,aAAc,CACZ,KAAK,GACL,IAAI,CAAC,OAAO,CAAG,EAAE,AACnB,CAQA,IAAM,CAAC,EAAU,EAAK,KAGpB,GAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,AAAC,GAAW,EAAO,QAAQ,GAAK,GACpD,OAGF,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,CAChB,SAAU,EACV,IAAK,EACL,aAAc,CAChB,GAEA,IAAI,EAAO;A;A;A;AAIP,QAAA,CAAC,CACL,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,AAAC,IACpB,GAAQ;A;AAEiE,+EAAA,EAAE,EAAO,GAAG,CAAC,eAAe,EAAE,IAAI,CAAC,YAAY,CAAC,WAAW,CAAC,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,aAAa,EAAE,EAAO,YAAY,CAAC,EAAE,EAAE,EAAO,QAAQ,EAAI,EAAO,GAAG,CAAC;A;AAE1N,YAAA,CAAC,AACT,GACA,GAAQ,cAER,IAAI,CAAC,SAAS,CAAG,CACnB,CAAE,AAMF,CAAA,cAAgB,AAAC,IACf,GAAK,GAGL,GAAI,IAAI,CAAC,OAAO,CAAC,MAAM,CAAE,CACvB,IAAM,EAAO;A;A;AAG2C,8DAAA,EAAE,EAAO;A;A;A;A;A;A;A;AAQjE,MAAA,CAAC,AAEC,CAAA,IAAI,CAAC,aAAa,CAAC,kCACnB,SAAS,EAAI,CACjB,MACE,IAAI,CAAC,SAAS,CAAG,0BAErB,CAAE,AACJ,CACA,eAAe,MAAM,CAAC,eAAgB,ECvEtC,OAAM,UAAsB,YAC1B,mBAAoB,CAClB,IAAI,CAAC,SAAS,CAAG;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;AAiBjB,IAAA,CAAC,CAGD,AADc,IAAI,CAAC,gBAAgB,CAAC,UAC5B,OAAO,CAAC,AAAC,IACf,EAAO,gBAAgB,CAAC,QAAS,KAC/B,IAAI,CAAC,CAAA,CAAsB,CAAC,EAAO,WAAW,EAAE,QAAU,GAC5D,EACF,GAEA,OAAO,UAAU,CAAC,KAChB,IAAI,CAAC,cAAc,CAAC,CAAE,MAAO,KAAM,EACrC,EAAG,IACL,CAKA,CAAA,CAAsB,CAAG,AAAC,IAExB,IAAI,EAAY,SAAS,aAAa,CAAC,0BACnC,IACF,EAAU,KAAK,CAAG,EAClB,EAAU,KAAK,GACf,EAAU,cAAc,CAAG,EAAU,KAAK,CAAC,MAAM,CAErD,CAAE,AACJ,CACA,eAAe,MAAM,CAAC,iBAAkB,EC9CxC,OAAM,UAAoB,YACxB,mBAAoB,CAClB,IAAM,EAAiB;A;A;A;A;AAKvB,IAAA,CAAC,AACD,CAAA,IAAI,CAAC,SAAS,EAAI,EAElB,IAAI,EACF,IAAI,CAAC,aAAa,CAAC,uBAEjB,EACF,IAAI,CAAC,aAAa,CAAC,sBAGrB,CAAA,EAAW,KAAK,CAAC,OAAO,CAAG,OAC3B,EAAW,gBAAgB,CAAC,QAAS,KACnC,IAAM,EAAqB,IAAI,YAAY,kBAC3C,SAAS,aAAa,CAAC,EACzB,GAEA,SAAS,gBAAgB,CAAC,sBAAuB,KAC/C,EAAW,KAAK,CAAC,OAAO,CAAG,OAC3B,EAAW,KAAK,CAAC,OAAO,CAAG,MAC7B,GACA,IAAM,EAAiB,KACrB,EAAW,KAAK,CAAC,OAAO,CAAG,OAC3B,EAAW,KAAK,CAAC,OAAO,CAAG,MAC7B,EACA,SAAS,gBAAgB,CAAC,oBAAqB,GAC/C,SAAS,gBAAgB,CAAC,iBAAkB,EAC9C,CACF,CACA,eAAe,MAAM,CAAC,eAAgB,ECnCtC,OAAM,UAAuB,YAC3B,aAAc,CACZ,KAAK,GACL,IAAI,CAAC,WAAW,CAAG,CACrB,CACA,mBAAoB,CAClB,IAAM,EAAS,IAAI,CAAC,aAAa,CAAC,UAClC,GAAI,CAAC,EACH,MAIwB,CAAA,SAAtB,IAAI,CAAC,OAAO,CAAC,IAAI,EACnB,EAAO,SAAS,GAIlB,IAAI,EAAY,OAAO,MAAS,CAAC,aAAa,CAAC,CAC7C,UAAW,SAAS,aAAa,CAAC,+BAClC,KAAM,kDACN,SAAU,MACV,KAAM,CAAA,EACN,SAAU,CAAA,CACZ,GAEM,EAAa,AAAC,IAClB,IAAI,EAAQ,IAAI,CAAC,gBAAgB,CAAC,kBAClC,EAAM,OAAO,CAAC,CAAC,EAAM,KACnB,GAAI,IAAc,EAAc,CAC9B,EAAK,SAAS,CAAC,MAAM,CAAC,mBAEtB,IAAM,EAA0B,EAAK,aAAa,CAChD,yEAEF,GAAyB,OAC3B,MACE,EAAK,SAAS,CAAC,GAAG,CAAC,kBAEvB,GAEI,IAAiB,EAAM,MAAM,CAAG,IAClC,QAAQ,GAAG,CAAC,+BACqB,OAAO,UAAU,CAChD,oCACA,OAAO,CAEP,EAAU,WAAW,CAAC,EAAU,WAAW,CAAG,EAAG,CAAA,GAEjD,EAAU,IAAI,GAGpB,EACA,EAAW,IAAI,CAAC,WAAW,EAG3B,AADkB,IAAI,CAAC,gBAAgB,CAAC,8BAC5B,OAAO,CAAC,AAAC,IACnB,EAAW,gBAAgB,CAAC,QAAS,KACnC,IAAI,EAAe,CAAA,EAEf,EAAS,EACV,OAAO,CAAC,kBACP,iBAAiB,mBACrB,GAAQ,QAAQ,AAAC,IACV,EAAM,aAAa,KACtB,EAAM,cAAc,GACpB,EAAe,CAAA,EAEnB,GACI,IACF,IAAI,CAAC,WAAW,GAChB,EAAW,IAAI,CAAC,WAAW,EAE/B,EACF,GAKA,AAHsB,IAAI,CAAC,gBAAgB,CACzC,kCAEc,OAAO,CAAC,AAAC,IACvB,EAAe,gBAAgB,CAAC,QAAS,KACvC,IAAI,CAAC,WAAW,GAChB,EAAW,IAAI,CAAC,WAAW,CAC7B,EACF,GAGA,AADkB,IAAI,CAAC,gBAAgB,CAAC,8BAC5B,OAAO,CAAC,AAAC,IACnB,EAAW,gBAAgB,CAAC,QAAS,KACnC,IAAI,CAAC,WAAW,GAChB,EAAW,IAAI,CAAC,WAAW,CAC7B,EACF,GAGA,EAAO,gBAAgB,CAAC,QAAS,KAC/B,IAAI,CAAC,WAAW,CAAG,EAOnB,IAAM,EAAW,MAAO,EAAM,EAAQ,CAAC,IAGrC,IAAM,EAEF,IAAI,CAAC,aAAa,CAAC,iCAClB,OAAS,GACd,GAAI,CACF,MAAM,MAAM,uBAAwB,CAClC,OAAQ,OACR,QAAS,CACP,cAAe,CACjB,EACA,KAAM,CACR,EACF,CAAE,MAAO,EAAK,CACR,EAfc,IAgBhB,OAAO,UAAU,CAAC,KAChB,EAAS,EAAM,EAAQ,EACzB,EAAG,IAEP,CACF,EAIA,EADiB,IAAI,SAAS,IAAI,CAAC,aAAa,CAAC,SAAW,KAAA,GAE9D,GAGA,AADmB,IAAI,CAAC,gBAAgB,CAAC,+BAC5B,OAAO,CAAC,AAAC,IACpB,EAAY,gBAAgB,CAAC,QAAS,KACpC,IAAI,CAAC,aAAa,CAAC,WAAW,OAChC,EACF,EACF,CACF,CACA,eAAe,MAAM,CAAC,kBAAmB,G,E,QC3IzC,OAAM,UAAqB,YACzB,aAAc,CACZ,KAAK,GACL,IAAI,CAAC,QAAQ,CAAG,IAAI,QACtB,CACA,mBAAoB,CAKlB,IAAM,EAAY,AAAC,IACjB,IAAM,EAAK,OAAO,UAAU,GAC5B,MAAO;AAC4D,yEAAA,EAAE,EAAU;A;AAEjE,oBAAA,EAAE,EAAG;A;A;AAGyob,kqbAAA,EAAE,EAAG;A;AAEjqb,MAAA,CAAC,AACH,CAEA,CAAA,IAAI,CAAC,SAAS,CAAG;A;A;A;A;A;AAMP,cAAA,EAAE,EAAU;A;A;A;AAIZ,cAAA,EAAE,EAAU;A;A;A;A;A;A;A;A;A;A;A;A;AAaV,gBAAA,EAAE,EAAU;A;A;A;A;A;A;AAOZ,gBAAA,EAAE,EAAU;A;A;A;A;A;A;A;A;A;A;A;AAYZ,gBAAA,EAAE,EAAU;A;A;A;A;A;A;AAOZ,gBAAA,EAAE,EAAU;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;A;AA4BxB,IAAA,CAAC,CAED,IAAI,CAAC,SAAS,CAAG,OAAO,MAAS,CAAC,aAAa,CAAC,CAC9C,UAAW,SAAS,aAAa,CAAC,wCAClC,KAAM,2CACN,SAAU,MACV,KAAM,CAAA,EACN,SAAU,CAAA,CACZ,GAEA,IAAM,EAAe,IAAI,CAAC,aAAa,CAAC,iCACxC,GAAc,iBAAiB,QAAS,KAClC,AAA+C,SAA/C,EAAa,YAAY,CAAC,iBAC5B,EAAa,YAAY,CAAC,gBAAiB,UAE3C,EAAa,YAAY,CAAC,gBAAiB,QAC3C,IAAI,CAAC,CAAA,CAAW,CAAC,GAErB,GAEA,IAAI,CAAC,aAAa,CAAC,4BAA4B,iBAC7C,QACA,KACE,GAAc,aAAa,gBAAiB,QAC9C,GAGF,IAAI,EAA6B,CAAA,EACjC,SAAS,gBAAgB,CAAC,UAAW,KACnC,EAA6B,CAAA,CAC/B,GACA,SAAS,gBAAgB,CAAC,YAAa,KACrC,EAA6B,CAAA,CAC/B,GACA,IAAI,CAAC,gBAAgB,CAAC,WAAY,KAChC,OAAO,UAAU,CAAC,KAEd,CAAC,IAAI,CAAC,QAAQ,CAAC,SAAS,aAAa,GACrC,GAEA,GAAc,aAAa,gBAAiB,QAEhD,EAAG,IACL,GAEA,SAAS,IAAI,CAAC,gBAAgB,CAAC,QAAS,AAAC,IACvC,IAAM,EAAmD,EAAI,MAAM,CAC9D,GAAe,QAAQ,mBAC1B,GAAc,aAAa,gBAAiB,QAEhD,GAGA,IAAI,CAAC,CAAA,CAAW,CAAC,GACjB,IAAI,CAAC,aAAa,CAAC,gCAAgC,iBACjD,QACA,KACE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAY,OAC9B,IAAI,CAAC,CAAA,CAAW,CAAC,GACjB,IAAI,CAAC,CAAA,CAAa,EACpB,GAEF,IAAI,CAAC,aAAa,CAAC,+BAA+B,iBAChD,QACA,KACE,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,WAAY,MAC9B,IAAI,CAAC,CAAA,CAAW,CAAC,GACjB,IAAI,CAAC,CAAA,CAAa,EACpB,GAIF,IAAI,CAAC,aAAa,CAAC,gCAAgC,iBACjD,QACA,KACE,IAAM,EAAO,IAAI,CAAC,aAAa,CAAC,QAChC,GAAK,GAGL,IAAK,GAAI,CAAC,EAAK,EAAM,GAAI,IAAI,SAAS,GAAM,OAAO,GACjD,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,EAAK,GAEzB,IAAI,CAAC,CAAA,CAAW,CAAC,GACjB,IAAI,CAAC,CAAA,CAAa,GACpB,EAEJ,CAKA,CAAA,CAAW,CAAC,CAAO,EAEjB,IAAI,EAAQ,IAAI,CAAC,gBAAgB,CAAC,wBAClC,EAAM,OAAO,CAAC,CAAC,EAAM,KACf,IAAc,GAChB,EAAK,KAAK,CAAC,OAAO,CAAG,QACrB,OAAO,UAAU,CAAC,KAEhB,IAAM,EAA0B,EAAK,aAAa,CAChD,kCAEF,GAAyB,OAC3B,EAAG,MAEH,EAAK,KAAK,CAAC,OAAO,CAAG,MAEzB,GAGI,IAAY,EAAM,MAAM,CAAG,IACI,OAAO,UAAU,CAChD,oCACA,OAAO,CAEP,IAAI,CAAC,SAAS,CAAC,WAAW,CAAC,IAAI,CAAC,SAAS,CAAC,WAAW,CAAG,EAAG,CAAA,GAE3D,IAAI,CAAC,SAAS,CAAC,IAAI,GAGzB,CAEA,MAAM,CAAA,CAAa,GACjB,GAAI,CACF,MAAM,MAAM,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,qBAAqB,CAAC,CAAE,CAChE,OAAQ,OACR,QAAS,CACP,cAAe,IAAI,CAAC,OAAO,CAAC,IAAI,EAAI,EACtC,EACA,KAAM,IAAI,CAAC,QAAQ,AACrB,EACF,CAAE,MAAO,EAAK,CACZ,QAAQ,GAAG,CAAC,mCAAoC,EAClD,CACF,CACF,CACA,eAAe,MAAM,CAAC,gBAAiB,Gd5NvC,SAAS,gBAAgB,CAAC,oBAAqB,AAAC,IAG9C,IAAM,EAAuC,EAAK,MAAM,CAAC,UAAU,CAC7D,EAA0C,EAAK,MAAM,CAAC,KAAK,CACjE,OAAO,OAAO,CAAC,SAAS,CAAC,CAAC,EAAG,GAAI,CAAC,OAAO,EAAE,EAAA,CAAW,EAGtD,SAAS,aAAa,CAAC,gBAAgB,OAAO,CAAC,EAAW,EAC5D,E,C","sources":["<anon>","src/js/web-components/loading-message.js","src/js/web-components/markdown-converter.js","src/js/web-components/documents/file-status.js","src/js/chats.js","src/js/web-components/chats/chat-controller.js","src/js/web-components/chats/chat-history.js","src/js/web-components/chats/chat-history-item.js","src/js/web-components/chats/chat-message.js","src/js/web-components/chats/chat-title.js","src/js/web-components/chats/copy-text.js","src/js/web-components/chats/document-selector.js","src/js/web-components/chats/feedback-buttons.js","src/js/web-components/chats/message-input.js","src/js/web-components/chats/sources-list.js","src/js/web-components/chats/canned-prompts.js","src/js/web-components/chats/send-message.js","src/js/web-components/chats/profile-overlay.js","src/js/web-components/chats/exit-feedback.js"],"sourcesContent":["(() => {\n\n      var $parcel$global = globalThis;\n    \nvar $parcel$modules = {};\nvar $parcel$inits = {};\n\nvar parcelRequire = $parcel$global[\"parcelRequire94c2\"];\n\nif (parcelRequire == null) {\n  parcelRequire = function(id) {\n    if (id in $parcel$modules) {\n      return $parcel$modules[id].exports;\n    }\n    if (id in $parcel$inits) {\n      var init = $parcel$inits[id];\n      delete $parcel$inits[id];\n      var module = {id: id, exports: {}};\n      $parcel$modules[id] = module;\n      init.call(module.exports, module, module.exports);\n      return module.exports;\n    }\n    var err = new Error(\"Cannot find module '\" + id + \"'\");\n    err.code = 'MODULE_NOT_FOUND';\n    throw err;\n  };\n\n  parcelRequire.register = function register(id, init) {\n    $parcel$inits[id] = init;\n  };\n\n  $parcel$global[\"parcelRequire94c2\"] = parcelRequire;\n}\n\nvar parcelRegister = parcelRequire.register;\nparcelRegister(\"795Or\", function(module, exports) {\n// @ts-check\nclass $533de1f10e763f67$var$LoadingMessage extends HTMLElement {\n    connectedCallback() {\n        this.innerHTML = `\n      <div class=\"rb-loading-ellipsis govuk-body-s\" aria-label=\"${this.dataset.dataAriaLabel || this.dataset.message || \"Loading\"}\">\n        ${this.dataset.message || \"Loading\"}\n        <span aria-hidden=\"true\">.</span>\n        <span aria-hidden=\"true\">.</span>\n        <span aria-hidden=\"true\">.</span>\n      </div>\n    `;\n    }\n}\ncustomElements.define(\"loading-message\", $533de1f10e763f67$var$LoadingMessage);\n\n});\n\nparcelRegister(\"7PjHo\", function(module, exports) {\n// @ts-check\n/** @type {import ('showdown')} */ let $5b2c93a1b6249a89$var$showdown = window[\"showdown\"];\nclass $5b2c93a1b6249a89$export$d1a54e697d9f304d extends HTMLElement {\n    /**\n   * Takes markdown and inserts as HTML\n   * @param {string} markdown\n   */ update(markdown) {\n        let converter = new $5b2c93a1b6249a89$var$showdown.Converter({\n            disableForced4SpacesIndentedSublists: true,\n            headerLevelStart: 3,\n            tables: true\n        });\n        this.innerHTML = converter.makeHtml(markdown);\n    }\n    connectedCallback() {\n        this.update(this.textContent || \"\");\n    }\n}\ncustomElements.define(\"markdown-converter\", $5b2c93a1b6249a89$export$d1a54e697d9f304d);\n\n});\n\nparcelRegister(\"kTS3p\", function(module, exports) {\n// @ts-check\nclass $f372dfae70b38cba$var$FileStatus extends HTMLElement {\n    connectedCallback() {\n        const checkStatus = async ()=>{\n            // UPDATE THESE AS REQUIRED\n            const FILE_STATUS_ENDPOINT = \"/file-status\";\n            const CHECK_INTERVAL_MS = 6000;\n            const response = await fetch(`${FILE_STATUS_ENDPOINT}?id=${this.dataset.id}`);\n            const responseObj = await response.json();\n            this.textContent = responseObj.status;\n            this.dataset.status = responseObj.status.toLowerCase();\n            if (responseObj.status.toLowerCase() === \"complete\") {\n                const evt = new CustomEvent(\"doc-complete\", {\n                    detail: this\n                });\n                document.body.dispatchEvent(evt);\n            } else window.setTimeout(checkStatus, CHECK_INTERVAL_MS);\n        };\n        checkStatus();\n    }\n}\ncustomElements.define(\"file-status\", $f372dfae70b38cba$var$FileStatus);\n\n});\n\n// @ts-check\nclass $24de8e8650e1bf2a$var$ChatController extends HTMLElement {\n    connectedCallback() {\n        const messageForm = this.closest(\"form\");\n        const messageContainer = this.querySelector(\".js-message-container\");\n        const insertPosition = this.querySelector(\".js-response-feedback\");\n        const feedbackButtons = /** @type {HTMLElement | null} */ this.querySelector(\"feedback-buttons\");\n        let selectedDocuments = [];\n        messageForm?.addEventListener(\"submit\", (evt)=>{\n            evt.preventDefault();\n            const messageInput = /** @type {MessageInput | null} */ document.querySelector(\"message-input\");\n            const userText = messageInput?.getValue();\n            if (!messageInput || !userText) return;\n            let userMessage = /** @type {import(\"./chat-message\").ChatMessage} */ document.createElement(\"chat-message\");\n            userMessage.setAttribute(\"data-text\", userText);\n            userMessage.setAttribute(\"data-role\", \"user\");\n            messageContainer?.insertBefore(userMessage, insertPosition);\n            const activites = [\n                `You selected ${selectedDocuments.length || \"no\"} document${selectedDocuments.length === 1 ? \"\" : \"s\"}`,\n                \"You sent this prompt\"\n            ];\n            // add filename to activity if only one file\n            if (selectedDocuments.length === 1) activites[0] += ` (${selectedDocuments[0].name})`;\n            activites.forEach((activity)=>{\n                userMessage.addActivity(activity, \"user\");\n            });\n            let aiMessage = /** @type {import(\"./chat-message\").ChatMessage} */ document.createElement(\"chat-message\");\n            aiMessage.setAttribute(\"data-role\", \"ai\");\n            messageContainer?.insertBefore(aiMessage, insertPosition);\n            const llm = /** @type {HTMLInputElement | null}*/ document.querySelector(\"#llm-selector\")?.value || \"\";\n            aiMessage.stream(userText, selectedDocuments.map((doc)=>doc.id), activites, llm, this.dataset.sessionId, this.dataset.streamUrl || \"\", this);\n            /** @type {HTMLElement | null} */ aiMessage.querySelector(\".iai-chat-bubble\")?.focus();\n            // reset UI\n            if (feedbackButtons) feedbackButtons.dataset.status = \"\";\n            messageInput.reset();\n            // if a route has been intentionally specified by a user, send an event to Plausible\n            (()=>{\n                let plausible = /** @type {any} */ window.plausible;\n                if (typeof plausible === \"undefined\") return;\n                if (userText.includes(\"@chat\")) plausible(\"User-specified-route\", {\n                    props: {\n                        route: \"@chat\"\n                    }\n                });\n                if (userText.includes(\"@chat/documents\")) plausible(\"User-specified-route\", {\n                    props: {\n                        route: \"@chat/documents\"\n                    }\n                });\n                if (userText.includes(\"@search\")) plausible(\"User-specified-route\", {\n                    props: {\n                        route: \"@search\"\n                    }\n                });\n            })();\n        });\n        document.body.addEventListener(\"selected-docs-change\", (evt)=>{\n            selectedDocuments = /** @type{CustomEvent} */ evt.detail;\n        });\n    }\n}\ncustomElements.define(\"chat-controller\", $24de8e8650e1bf2a$var$ChatController);\n\n\n// @ts-check\nclass $c569433c9121ba83$var$ChatHistory extends HTMLElement {\n    connectedCallback() {\n        this.dataset.initialised = \"true\";\n    }\n    /**\n   * Creates a \"Today\" heading, if it doesn't already exist\n   */ #createTodayHeading() {\n        // Create \"Today\" heading if it doesn't already exist\n        let todayHeadingExists = false;\n        const headings = this.querySelectorAll(\"h3\");\n        headings.forEach((heading)=>{\n            if (heading.textContent === \"Today\") todayHeadingExists = true;\n        });\n        if (!todayHeadingExists) {\n            let newHeading = /** @type {HTMLTemplateElement} */ this.querySelector(\"#template-chat_history_heading\").content.querySelector(\"div\");\n            let newHeadingText = newHeading?.querySelector(\"h3\");\n            if (!newHeading || !newHeadingText) return;\n            newHeadingText.textContent = \"Today\";\n            this.prepend(newHeading);\n        }\n    }\n    /**\n   * Internal method for adding the list-item to the chat history\n   * @param {string} chatId\n   * @param {string} title\n   * @returns {HTMLLIElement}\n   */ #createItem(chatId, title) {\n        const newItem = /** @type {HTMLTemplateElement} */ this.querySelector(\"#template-chat_history_item\").content.querySelector(\"li\")?.cloneNode(true);\n        let link = /** @type {HTMLElement} */ newItem.querySelector(\"a\");\n        let chatHistoryItem = /** @type {HTMLElement} */ newItem.querySelector(\"chat-history-item\");\n        if (link) {\n            link.textContent = title;\n            link.setAttribute(\"href\", `/chats/${chatId}`);\n        }\n        /** @type {HTMLElement} */ newItem.dataset.chatid = chatId;\n        chatHistoryItem?.setAttribute(\"data-chatid\", chatId);\n        return /** @type {HTMLLIElement} */ newItem;\n    }\n    /**\n   * Adds an item to the chat history\n   * @param {string} chatId\n   * @param {string} title\n   */ addChat(chatId, title) {\n        this.#createTodayHeading();\n        let item = this.querySelector(`[data-chatid=\"${chatId}\"]`)?.closest(\"li\");\n        if (!item) item = this.#createItem(chatId, title.substring(0, 30));\n        this.querySelector(\"ul\")?.prepend(item);\n    }\n}\ncustomElements.define(\"chat-history\", $c569433c9121ba83$var$ChatHistory);\n\n\n// @ts-check\nclass $37ac9aa4659230fd$var$ChatHistoryItem extends HTMLElement {\n    constructor(){\n        super();\n        this.initialised = false;\n        /** @type {HTMLButtonElement | null} */ this.toggleButton = this.querySelector(\"button[aria-expanded]\");\n        this.chatLink = /** @type {HTMLAnchorElement} */ this.querySelector(\".rb-chat-history__link\");\n    }\n    connectedCallback() {\n        // So we don't rebind event listeners if this ChatHistoryItem moves\n        if (!this.initialised) this.#addEventListeners();\n        this.initialised = true;\n    }\n    #addEventListeners = ()=>{\n        this.toggleButton?.addEventListener(\"click\", ()=>{\n            if (!this.toggleButton) return;\n            if (this.toggleButton.getAttribute(\"aria-expanded\") === \"true\") this.toggleButton.setAttribute(\"aria-expanded\", \"false\");\n            else {\n                this.#changePage(\"1\");\n                this.toggleButton.setAttribute(\"aria-expanded\", \"true\");\n            }\n        });\n        this.querySelector('[data-action=\"delete\"]')?.addEventListener(\"click\", ()=>{\n            this.#changePage(\"2\");\n            deleteButton.focus();\n        });\n        this.querySelector('[data-action=\"rename\"]')?.addEventListener(\"click\", ()=>{\n            this.toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n            this.#toggleChatTitleEdit(true);\n        });\n        let deleteButton = /** @type {HTMLButtonElement} */ this.querySelector('[data-action=\"delete-confirm\"]');\n        deleteButton.addEventListener(\"click\", async ()=>{\n            deleteButton.disabled = true;\n            this.#deleteChat();\n            // move focus to nearest item\n            let listItem = this.closest(\"li\");\n            if (listItem?.nextElementSibling) /** @type {HTMLAnchorElement | null} */ listItem.nextElementSibling.querySelector(\".rb-chat-history__link\")?.focus();\n            else if (listItem?.previousElementSibling) /** @type {HTMLAnchorElement | null} */ listItem.previousElementSibling.querySelector(\".rb-chat-history__link\")?.focus();\n            else /** @type {HTMLAnchorElement | null} */ document.querySelector(\"#new-chat-button\")?.focus();\n        });\n        this.querySelector('[data-action=\"delete-cancel\"]')?.addEventListener(\"click\", ()=>{\n            this.toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n            this.toggleButton?.focus();\n        });\n        let chatTitleInput = this.querySelector(\"input\");\n        if (!chatTitleInput) return;\n        chatTitleInput.addEventListener(\"change\", ()=>{\n            if (!chatTitleInput) return false;\n            this.#toggleChatTitleEdit(false);\n            this.#updateChatTitle(chatTitleInput.value, true);\n        });\n        chatTitleInput.addEventListener(\"blur\", ()=>{\n            this.#toggleChatTitleEdit(false);\n        });\n        chatTitleInput.addEventListener(\"keydown\", (evt)=>{\n            if (!chatTitleInput) return false;\n            switch(/** @type {KeyboardEvent} */ evt.key){\n                case \"Escape\":\n                    chatTitleInput.value = this.dataset.title || \"\";\n                    this.#toggleChatTitleEdit(false);\n                    return true;\n                case \"Enter\":\n                    evt.preventDefault();\n                    this.#updateChatTitle(chatTitleInput.value, true);\n                    this.#toggleChatTitleEdit(false);\n                    return true;\n                default:\n                    return true;\n            }\n        });\n        document.addEventListener(\"chat-title-change\", (evt)=>{\n            let evtData = /** @type {object} */ evt.detail;\n            if (evtData.sender !== \"chat-history-item\" && evtData.session_id === this.dataset.chatid) {\n                this.chatLink.textContent = evtData.title;\n                this.#updateChatTitle(evtData.title, false);\n            }\n        });\n    };\n    /**\n   * @param {string} pageNumber \n   */ #changePage = (pageNumber)=>{\n        /** @type {NodeListOf<HTMLElement>} */ let pages = this.querySelectorAll(\"[data-page]\");\n        pages.forEach((page, pageIndex)=>{\n            if (page.dataset.page === pageNumber) page.style.display = \"block\";\n            else page.style.display = \"none\";\n        });\n    };\n    #deleteChat = async ()=>{\n        const csrfToken = /** @type {HTMLInputElement | null} */ document.querySelector('[name=\"csrfmiddlewaretoken\"]')?.value || \"\";\n        await fetch(`/chats/${this.dataset.chatid}/delete-chat`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-CSRFToken\": csrfToken\n            }\n        });\n        if (this.dataset.iscurrentchat === \"true\") window.location.href = \"/chats\";\n        else this.closest(\"li\")?.remove();\n    };\n    /**\n   * @param {boolean} show \n   */ #toggleChatTitleEdit = (show)=>{\n        let chatTitleEdit = /** @type {HTMLElement} */ this.querySelector(\".rb-chat-history__text-input\");\n        let chatTitleInput = /** @type {HTMLInputElement} */ chatTitleEdit.querySelector(\"input\");\n        if (show) {\n            chatTitleInput.value = this.chatLink.textContent || \"\";\n            this.chatLink.style.display = \"none\";\n            chatTitleEdit.style.display = \"block\";\n            chatTitleInput?.focus();\n        } else {\n            this.chatLink.textContent = chatTitleInput.value;\n            chatTitleEdit.style.display = \"none\";\n            this.chatLink.style.display = \"block\";\n            this.toggleButton?.focus();\n        }\n    };\n    /**\n   * @param {string} newTitle \n   * @param {boolean} publishChanges Whether to let other components know about this change\n   */ #updateChatTitle = (newTitle, publishChanges)=>{\n        const csrfToken = /** @type {HTMLInputElement | null} */ document.querySelector('[name=\"csrfmiddlewaretoken\"]')?.value || \"\";\n        fetch(`/chat/${this.dataset.chatid}/title/`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-CSRFToken\": csrfToken\n            },\n            body: JSON.stringify({\n                name: newTitle\n            })\n        });\n        if (publishChanges) {\n            const chatTitleChangeEvent = new CustomEvent(\"chat-title-change\", {\n                detail: {\n                    title: newTitle,\n                    session_id: this.dataset.chatid,\n                    sender: \"chat-history-item\"\n                }\n            });\n            document.dispatchEvent(chatTitleChangeEvent);\n        }\n    };\n}\ncustomElements.define(\"chat-history-item\", $37ac9aa4659230fd$var$ChatHistoryItem);\n\n\n// @ts-check\nparcelRequire(\"795Or\");\n// Send Plausible data on tool-tip hover\n/**\n *\n * @param {Event} evt\n */ const $dd0dd28c27b0c621$var$sendTooltipViewEvent = (evt)=>{\n    let plausible = /** @type {any} */ window.plausible;\n    if (typeof plausible !== \"undefined\") plausible(\"Route-tooltip-view\");\n    // cancel event listener so events only get sent once\n    let targetElement = /** @type{HTMLElement | null | undefined} */ evt.target;\n    if (targetElement?.nodeName !== \"TOOL-TIP\") targetElement = targetElement?.closest(\"tool-tip\");\n    targetElement?.removeEventListener(\"mouseover\", $dd0dd28c27b0c621$var$sendTooltipViewEvent);\n};\n// Do this for any SSR tool-tips on the page\n(()=>{\n    const tooltips = document.querySelectorAll(\"tool-tip\");\n    tooltips.forEach((tooltip)=>{\n        tooltip.addEventListener(\"mouseover\", $dd0dd28c27b0c621$var$sendTooltipViewEvent);\n    });\n})();\nclass $dd0dd28c27b0c621$export$423c13fd52bec8ad extends HTMLElement {\n    constructor(){\n        super();\n        this.programmaticScroll = false;\n        this.plausibleRouteDataSent = false;\n    }\n    connectedCallback() {\n        const uuid = crypto.randomUUID();\n        this.innerHTML = `\n            <div class=\"iai-chat-bubble govuk-body {{ classes }}\" data-role=\"${this.dataset.role}\" tabindex=\"-1\">\n                <div class=\"iai-chat-bubble__header\">\n                    <div class=\"iai-chat-bubble__role\">${this.dataset.role === \"ai\" ? \"Redbox\" : \"You\"}</div>\n                </div>\n                <markdown-converter class=\"iai-chat-bubble__text\">${this.dataset.text || \"\"}</markdown-converter>\n                ${!this.dataset.text ? `\n                      <loading-message data-aria-label=\"Loading message\"></loading-message>\n                      <div class=\"rb-loading-complete govuk-visually-hidden\" aria-live=\"assertive\"></div>\n                    ` : \"\"}\n                <sources-list data-id=\"${uuid}\"></sources-list>\n                <div class=\"govuk-notification-banner govuk-notification-banner--error govuk-!-margin-bottom-3 govuk-!-margin-top-3\" role=\"alert\" aria-labelledby=\"notification-title-${uuid}\" data-module=\"govuk-notification-banner\" hidden>\n                    <div class=\"govuk-notification-banner__header\">\n                        <h3 class=\"govuk-notification-banner__title\" id=\"notification-title-${uuid}\">Error</h3>\n                    </div>\n                    <div class=\"govuk-notification-banner__content\">\n                        <p class=\"govuk-notification-banner__heading\"></p>\n                    </div>\n                </div>\n            </div>\n            <feedback-buttons></feedback-buttons>\n        `;\n        // ensure new chat-messages aren't hidden behind the chat-input\n        this.programmaticScroll = true;\n        this.scrollIntoView({\n            block: \"end\"\n        });\n        // Insert route_display HTML\n        const routeTemplate = /** @type {HTMLTemplateElement} */ document.querySelector(\"#template-route-display\");\n        const routeClone = document.importNode(routeTemplate.content, true);\n        this.querySelector(\".iai-chat-bubble__header\")?.appendChild(routeClone);\n        this.querySelector(\"tool-tip\")?.addEventListener(\"mouseover\", $dd0dd28c27b0c621$var$sendTooltipViewEvent);\n    }\n    #addFootnotes = (content)=>{\n        let footnotes = this.querySelectorAll(\"sources-list a[data-text]\");\n        footnotes.forEach((footnote, footnoteIndex)=>{\n            const matchingText = footnote.getAttribute(\"data-text\");\n            if (!matchingText || !this.responseContainer) return;\n            /*\n      this.responseContainer?.update(\n        content.replace(matchingText, `${matchingText}<a href=\"#${footnote.id}\" aria-label=\"Footnote ${footnoteIndex + 1}\">[${footnoteIndex + 1}]</a>`)\n      );\n      */ this.responseContainer.innerHTML = this.responseContainer.innerHTML.replace(matchingText, `${matchingText}<a class=\"rb-footnote-link\" href=\"#${footnote.id}\" aria-label=\"Footnote ${footnoteIndex + 1}\">${footnoteIndex + 1}</a>`);\n        });\n    };\n    /**\n   * Displays an activity above the message\n   * @param {string} message \n   * @param { \"ai\" | \"user\"} type\n   */ addActivity = (message, type)=>{\n        let activityElement = document.createElement(\"p\");\n        activityElement.classList.add(\"rb-activity\", `rb-activity--${type}`);\n        activityElement.textContent = message;\n        this.insertBefore(activityElement, this.querySelector(\".iai-chat-bubble\"));\n    };\n    /**\n   * Streams an LLM response\n   * @param {string} message\n   * @param {string[]} selectedDocuments\n   * @param {string[]} activities\n   * @param {string} llm\n   * @param {string | undefined} sessionId\n   * @param {string} endPoint\n   * @param {HTMLElement} chatControllerRef\n   */ stream = (message, selectedDocuments, activities, llm, sessionId, endPoint, chatControllerRef)=>{\n        // Scroll behaviour - depending on whether user has overridden this or not\n        let scrollOverride = false;\n        window.addEventListener(\"scroll\", (evt)=>{\n            if (this.programmaticScroll) {\n                this.programmaticScroll = false;\n                return;\n            }\n            scrollOverride = true;\n        });\n        this.responseContainer = /** @type {import(\"../markdown-converter\").MarkdownConverter} */ this.querySelector(\"markdown-converter\");\n        let sourcesContainer = /** @type SourcesList */ this.querySelector(\"sources-list\");\n        /** @type {FeedbackButtons | null} */ let feedbackContainer = this.querySelector(\"feedback-buttons\");\n        let responseLoading = /** @type HTMLElement */ this.querySelector(\".rb-loading-ellipsis\");\n        let responseComplete = this.querySelector(\".rb-loading-complete\");\n        let webSocket = new WebSocket(endPoint);\n        let streamedContent = \"\";\n        // Stop streaming on escape-key or stop-button press\n        const stopStreaming = ()=>{\n            this.dataset.status = \"stopped\";\n            webSocket.close();\n        };\n        this.addEventListener(\"keydown\", (evt)=>{\n            if (evt.key === \"Escape\" && this.dataset.status === \"streaming\") stopStreaming();\n        });\n        document.addEventListener(\"stop-streaming\", stopStreaming);\n        webSocket.onopen = (event)=>{\n            webSocket.send(JSON.stringify({\n                message: message,\n                sessionId: sessionId,\n                selectedFiles: selectedDocuments,\n                activities: activities,\n                llm: llm\n            }));\n            this.dataset.status = \"streaming\";\n            const chatResponseStartEvent = new CustomEvent(\"chat-response-start\");\n            document.dispatchEvent(chatResponseStartEvent);\n        };\n        webSocket.onerror = (event)=>{\n            if (!this.responseContainer) return;\n            this.responseContainer.innerHTML = \"There was a problem. Please try sending this message again.\";\n            this.dataset.status = \"error\";\n        };\n        webSocket.onclose = (event)=>{\n            responseLoading.style.display = \"none\";\n            if (responseComplete) responseComplete.textContent = \"Response complete\";\n            if (this.dataset.status !== \"stopped\") this.dataset.status = \"complete\";\n            const stopStreamingEvent = new CustomEvent(\"stop-streaming\");\n            document.dispatchEvent(stopStreamingEvent);\n        };\n        webSocket.onmessage = (event)=>{\n            let response;\n            try {\n                response = JSON.parse(event.data);\n            } catch (err) {\n                console.log(\"Error getting JSON response\", err);\n            }\n            if (response.type === \"text\") {\n                streamedContent += response.data;\n                this.responseContainer?.update(streamedContent);\n            } else if (response.type === \"session-id\") chatControllerRef.dataset.sessionId = response.data;\n            else if (response.type === \"source\") sourcesContainer.add(response.data.file_name, response.data.url, response.data.text_in_answer);\n            else if (response.type === \"route\") {\n                let route = this.querySelector(\".iai-chat-bubble__route\");\n                let routeText = route?.querySelector(\".iai-chat-bubble__route-text\");\n                if (route && routeText) {\n                    routeText.textContent = response.data;\n                    route.removeAttribute(\"hidden\");\n                }\n                // send route to Plausible\n                let plausible = /** @type {any} */ window.plausible;\n                if (typeof plausible !== \"undefined\" && !this.plausibleRouteDataSent) {\n                    plausible(\"Chat-message-route\", {\n                        props: {\n                            route: response.data\n                        }\n                    });\n                    this.plausibleRouteDataSent = true;\n                }\n            } else if (response.type === \"activity\") this.addActivity(response.data, \"ai\");\n            else if (response.type === \"end\") {\n                sourcesContainer.showCitations(response.data.message_id);\n                feedbackContainer?.showFeedback(response.data.message_id);\n                this.#addFootnotes(streamedContent);\n                const chatResponseEndEvent = new CustomEvent(\"chat-response-end\", {\n                    detail: {\n                        title: response.data.title,\n                        session_id: response.data.session_id\n                    }\n                });\n                document.dispatchEvent(chatResponseEndEvent);\n            } else if (response.type === \"error\") {\n                this.querySelector(\".govuk-notification-banner\")?.removeAttribute(\"hidden\");\n                let errorContentContainer = this.querySelector(\".govuk-notification-banner__heading\");\n                if (errorContentContainer) errorContentContainer.innerHTML = response.data;\n            }\n            // ensure new content isn't hidden behind the chat-input\n            // but stop scrolling if message is at the top of the screen\n            if (!scrollOverride) {\n                const TOP_POSITION = 88;\n                const boxInfo = this.getBoundingClientRect();\n                const newTopPosition = boxInfo.top - (boxInfo.height - (this.previousHeight || boxInfo.height));\n                this.previousHeight = boxInfo.height;\n                if (newTopPosition > TOP_POSITION) {\n                    this.programmaticScroll = true;\n                    this.scrollIntoView({\n                        block: \"end\"\n                    });\n                } else {\n                    scrollOverride = true;\n                    this.scrollIntoView();\n                    window.scrollBy(0, -TOP_POSITION);\n                }\n            }\n        };\n    };\n}\ncustomElements.define(\"chat-message\", $dd0dd28c27b0c621$export$423c13fd52bec8ad);\n\n\n// @ts-check\nclass $523b4c7e9644c494$export$4ff9f55b560a7a19 extends HTMLElement {\n    connectedCallback() {\n        this.innerHTML = `\n            <div class=\"chat-title__heading-container\">\n                <div class=\"chat-title__heading-container-inner\">\n                ${this.dataset.title ? `\n                    <h2 class=\"chat-title__heading govuk-heading-m\">${this.dataset.title}</h2>\n                ` : `\n                    <h2 class=\"chat-title__heading govuk-heading-s govuk-visually-hidden\">Current chat</h2>\n                `}\n                <button class=\"chat-title__edit-btn\" type=\"button\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 25 24\" fill=\"none\" aria-hidden=\"true\" focusable=\"false\">\n                    <path d=\"M11.9766 4H4.97656C4.44613 4 3.93742 4.21071 3.56235 4.58579C3.18728 4.96086 2.97656 5.46957 2.97656 6V20C2.97656 20.5304 3.18728 21.0391 3.56235 21.4142C3.93742 21.7893 4.44613 22 4.97656 22H18.9766C19.507 22 20.0157 21.7893 20.3908 21.4142C20.7658 21.0391 20.9766 20.5304 20.9766 20V13\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M19.4766 2.49998C19.8744 2.10216 20.414 1.87866 20.9766 1.87866C21.5392 1.87866 22.0787 2.10216 22.4766 2.49998C22.8744 2.89781 23.0979 3.43737 23.0979 3.99998C23.0979 4.56259 22.8744 5.10216 22.4766 5.49998L12.9766 15L8.97656 16L9.97656 12L19.4766 2.49998Z\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    </svg>\n                    Edit\n                    <span class=\"govuk-visually-hidden\"> chat title</span>\n                </button>\n                </div>\n            </div>\n            <div class=\"chat-title__form-container\" hidden>\n                <label for=\"chat-title\" class=\"govuk-visually-hidden\">Chat Title</label>\n                <input type=\"text\" class=\"chat-title__input\" id=\"chat-title\" maxlength=\"${this.dataset.titleLength}\" value=\"${this.dataset.title}\" tabindex=\"-1\"/>\n            </div>\n        `;\n        this.headingContainer = this.querySelector(\".chat-title__heading-container\");\n        this.formContainer = this.querySelector(\".chat-title__form-container\");\n        /** @type {HTMLButtonElement | null} */ this.editButton = this.querySelector(\".chat-title__edit-btn\");\n        /** @type {HTMLInputElement | null} */ this.input = this.querySelector(\".chat-title__input\");\n        this.heading = this.querySelector(\".chat-title__heading\");\n        this.editButton?.addEventListener(\"click\", this.showForm);\n        this.heading?.addEventListener(\"click\", this.showForm);\n        this.input?.addEventListener(\"keydown\", (e)=>{\n            if (!this.input) return false;\n            switch(/** @type {KeyboardEvent} */ e.key){\n                case \"Escape\":\n                    this.input.value = this.dataset.title || \"\";\n                    this.hideForm();\n                    return true;\n                case \"Enter\":\n                    e.preventDefault();\n                    this.update(true);\n                    return true;\n                default:\n                    return true;\n            }\n        });\n        this.input?.addEventListener(\"change\", (e)=>{\n            this.update(true);\n        });\n        this.input?.addEventListener(\"blur\", (e)=>{\n            this.update(true);\n        });\n        if (!this.dataset.sessionId) document.addEventListener(\"chat-response-end\", this.#onFirstResponse);\n        document.addEventListener(\"chat-title-change\", (evt)=>{\n            let evtData = /** @type {object} */ evt.detail;\n            if (evtData.sender !== \"chat-title\" && evtData.session_id === this.dataset.sessionId) {\n                if (this.input) this.input.value = evtData.title;\n                this.update(false);\n            }\n        });\n    }\n    showForm = ()=>{\n        this.headingContainer?.setAttribute(\"hidden\", \"\");\n        this.formContainer?.removeAttribute(\"hidden\");\n        this.input?.focus();\n    };\n    hideForm = ()=>{\n        this.headingContainer?.removeAttribute(\"hidden\");\n        this.formContainer?.setAttribute(\"hidden\", \"\");\n        this.editButton?.focus();\n    };\n    #onFirstResponse = (e)=>{\n        this.dataset.title = e.detail.title;\n        this.dataset.sessionId = e.detail.session_id;\n        document.removeEventListener(\"chat-response-end\", this.#onFirstResponse);\n        if (this.input && this.heading) {\n            this.input.value = e.detail.title;\n            this.heading.textContent = `${e.detail.title}`;\n            this.heading.classList.remove(\"govuk-visually-hidden\");\n            window.scrollBy(0, this.heading.getBoundingClientRect().height); // to prevent message jumping when this is made visible\n        }\n    };\n    /**\n     * @param {boolean} publishChanges Whether to let other components know about this change\n     */ update = (publishChanges)=>{\n        const newTitle = this.input?.value;\n        this.send(newTitle);\n        this.dataset.title = newTitle;\n        if (this.heading) this.heading.textContent = newTitle || \"\";\n        this.hideForm();\n        if (publishChanges) {\n            const chatTitleChangeEvent = new CustomEvent(\"chat-title-change\", {\n                detail: {\n                    title: newTitle,\n                    session_id: this.dataset.sessionId,\n                    sender: \"chat-title\"\n                }\n            });\n            document.dispatchEvent(chatTitleChangeEvent);\n        }\n    };\n    send = (newTitle)=>{\n        const csrfToken = /** @type {HTMLInputElement | null} */ document.querySelector('[name=\"csrfmiddlewaretoken\"]')?.value || \"\";\n        fetch(`/chat/${this.dataset.sessionId}/title/`, {\n            method: \"POST\",\n            headers: {\n                \"Content-Type\": \"application/json\",\n                \"X-CSRFToken\": csrfToken\n            },\n            body: JSON.stringify({\n                name: newTitle\n            })\n        });\n    };\n}\ncustomElements.define(\"chat-title\", $523b4c7e9644c494$export$4ff9f55b560a7a19);\n\n\n// @ts-check\nclass $d1cd430a26d0f01f$var$CopyText extends HTMLElement {\n    connectedCallback() {\n        this.innerHTML = `\n        <button class=\"iai-chat-bubble__button\" type=\"button\">\n          <svg width=\"19\" height=\"18\" viewBox=\"0 0 19 18\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\">\n            <path d=\"M6.875 3H5C4.17157 3 3.5 3.67157 3.5 4.5V15C3.5 15.8284 4.17157 16.5 5 16.5H14C14.8284 16.5 15.5 15.8284 15.5 15V4.5C15.5 3.67157 14.8284 3 14 3H12.125\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\n            <path d=\"M6.5 4.8V3.375C6.5 3.16789 6.66789 3 6.875 3C7.08211 3 7.25317 2.83203 7.28864 2.62798C7.39976 1.98878 7.83049 0.75 9.5 0.75C11.1695 0.75 11.6002 1.98878 11.7114 2.62798C11.7468 2.83203 11.9179 3 12.125 3C12.3321 3 12.5 3.16789 12.5 3.375V4.8C12.5 5.04853 12.2985 5.25 12.05 5.25H6.95C6.70147 5.25 6.5 5.04853 6.5 4.8Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\n          </svg>\n          Copy to clipboard\n        </button>\n    `;\n        const copyToClip = (html, text)=>{\n            function listener(evt) {\n                evt.clipboardData.setData(\"text/html\", html);\n                evt.clipboardData.setData(\"text/plain\", text);\n                evt.preventDefault();\n            }\n            document.addEventListener(\"copy\", listener);\n            document.execCommand(\"copy\");\n            document.removeEventListener(\"copy\", listener);\n        };\n        this.querySelector(\"button\")?.addEventListener(\"click\", ()=>{\n            const textEl = this.closest(\".iai-chat-bubble\")?.querySelector(\".iai-chat-bubble__text\");\n            copyToClip(textEl?.innerHTML, textEl?.innerText);\n        });\n    }\n}\ncustomElements.define(\"copy-text\", $d1cd430a26d0f01f$var$CopyText);\n\n\n// @ts-check\nclass $18ba9063b4048b1a$var$DocumentSelector extends HTMLElement {\n    connectedCallback() {\n        const documents = /** @type {NodeListOf<HTMLInputElement>} */ this.querySelectorAll('input[type=\"checkbox\"]');\n        const getSelectedDocuments = ()=>{\n            let selectedDocuments = [];\n            documents.forEach((document1)=>{\n                if (document1.checked) selectedDocuments.push({\n                    id: document1.value,\n                    name: this.querySelector(`[for=\"${document1.id}\"]`)?.textContent\n                });\n            });\n            const evt = new CustomEvent(\"selected-docs-change\", {\n                detail: selectedDocuments\n            });\n            document.body.dispatchEvent(evt);\n        };\n        // update on page load\n        getSelectedDocuments();\n        // update on any selection change\n        documents.forEach((document1)=>{\n            document1.addEventListener(\"change\", getSelectedDocuments);\n        });\n        // listen for completed docs\n        document.body.addEventListener(\"doc-complete\", (evt)=>{\n            const completedDoc = /** @type{CustomEvent} */ evt.detail.closest(\".govuk-checkboxes__item\");\n            completedDoc.querySelector(\"file-status\").remove();\n            this.querySelector(\".govuk-checkboxes\")?.appendChild(completedDoc);\n        });\n    }\n}\ncustomElements.define(\"document-selector\", $18ba9063b4048b1a$var$DocumentSelector);\n\n\n// @ts-check\nclass $f4d16ddf50b4860a$var$FeedbackButtons extends HTMLElement {\n    showFeedback(messageId) {\n        let collectedData = {\n            rating: 0,\n            text: \"\",\n            chips: /** @type {string[]}*/ []\n        };\n        const starIcon = `\n        <svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\">\n            <path d=\"M12.0172 1.68381C12.1639 1.21711 12.8244 1.21711 12.9711 1.68381L15.1648 8.66018C15.3613 9.28511 15.9406 9.71024 16.5957 9.71024H23.7624C24.2428 9.71024 24.4468 10.3217 24.0626 10.6101L18.2088 15.0049C17.7002 15.3867 17.4877 16.0477 17.6784 16.6544L19.901 23.7227C20.0468 24.1863 19.5124 24.5643 19.1238 24.2726L13.3947 19.9714C12.8612 19.5708 12.1271 19.5708 11.5936 19.9714L5.86446 24.2726C5.47585 24.5643 4.94152 24.1863 5.08728 23.7227L7.30983 16.6544C7.50059 16.0477 7.28806 15.3867 6.77949 15.0049L0.925668 10.6101C0.5415 10.3217 0.745481 9.71024 1.22586 9.71024H8.3926C9.0477 9.71024 9.62702 9.28511 9.82353 8.66017L12.0172 1.68381Z\" fill=\"currentColor\" stroke=\"#BEBEBE\"/>\n        </svg>\n    `;\n        this.innerHTML = `\n        <div class=\"feedback__container feedback__container--1\" tabindex=\"-1\">\n            <h3 class=\"feedback__heading\">Rate this response:</h3>\n            <div class=\"feedback__star-container\">\n                <span class=\"feedback__star-help-text\" aria-hidden=\"true\">Not helpful</span>\n                <button class=\"feedback__star-button\" data-rating=\"1\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">1 star out of 5 (not helpful)</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"2\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">2 star out of 5</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"3\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">3 star out of 5</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"4\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">4 star out of 5</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"5\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">5 star out of 5 (very helpful)</span>\n                </button>\n                <span class=\"feedback__star-help-text\" aria-hidden=\"true\">Very helpful</span>\n            </div>\n        </div>\n        <div class=\"feedback__container feedback__container--2\" hidden tabindex=\"-1\">\n            <div class=\"feedback__response-container\">\n                <img src=\"/static/icons/thumbs-up.svg\" alt=\"\"/>\n                <span class=\"feedback__negative\">Sorry this didn't meet your expectations</span>\n                <span class=\"feedback__positive\">Thanks for the feedback</span>\n            </div>\n            <button class=\"feedback__improve-response-btn\" type=\"button\">Help improve the response</button>\n        </div>\n        <div class=\"feedback__container feedback__container--3\" hidden tabindex=\"-1\">\n            <fieldset class=\"feedback__chips-container feedback__negative\">\n                <legend class=\"feedback__chips-legend\">How would you describe the response?</legend>\n                <div class=\"feedback__chips-inner-container\">\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip1-negative-${messageId}\" data-testid=\"Inaccurate\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip1-negative-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Inaccurate</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip2-negative-${messageId}\" data-testid=\"Incomplete\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip2-negative-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Incomplete</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip3-negative-${messageId}\" data-testid=\"Bad quality\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip3-negative-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Bad quality</label>\n                </div>\n            </fieldset>\n            <fieldset class=\"feedback__chips-container feedback__positive\">\n                <legend class=\"feedback__chips-legend\">How would you describe the response?</legend>\n                <div class=\"feedback__chips-inner-container\">\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip1-positive-${messageId}\" data-testid=\"Accurate\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip1-positive-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Accurate</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip2-positive-${messageId}\" data-testid=\"Complete\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip2-positive-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Complete</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip3-positive-${messageId}\" data-testid=\"Good quality\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip3-positive-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Good quality</label>\n                </div>\n            </fieldset>\n            <label for=\"text-${messageId}\">Or describe with your own words:</label>\n            <textarea class=\"feedback__text-input\" id=\"text-${messageId}\" rows=\"1\"></textarea>\n            <button class=\"feedback__submit-btn\" type=\"button\">Submit</button>\n        </div>\n        <div class=\"feedback__container feedback__container--4\" hidden tabindex=\"-1\">\n           <span>Thanks for helping improve this response</span>\n           <button class=\"feedback__rate-again-btn\" type=\"button\">Rate response again</button> \n        </div>\n    `;\n        /**\n     * Posts data back to the server\n     */ const sendFeedback = async (retry = 0)=>{\n            const MAX_RETRIES = 10;\n            const RETRY_INTERVAL_SECONDS = 10;\n            const csrfToken = /** @type {HTMLInputElement | null} */ document.querySelector('[name=\"csrfmiddlewaretoken\"]')?.value || \"\";\n            try {\n                await fetch(`/ratings/${messageId}/`, {\n                    method: \"POST\",\n                    headers: {\n                        \"Content-Type\": \"application/json\",\n                        \"X-CSRFToken\": csrfToken\n                    },\n                    body: JSON.stringify(collectedData)\n                });\n            } catch (err) {\n                if (retry < MAX_RETRIES) window.setTimeout(()=>{\n                    sendFeedback(retry + 1);\n                }, RETRY_INTERVAL_SECONDS * 1000);\n            }\n        };\n        /**\n     * @param {number} panelIndex - zero based\n     */ const showPanel = (panelIndex)=>{\n            /** @type {NodeListOf<HTMLElement>} */ let panels = this.querySelectorAll(\".feedback__container\");\n            panels.forEach((panel)=>{\n                panel.setAttribute(\"hidden\", \"\");\n            });\n            panels[panelIndex].removeAttribute(\"hidden\");\n            panels[panelIndex].focus();\n            if (collectedData.rating >= 3) {\n                panels[panelIndex].classList.remove(\"feedback__container--negative\");\n                panels[panelIndex].classList.add(\"feedback__container--positive\");\n            } else {\n                panels[panelIndex].classList.add(\"feedback__container--negative\");\n                panels[panelIndex].classList.remove(\"feedback__container--positive\");\n            }\n        };\n        /* Panel 1 - stars rating */ let starButtons = /** @type {NodeListOf<HTMLElement>} */ this.querySelectorAll(\".feedback__star-button\");\n        starButtons.forEach((starButton, buttonIndex)=>{\n            starButton.addEventListener(\"click\", ()=>{\n                collectedData.rating = parseInt(starButton.dataset.rating || \"0\");\n                sendFeedback();\n                showPanel(1);\n            });\n            starButton.addEventListener(\"mouseover\", ()=>{\n                starButtons.forEach((btn)=>{\n                    btn.classList.remove(\"feedback__star-button--hover\");\n                });\n                for(let i = 0; i <= buttonIndex; i++)starButtons[i].classList.add(\"feedback__star-button--hover\");\n            });\n            starButton.addEventListener(\"mouseleave\", ()=>{\n                starButtons.forEach((btn)=>{\n                    btn.classList.remove(\"feedback__star-button--hover\");\n                });\n            });\n        });\n        /* Panel 2 - help improve response */ this.querySelector(\".feedback__improve-response-btn\")?.addEventListener(\"click\", ()=>{\n            showPanel(2);\n        });\n        /* Panel 3 - text and chips */ /** @type {HTMLTextAreaElement | null} */ const textInput = this.querySelector(`#text-${messageId}`);\n        this.querySelector(\".feedback__submit-btn\")?.addEventListener(\"click\", (evt)=>{\n            evt.preventDefault();\n            /** @type {NodeListOf<HTMLInputElement>} */ let chips = this.querySelectorAll(\".feedback__chip\");\n            chips.forEach((chip)=>{\n                if (chip.checked) {\n                    const text = this.querySelector(`[for=\"${chip.id}\"]`)?.textContent;\n                    if (text) collectedData.chips.push(text);\n                }\n            });\n            collectedData.text = textInput?.value || \"\";\n            sendFeedback();\n            showPanel(3);\n        });\n        textInput?.addEventListener(\"input\", ()=>{\n            textInput.style.height = \"auto\";\n            textInput.style.height = `${textInput.scrollHeight}px`;\n        });\n        /* Panel 4 - thank you */ this.querySelector(\".feedback__rate-again-btn\")?.addEventListener(\"click\", ()=>{\n            showPanel(0);\n        });\n    }\n    // If the messageID already exists (e.g. for SSR messages), render the feedback HTML immediately\n    connectedCallback() {\n        if (this.dataset.id) this.showFeedback(this.dataset.id);\n    }\n}\ncustomElements.define(\"feedback-buttons\", $f4d16ddf50b4860a$var$FeedbackButtons);\n\n\nparcelRequire(\"7PjHo\");\n// @ts-check\nclass $3c2eec46b81f3aa7$var$MessageInput extends HTMLElement {\n    constructor(){\n        super();\n        this.textarea = this.querySelector(\"textarea\");\n    }\n    connectedCallback() {\n        if (!this.textarea) return;\n        // Submit form on enter-key press (providing shift isn't being pressed)\n        this.textarea.addEventListener('keypress', (evt)=>{\n            if (evt.key === 'Enter' && !evt.shiftKey && this.textarea) {\n                evt.preventDefault();\n                if (this.textarea.value.trim()) this.closest('form')?.requestSubmit();\n            }\n        });\n        // expand textarea as user adds lines\n        this.textarea.addEventListener('input', ()=>{\n            this.#adjustHeight();\n        });\n    }\n    #adjustHeight = ()=>{\n        if (!this.textarea) return;\n        this.textarea.style.height = 'auto';\n        this.textarea.style.height = `${this.textarea.scrollHeight}px`;\n    };\n    /**\n     * Returns the current message\n     * @returns string\n     */ getValue = ()=>{\n        return this.querySelector(\"textarea\")?.value.trim() || \"\";\n    };\n    /**\n     * Clears the message and resets to starting height\n     */ reset = ()=>{\n        if (!this.textarea) return;\n        this.textarea.value = \"\";\n        this.#adjustHeight();\n    };\n}\ncustomElements.define('message-input', $3c2eec46b81f3aa7$var$MessageInput);\n\n\n// @ts-check\nclass $27a22c5ba7efffc8$var$SourcesList extends HTMLElement {\n    constructor(){\n        super();\n        this.sources = [];\n    }\n    /**\n   * Adds a source to the current message\n   * @param {string} fileName\n   * @param {string} url\n   * @param {string} matchingText\n   */ add = (fileName, url, matchingText)=>{\n        // prevent duplicate sources\n        if (this.sources.some((source)=>source.fileName === fileName)) return;\n        this.sources.push({\n            fileName: fileName,\n            url: url,\n            matchingText: matchingText\n        });\n        let html = `\n            <h3 class=\"iai-chat-bubble__sources-heading govuk-heading-s govuk-!-margin-bottom-1\">Sources</h3>\n            <div class=\"iai-display-flex-from-desktop\">\n            <ol class=\"rb-footnote-list govuk-!-margin-bottom-0\">\n        `;\n        this.sources.forEach((source)=>{\n            html += `\n                <li class=\"govuk-!-margin-bottom-0\">\n                    <a class=\"iai-chat-bubbles__sources-link govuk-link\" href=\"${source.url}\" id=\"footnote-${this.getAttribute('data-id')}-${this.sources.length}\" data-text=\"${source.matchingText}\">${source.fileName || source.url}</a>\n                </li>\n            `;\n        });\n        html += `</div></ol>`;\n        this.innerHTML = html;\n    };\n    /**\n   * Shows to citations link/button\n   * @param {string} chatId\n   */ showCitations = (chatId)=>{\n        if (!chatId) return;\n        if (this.sources.length) {\n            const html = `\n        <div class=\"iai-chat-bubble__citations-button-container\">\n          <copy-text></copy-text>\n          <a class=\"iai-chat-bubble__button\" href=\"/citations/${chatId}\">\n            <svg width=\"20\" height=\"19\" viewBox=\"0 0 20 19\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\">\n                <path d=\"M1.5 9.62502C1.5 9.62502 4.59036 3.55359 10 3.55359C15.4084 3.55359 18.5 9.62502 18.5 9.62502C18.5 9.62502 15.4084 15.6964 10 15.6964C4.59036 15.6964 1.5 9.62502 1.5 9.62502Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M9.99993 10.8392C10.322 10.8392 10.6308 10.7113 10.8586 10.4836C11.0863 10.2558 11.2142 9.94698 11.2142 9.62493C11.2142 9.30288 11.0863 8.99402 10.8586 8.7663C10.6308 8.53858 10.322 8.41064 9.99993 8.41064C9.67788 8.41064 9.36902 8.53858 9.1413 8.7663C8.91358 8.99402 8.78564 9.30288 8.78564 9.62493C8.78564 9.94698 8.91358 10.2558 9.1413 10.4836C9.36902 10.7113 9.67788 10.8392 9.99993 10.8392Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n            See the response info\n          </a>\n        </div>\n      `;\n            /** @type {HTMLElement} */ this.querySelector(\".iai-display-flex-from-desktop\").innerHTML += html;\n        } else this.innerHTML = `<copy-text></copy-text>`;\n    };\n}\ncustomElements.define(\"sources-list\", $27a22c5ba7efffc8$var$SourcesList);\n\n\n// @ts-check\nclass $4862d4424575218f$var$CannedPrompts extends HTMLElement {\n    connectedCallback() {\n        this.innerHTML = `\n      <h3 class=\"chat-options__heading govuk-heading-m\">What would you like to ask your Redbox?</h3>\n      <div class=\"chat-options__options\">\n          <button class=\"chat-options__option chat-options__option_agenda plausible-event-name--canned+prompt+draft+meeting+agenda\" type=\"button\">\n              <img src=\"/static/icons/icon_square_doc.svg\" alt=\"\"/>\n              Draft an agenda for a team meeting\n          </button>\n          <button class=\"chat-options__option chat-options__option_objectives plausible-event-name--canned+prompt+set+work+objectives\" type=\"button\">\n              <img src=\"/static/icons/archery.svg\" alt=\"\"/>\n              Help me set my work objectives\n          </button>\n          <button class=\"chat-options__option chat-options__option_ps_role plausible-event-name--canned+prompt+describe+role+permanent+secretary\" type=\"button\">\n              <img src=\"/static/icons/person.svg\" alt=\"\"/>\n              Describe the role of a Permanent Secretary\n          </button>\n      </div>\n      <p class=\"chat-options__info-text\">Or type any question below</p>\n    `;\n        let buttons = this.querySelectorAll(\"button\");\n        buttons.forEach((button)=>{\n            button.addEventListener(\"click\", ()=>{\n                this.#prepopulateMessageBox(button.textContent?.trim() || \"\");\n            });\n        });\n        window.setTimeout(()=>{\n            this.scrollIntoView({\n                block: \"end\"\n            });\n        }, 100);\n    }\n    /**\n   * @param {string} prompt\n   */ #prepopulateMessageBox = (prompt)=>{\n        /** @type HTMLInputElement | null */ let chatInput = document.querySelector(\".iai-chat-input__input\");\n        if (chatInput) {\n            chatInput.value = prompt;\n            chatInput.focus();\n            chatInput.selectionStart = chatInput.value.length;\n        }\n    };\n}\ncustomElements.define(\"canned-prompts\", $4862d4424575218f$var$CannedPrompts);\n\n\n// @ts-check\nclass $cf2b3c4cbed047e5$var$SendMessage extends HTMLElement {\n    connectedCallback() {\n        const stopButtonHtml = `\n      <button class=\"iai-chat-input__button iai-icon-button rb-send-button\" type=\"button\">\n        <div class=\"rb-square-icon\"></div>\n        Stop\n      </button>\n    `;\n        this.innerHTML += stopButtonHtml;\n        let buttonSend = /** @type {HTMLButtonElement} */ this.querySelector(\"button:nth-child(1)\");\n        let buttonStop = /** @type {HTMLButtonElement} */ this.querySelector(\"button:nth-child(2)\");\n        buttonStop.style.display = \"none\";\n        buttonStop.addEventListener(\"click\", ()=>{\n            const stopStreamingEvent = new CustomEvent(\"stop-streaming\");\n            document.dispatchEvent(stopStreamingEvent);\n        });\n        document.addEventListener(\"chat-response-start\", ()=>{\n            buttonSend.style.display = \"none\";\n            buttonStop.style.display = \"flex\";\n        });\n        const showSendButton = ()=>{\n            buttonSend.style.display = \"flex\";\n            buttonStop.style.display = \"none\";\n        };\n        document.addEventListener(\"chat-response-end\", showSendButton);\n        document.addEventListener(\"stop-streaming\", showSendButton);\n    }\n}\ncustomElements.define(\"send-message\", $cf2b3c4cbed047e5$var$SendMessage);\n\n\n// @ts-check\nclass $c05bc429e9c442d7$var$ProfileOverlay extends HTMLElement {\n    constructor(){\n        super();\n        this.currentPage = 0;\n    }\n    connectedCallback() {\n        const dialog = this.querySelector(\"dialog\");\n        if (!dialog) return;\n        // display dialog on page load?\n        if (this.dataset.show === \"true\") dialog.showModal();\n        // Success animation\n        let animation = window[\"lottie\"].loadAnimation({\n            container: document.querySelector(\".profile__success-animation\"),\n            path: \"/static/animations/animation_1722611146876.json\",\n            renderer: \"svg\",\n            loop: false,\n            autoplay: false\n        });\n        const changePage = (newPageIndex)=>{\n            let pages = this.querySelectorAll(\".profile__page\");\n            pages.forEach((page, pageIndex)=>{\n                if (pageIndex === newPageIndex) {\n                    page.classList.remove(\"profile--hidden\");\n                    /** @type {HTMLInputElement | null} */ const firstInteractiveElement = page.querySelector(`input[type=\"text\"], input[checked], textarea, .profile__button-finish`);\n                    firstInteractiveElement?.focus();\n                } else page.classList.add(\"profile--hidden\");\n            });\n            // play animation if it's the final page\n            if (newPageIndex === pages.length - 1) {\n                console.log(\"Time to deal with animation\");\n                const userPrefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\n                if (userPrefersReducedMotion) animation.goToAndStop(animation.totalFrames - 1, true);\n                else animation.play();\n            }\n        };\n        changePage(this.currentPage);\n        let nextButtons = this.querySelectorAll(`button[data-action=\"next\"]`);\n        nextButtons.forEach((nextButton)=>{\n            nextButton.addEventListener(\"click\", ()=>{\n                let checksPassed = true;\n                /** @type {NodeListOf<HTMLInputElement> | undefined} */ let inputs = nextButton.closest(\".profile-page\")?.querySelectorAll(\"input, textarea\");\n                inputs?.forEach((input)=>{\n                    if (!input.checkValidity()) {\n                        input.reportValidity();\n                        checksPassed = false;\n                    }\n                });\n                if (checksPassed) {\n                    this.currentPage++;\n                    changePage(this.currentPage);\n                }\n            });\n        });\n        let previousButtons = this.querySelectorAll(`button[data-action=\"previous\"]`);\n        previousButtons.forEach((previousButton)=>{\n            previousButton.addEventListener(\"click\", ()=>{\n                this.currentPage--;\n                changePage(this.currentPage);\n            });\n        });\n        let skipButtons = this.querySelectorAll(`button[data-action=\"skip\"]`);\n        skipButtons.forEach((skipButton)=>{\n            skipButton.addEventListener(\"click\", ()=>{\n                this.currentPage++;\n                changePage(this.currentPage);\n            });\n        });\n        // Send data on dialog close\n        dialog.addEventListener(\"close\", ()=>{\n            this.currentPage = 0;\n            /**\n       * Sends data to endpoint, retrying if necessary\n       * @param {FormData} data\n       * @param {number} retry\n       */ const sendData = async (data, retry = 0)=>{\n                const MAX_RETRIES = 10;\n                const RETRY_INTERVAL_SECONDS = 10;\n                const csrfToken = /** @type {HTMLInputElement | null} */ this.querySelector('[name=\"csrfmiddlewaretoken\"]')?.value || \"\";\n                try {\n                    await fetch(`/update-demographics`, {\n                        method: \"POST\",\n                        headers: {\n                            \"X-CSRFToken\": csrfToken\n                        },\n                        body: data\n                    });\n                } catch (err) {\n                    if (retry < MAX_RETRIES) window.setTimeout(()=>{\n                        sendData(data, retry + 1);\n                    }, RETRY_INTERVAL_SECONDS * 1000);\n                }\n            };\n            // Format and send data\n            const formData = new FormData(this.querySelector(\"form\") || undefined);\n            sendData(formData);\n        });\n        let closeButtons = this.querySelectorAll(`button[data-action=\"close\"]`);\n        closeButtons.forEach((closeButton)=>{\n            closeButton.addEventListener(\"click\", ()=>{\n                this.querySelector(\"dialog\")?.close();\n            });\n        });\n    }\n}\ncustomElements.define(\"profile-overlay\", $c05bc429e9c442d7$var$ProfileOverlay);\n\n\nparcelRequire(\"kTS3p\");\n// @ts-check\nclass $8e16970b18dc8c3b$var$ExitFeedback extends HTMLElement {\n    constructor(){\n        super();\n        this.formData = new FormData();\n    }\n    connectedCallback() {\n        /**\n     * @param {\"up\" | \"down\"} direction\n     * @returns\n     */ const thumbIcon = (direction)=>{\n            const id = crypto.randomUUID();\n            return `\n        <svg class=\"exit-feedback__thumb-icon exit-feedback__thumb-icon--${direction}\" width=\"24\" height=\"26\" viewBox=\"0 0 24 26\" fill=\"none\" aria-hidden=\"true\" focusable=\"false\">\n          <path class=\"exit-feedback__thumb-icon-fill\" d=\"M9 22L6.5 22H6V24.5H1L1 10L6 10V12.5H8L11 8.5L13.5 6L15 3.5L15.5 1H17L18 3.5L17.5 6L16 8.5L16.5 9L22.5 9L24 11.5L23 13.5L23.5 15L22.5 17L23 19L21.5 20.5L22 22L20.5 23L11.5 23L9 22Z\" fill=\"none\"/>\n          <mask id=\"${id}\" fill=\"white\">\n            <path d=\"M23.8519 10.4389C23.7381 9.90599 23.4504 9.42597 23.0341 9.07434C22.6178 8.7227 22.0964 8.5194 21.5519 8.4964C21.5519 8.4964 16.8606 8.4964 16.5757 8.47859C17.4904 7.4348 18.012 6.10437 18.0504 4.717C18.0504 2.11191 17.5517 0.612267 16.5258 0.13257C16.1683 -0.000888383 15.7812 -0.0343755 15.4061 0.0357093C15.031 0.105794 14.682 0.2768 14.3969 0.530339L14.1843 0.708444V0.983914C14.0949 2.46652 13.6139 3.89889 12.7903 5.13496C12.0292 6.37375 11.0232 7.44407 9.83379 8.2803L7.07672 12.0407H5.93685V9.66596H0V25.1018H5.93685V22.727H8.06936L11.0022 23.874L19.2235 23.9144C19.7173 23.9345 20.2069 23.8153 20.6362 23.5705C21.0656 23.3257 21.4174 22.9651 21.6517 22.5299C21.7817 22.2688 21.8554 21.9832 21.8681 21.6917C21.8808 21.4003 21.8321 21.1094 21.7253 20.8379C22.0321 20.6709 22.3014 20.4426 22.5165 20.1673C22.7315 19.892 22.8878 19.5755 22.9756 19.2373C23.0648 18.895 23.0833 18.538 23.0298 18.1883C22.9763 17.8385 22.852 17.5034 22.6645 17.2034C22.9524 17.0006 23.1973 16.7429 23.3854 16.4453C23.5735 16.1476 23.7009 15.8157 23.7604 15.4686C23.8136 15.1192 23.7941 14.7625 23.7032 14.4209C23.6123 14.0793 23.4519 13.7602 23.2321 13.4833C23.5847 13.0699 23.8266 12.5737 23.9352 12.0412C24.0438 11.5088 24.0155 10.9575 23.8531 10.4389H23.8519ZM4.74948 23.9144H1.18737V10.8533H4.74948V23.9144ZM22.0506 12.93L21.3596 13.361L21.983 13.8871C22.198 14.0454 22.3672 14.2579 22.4732 14.5031C22.5792 14.7482 22.6181 15.0171 22.5861 15.2822C22.5297 15.5576 22.4022 15.8134 22.2164 16.0244C22.0307 16.2354 21.793 16.3942 21.527 16.485L20.64 16.8472L21.3572 17.48C21.565 17.6538 21.7193 17.8829 21.8023 18.1407C21.8853 18.3985 21.8936 18.6746 21.8262 18.9369C21.7602 19.1899 21.6239 19.4191 21.4331 19.5979C21.2423 19.7767 21.0048 19.8978 20.7481 19.9474L19.8279 20.1457L20.4038 20.8913C20.5406 21.0385 20.6309 21.2229 20.6633 21.4213C20.6956 21.6197 20.6685 21.8232 20.5854 22.0063C20.446 22.2398 20.2452 22.4304 20.0048 22.5575C19.7644 22.6846 19.4937 22.7433 19.2223 22.727H11.3311L8.39589 21.58L5.93685 21.548V13.2281H7.68584L10.5925 9.19695C11.8704 8.2855 12.9534 7.12816 13.7782 5.79276C14.6684 4.45432 15.2103 2.91488 15.3551 1.314C15.4511 1.24726 15.5611 1.20309 15.6766 1.18479C15.7922 1.16649 15.9104 1.17454 16.0224 1.20833C16.2195 1.30094 16.863 1.82576 16.863 4.717C16.8114 5.87441 16.3478 6.97525 15.5557 7.82079C15.3986 7.98506 15.2894 8.18911 15.2398 8.41092C15.1902 8.63273 15.2022 8.86387 15.2743 9.0794C15.5712 9.66596 16.3073 9.66596 17.5256 9.66596H21.5519C22.1741 9.66596 22.5576 10.2359 22.7108 10.7678C22.8439 11.1517 22.8516 11.5679 22.733 11.9565C22.6143 12.3451 22.3754 12.6859 22.0506 12.93Z\"/>\n          </mask>\n          <path d=\"M23.8519 10.4389L21.8959 10.8565L22.2338 12.4389H23.8519V10.4389ZM21.5519 8.4964L21.6364 6.49818L21.5942 6.4964L21.5519 6.4964L21.5519 8.4964ZM16.5757 8.47859L15.0716 7.1604L12.3894 10.2208L16.4509 10.4747L16.5757 8.47859ZM18.0504 4.717L20.0496 4.77229L20.0504 4.74465V4.717L18.0504 4.717ZM16.5258 0.13257L17.373 -1.67915L17.3004 -1.7131L17.2253 -1.74113L16.5258 0.13257ZM14.3969 0.530339L15.6814 2.06326L15.7038 2.0445L15.7257 2.02508L14.3969 0.530339ZM14.1843 0.708444L12.8997 -0.824482L12.1843 -0.224965V0.708444H14.1843ZM14.1843 0.983914L16.1807 1.10431L16.1843 1.04416V0.983914H14.1843ZM12.7903 5.13496L11.1259 4.02601L11.1055 4.05664L11.0863 4.08799L12.7903 5.13496ZM9.83379 8.2803L8.68348 6.64421L8.41496 6.833L8.22087 7.09772L9.83379 8.2803ZM7.07672 12.0407V14.0407H8.09032L8.68964 13.2233L7.07672 12.0407ZM5.93685 12.0407H3.93685V14.0407H5.93685V12.0407ZM5.93685 9.66596H7.93685V7.66596H5.93685V9.66596ZM0 9.66596V7.66596H-2V9.66596H0ZM0 25.1018H-2V27.1018H0V25.1018ZM5.93685 25.1018V27.1018H7.93685V25.1018H5.93685ZM5.93685 22.727V20.727H3.93685V22.727H5.93685ZM8.06936 22.727L8.79782 20.8644L8.44654 20.727H8.06936V22.727ZM11.0022 23.874L10.2737 25.7366L10.6202 25.8722L10.9923 25.874L11.0022 23.874ZM19.2235 23.9144L19.3047 21.916L19.2691 21.9146L19.2333 21.9144L19.2235 23.9144ZM21.6517 22.5299L23.4128 23.4778L23.4279 23.4498L23.442 23.4213L21.6517 22.5299ZM21.7253 20.8379L20.769 19.0813L19.2171 19.9262L19.8643 21.5704L21.7253 20.8379ZM22.9756 19.2373L21.0403 18.7329L21.0398 18.7347L22.9756 19.2373ZM22.6645 17.2034L21.5126 15.5684L19.9655 16.6584L20.9684 18.2633L22.6645 17.2034ZM23.7604 15.4686L25.7317 15.8067L25.7349 15.7881L25.7377 15.7694L23.7604 15.4686ZM23.2321 13.4833L21.7103 12.1856L20.6422 13.4381L21.6659 14.7272L23.2321 13.4833ZM23.8531 10.4389L25.7616 9.84091L25.3223 8.43893H23.8531V10.4389ZM4.74948 23.9144V25.9144H6.74948V23.9144H4.74948ZM1.18737 23.9144H-0.812631V25.9144H1.18737V23.9144ZM1.18737 10.8533V8.85333H-0.812631V10.8533H1.18737ZM4.74948 10.8533H6.74948V8.85333H4.74948V10.8533ZM22.0506 12.93L23.1091 14.627L23.1828 14.581L23.2522 14.5288L22.0506 12.93ZM21.3596 13.361L20.3012 11.6641L17.9702 13.1179L20.0698 14.8896L21.3596 13.361ZM21.983 13.8871L20.6932 15.4156L20.7439 15.4584L20.7974 15.4978L21.983 13.8871ZM22.5861 15.2822L24.5454 15.684L24.5619 15.6035L24.5717 15.5219L22.5861 15.2822ZM21.527 16.485L20.8805 14.5924L20.8252 14.6113L20.771 14.6334L21.527 16.485ZM20.64 16.8472L19.884 14.9956L16.8998 16.214L19.3167 18.3468L20.64 16.8472ZM21.3572 17.48L20.0339 18.9796L20.0537 18.9971L20.074 19.0141L21.3572 17.48ZM21.8262 18.9369L23.7613 19.4423L23.7634 19.4343L21.8262 18.9369ZM20.7481 19.9474L20.3691 17.9836L20.3479 17.9877L20.3268 17.9923L20.7481 19.9474ZM19.8279 20.1457L19.4066 18.1906L16.3068 18.8585L18.245 21.3681L19.8279 20.1457ZM20.4038 20.8913L18.8208 22.1138L18.8769 22.1863L18.9393 22.2534L20.4038 20.8913ZM20.5854 22.0063L22.3027 23.0315L22.3602 22.9352L22.4066 22.833L20.5854 22.0063ZM19.2223 22.727L19.3419 20.7306L19.2822 20.727H19.2223V22.727ZM11.3311 22.727L10.6031 24.5898L10.9542 24.727H11.3311V22.727ZM8.39589 21.58L9.12383 19.7172L8.78534 19.5849L8.42196 19.5802L8.39589 21.58ZM5.93685 21.548H3.93685V23.5221L5.91077 23.5478L5.93685 21.548ZM5.93685 13.2281V11.2281H3.93685V13.2281H5.93685ZM7.68584 13.2281V15.2281H8.70943L9.30809 14.3978L7.68584 13.2281ZM10.5925 9.19695L9.43114 7.56869L9.16294 7.75999L8.97027 8.0272L10.5925 9.19695ZM13.7782 5.79276L12.1129 4.68523L12.0943 4.7132L12.0766 4.74178L13.7782 5.79276ZM15.3551 1.314L14.2141 -0.32859L13.4472 0.204067L13.3632 1.13394L15.3551 1.314ZM16.0224 1.20833L16.8729 -0.601805L16.7403 -0.664117L16.6 -0.706437L16.0224 1.20833ZM16.863 4.717L18.861 4.80605L18.863 4.76155V4.717H16.863ZM15.5557 7.82079L17.0013 9.20297L17.0083 9.19556L17.0154 9.18807L15.5557 7.82079ZM15.2743 9.0794L13.3778 9.71434L13.424 9.85249L13.4898 9.98248L15.2743 9.0794ZM22.7108 10.7678L20.7889 11.3212L20.8036 11.3724L20.8211 11.4228L22.7108 10.7678ZM25.8078 10.0214C25.6015 9.05479 25.0797 8.18416 24.3246 7.5464L21.7436 10.6023C21.8212 10.6678 21.8747 10.7572 21.8959 10.8565L25.8078 10.0214ZM24.3246 7.5464C23.5695 6.90863 22.6239 6.53991 21.6364 6.49818L21.4675 10.4946C21.5689 10.4989 21.6661 10.5368 21.7436 10.6023L24.3246 7.5464ZM21.5519 8.4964C21.5519 6.4964 21.5519 6.4964 21.5519 6.4964C21.5519 6.4964 21.5518 6.4964 21.5517 6.4964C21.5516 6.4964 21.5514 6.4964 21.5511 6.4964C21.5506 6.4964 21.5497 6.4964 21.5486 6.4964C21.5464 6.4964 21.543 6.4964 21.5386 6.4964C21.5297 6.4964 21.5166 6.4964 21.4994 6.49639C21.4651 6.49639 21.4147 6.49638 21.3503 6.49636C21.2217 6.49633 21.0376 6.49626 20.8157 6.49612C20.3719 6.49584 19.7775 6.49529 19.1744 6.49418C18.5708 6.49306 17.9603 6.4914 17.4839 6.48891C16.9568 6.48616 16.6971 6.48227 16.7004 6.48248L16.4509 10.4747C16.6735 10.4886 18.0218 10.4921 19.167 10.4942C19.7723 10.4953 20.3685 10.4958 20.8132 10.4961C21.0356 10.4963 21.2202 10.4963 21.3493 10.4964C21.4138 10.4964 21.4644 10.4964 21.4989 10.4964C21.5162 10.4964 21.5294 10.4964 21.5383 10.4964C21.5428 10.4964 21.5462 10.4964 21.5485 10.4964C21.5496 10.4964 21.5505 10.4964 21.5511 10.4964C21.5513 10.4964 21.5516 10.4964 21.5517 10.4964C21.5518 10.4964 21.5518 10.4964 21.5519 10.4964C21.5519 10.4964 21.5519 10.4964 21.5519 8.4964ZM18.0798 9.79678C19.3017 8.40256 19.9984 6.62545 20.0496 4.77229L16.0511 4.66172C16.0257 5.5833 15.6792 6.46705 15.0716 7.1604L18.0798 9.79678ZM20.0504 4.717C20.0504 3.31825 19.9205 2.04875 19.5706 0.996643C19.2162 -0.0690195 18.5575 -1.12528 17.373 -1.67915L15.6787 1.94429C15.52 1.87011 15.6236 1.80353 15.775 2.25889C15.9309 2.7278 16.0504 3.51066 16.0504 4.717H20.0504ZM17.2253 -1.74113C16.5272 -2.00174 15.7712 -2.06713 15.0388 -1.93027L15.7734 2.00169C15.7911 1.99837 15.8094 1.99996 15.8263 2.00627L17.2253 -1.74113ZM15.0388 -1.93027C14.3063 -1.79342 13.6249 -1.45949 13.068 -0.964401L15.7257 2.02508C15.7392 2.01309 15.7557 2.005 15.7734 2.00169L15.0388 -1.93027ZM13.1123 -1.00259L12.8997 -0.824482L15.4689 2.24137L15.6814 2.06326L13.1123 -1.00259ZM12.1843 0.708444V0.983914H16.1843V0.708444H12.1843ZM12.1879 0.86352C12.1198 1.99305 11.7534 3.08431 11.1259 4.02601L14.4547 6.2439C15.4744 4.71347 16.07 2.93998 16.1807 1.10431L12.1879 0.86352ZM11.0863 4.08799C10.4677 5.09476 9.65009 5.9646 8.68348 6.64421L10.9841 9.91639C12.3962 8.92353 13.5908 7.65274 14.4944 6.18192L11.0863 4.08799ZM8.22087 7.09772L5.4638 10.8581L8.68964 13.2233L11.4467 9.46287L8.22087 7.09772ZM7.07672 10.0407H5.93685V14.0407H7.07672V10.0407ZM7.93685 12.0407V9.66596H3.93685V12.0407H7.93685ZM5.93685 7.66596H0V11.666H5.93685V7.66596ZM-2 9.66596V25.1018H2V9.66596H-2ZM0 27.1018H5.93685V23.1018H0V27.1018ZM7.93685 25.1018V22.727H3.93685V25.1018H7.93685ZM5.93685 24.727H8.06936V20.727H5.93685V24.727ZM7.3409 24.5896L10.2737 25.7366L11.7306 22.0114L8.79782 20.8644L7.3409 24.5896ZM10.9923 25.874L19.2137 25.9144L19.2333 21.9144L11.012 21.874L10.9923 25.874ZM19.1423 25.9127C20.0108 25.948 20.8717 25.7385 21.6268 25.3079L19.6456 21.8331C19.542 21.8921 19.4239 21.9209 19.3047 21.916L19.1423 25.9127ZM21.6268 25.3079C22.3819 24.8774 23.0008 24.2432 23.4128 23.4778L19.8906 21.582C19.8341 21.687 19.7492 21.774 19.6456 21.8331L21.6268 25.3079ZM23.442 23.4213C23.6969 22.9095 23.8414 22.3499 23.8662 21.7787L19.87 21.6048C19.8695 21.6165 19.8665 21.628 19.8613 21.6385L23.442 23.4213ZM23.8662 21.7787C23.8911 21.2075 23.7957 20.6374 23.5863 20.1054L19.8643 21.5704C19.8686 21.5814 19.8705 21.5931 19.87 21.6048L23.8662 21.7787ZM22.6816 22.5945C23.2288 22.2966 23.709 21.8895 24.0926 21.3985L20.9403 18.9361C20.8938 18.9957 20.8355 19.0452 20.769 19.0813L22.6816 22.5945ZM24.0926 21.3985C24.4761 20.9075 24.7548 20.343 24.9114 19.74L21.0398 18.7347C21.0208 18.8079 20.9869 18.8765 20.9403 18.9361L24.0926 21.3985ZM24.9109 19.7418C25.0688 19.1361 25.1014 18.5046 25.0068 17.8859L21.0528 18.4907C21.0651 18.5714 21.0609 18.6538 21.0403 18.7329L24.9109 19.7418ZM25.0068 17.8859C24.9122 17.2672 24.6923 16.6743 24.3606 16.1435L20.9684 18.2633C21.0117 18.3325 21.0404 18.4099 21.0528 18.4907L25.0068 17.8859ZM23.8164 18.8384C24.3194 18.484 24.7476 18.0337 25.0763 17.5135L21.6946 15.3771C21.6471 15.4522 21.5853 15.5172 21.5126 15.5684L23.8164 18.8384ZM25.0763 17.5135C25.4049 16.9932 25.6277 16.4132 25.7317 15.8067L21.7892 15.1306C21.7742 15.2182 21.742 15.3019 21.6946 15.3771L25.0763 17.5135ZM25.7377 15.7694C25.8322 15.148 25.7976 14.5139 25.6359 13.9065L21.7705 14.9353C21.7907 15.0111 21.795 15.0903 21.7832 15.1679L25.7377 15.7694ZM25.6359 13.9065C25.4743 13.2992 25.1891 12.7317 24.7982 12.2395L21.6659 14.7272C21.7147 14.7886 21.7503 14.8595 21.7705 14.9353L25.6359 13.9065ZM24.7539 14.7811C25.326 14.1101 25.7186 13.305 25.8948 12.441L21.9756 11.6415C21.9346 11.8424 21.8433 12.0296 21.7103 12.1856L24.7539 14.7811ZM25.8948 12.441C26.0711 11.577 26.0252 10.6824 25.7616 9.84091L21.9446 11.037C22.0059 11.2326 22.0165 11.4406 21.9756 11.6415L25.8948 12.441ZM23.8531 8.43893H23.8519V12.4389H23.8531V8.43893ZM4.74948 21.9144H1.18737V25.9144H4.74948V21.9144ZM3.18737 23.9144V10.8533H-0.812631V23.9144H3.18737ZM1.18737 12.8533H4.74948V8.85333H1.18737V12.8533ZM2.74948 10.8533V23.9144H6.74948V10.8533H2.74948ZM20.9922 11.2331L20.3012 11.6641L22.418 15.058L23.1091 14.627L20.9922 11.2331ZM20.0698 14.8896L20.6932 15.4156L23.2727 12.3585L22.6494 11.8325L20.0698 14.8896ZM20.7974 15.4978C20.7272 15.4461 20.672 15.3767 20.6374 15.2968L24.309 13.7094C24.0624 13.1392 23.6689 12.6446 23.1685 12.2763L20.7974 15.4978ZM20.6374 15.2968C20.6028 15.2168 20.5901 15.129 20.6005 15.0425L24.5717 15.5219C24.6462 14.9051 24.5555 14.2796 24.309 13.7094L20.6374 15.2968ZM20.6269 14.8804C20.6404 14.8145 20.671 14.7532 20.7154 14.7027L23.7175 17.3461C24.1335 16.8737 24.4189 16.3007 24.5454 15.684L20.6269 14.8804ZM20.7154 14.7027C20.7599 14.6522 20.8168 14.6141 20.8805 14.5924L22.1735 18.3776C22.7692 18.1742 23.3014 17.8186 23.7175 17.3461L20.7154 14.7027ZM20.771 14.6334L19.884 14.9956L21.396 18.6988L22.283 18.3366L20.771 14.6334ZM19.3167 18.3468L20.0339 18.9796L22.6805 15.9804L21.9634 15.3476L19.3167 18.3468ZM20.074 19.0141C19.9921 18.9456 19.9312 18.8553 19.8985 18.7536L23.7061 17.5278C23.5073 16.9105 23.1379 16.362 22.6404 15.9459L20.074 19.0141ZM19.8985 18.7536C19.8658 18.6519 19.8625 18.543 19.8891 18.4396L23.7634 19.4343C23.9247 18.8062 23.9048 18.1452 23.7061 17.5278L19.8985 18.7536ZM19.8911 18.4316C19.9204 18.3194 19.9808 18.2179 20.0654 18.1386L22.8007 21.0571C23.2669 20.6203 23.5999 20.0604 23.7613 19.4423L19.8911 18.4316ZM20.0654 18.1386C20.15 18.0593 20.2553 18.0056 20.3691 17.9836L21.1271 21.9112C21.7544 21.7901 22.3346 21.494 22.8007 21.0571L20.0654 18.1386ZM20.3268 17.9923L19.4066 18.1906L20.2492 22.1008L21.1694 21.9025L20.3268 17.9923ZM18.245 21.3681L18.8208 22.1138L21.9867 19.6689L21.4108 18.9232L18.245 21.3681ZM18.9393 22.2534C18.8074 22.1117 18.7204 21.9341 18.6893 21.743L22.6372 21.0997C22.5414 20.5118 22.2739 19.9654 21.8682 19.5293L18.9393 22.2534ZM18.6893 21.743C18.6582 21.5519 18.6843 21.3558 18.7643 21.1796L22.4066 22.833C22.6528 22.2907 22.733 21.6876 22.6372 21.0997L18.6893 21.743ZM18.8682 20.9811C18.9166 20.8999 18.9864 20.8337 19.07 20.7895L20.9397 24.3256C21.504 24.0272 21.9754 23.5796 22.3027 23.0315L18.8682 20.9811ZM19.07 20.7895C19.1535 20.7453 19.2476 20.7249 19.3419 20.7306L19.1028 24.7234C19.7399 24.7616 20.3754 24.624 20.9397 24.3256L19.07 20.7895ZM19.2223 20.727H11.3311V24.727H19.2223V20.727ZM12.059 20.8642L9.12383 19.7172L7.66794 23.4428L10.6031 24.5898L12.059 20.8642ZM8.42196 19.5802L5.96292 19.5481L5.91077 23.5478L8.36981 23.5798L8.42196 19.5802ZM7.93685 21.548V13.2281H3.93685V21.548H7.93685ZM5.93685 15.2281H7.68584V11.2281H5.93685V15.2281ZM9.30809 14.3978L12.2148 10.3667L8.97027 8.0272L6.06359 12.0583L9.30809 14.3978ZM11.7539 10.8252C13.2484 9.75919 14.5152 8.4056 15.4798 6.84374L12.0766 4.74178C11.3917 5.85073 10.4923 6.81181 9.43114 7.56869L11.7539 10.8252ZM15.4436 6.90029C16.518 5.28468 17.1723 3.42645 17.3469 1.49407L13.3632 1.13394C13.2484 2.4033 12.8187 3.62395 12.1129 4.68523L15.4436 6.90029ZM16.4961 2.95659C16.3447 3.06175 16.1715 3.13134 15.9894 3.16017L15.3638 -0.790593C14.9506 -0.725165 14.5576 -0.567232 14.2141 -0.32859L16.4961 2.95659ZM15.9894 3.16017C15.8074 3.189 15.6212 3.17633 15.4447 3.12309L16.6 -0.706437C16.1995 -0.827253 15.7769 -0.856022 15.3638 -0.790593L15.9894 3.16017ZM15.1718 3.01846C14.6598 2.77785 14.577 2.43352 14.6396 2.60385C14.7117 2.79961 14.863 3.39157 14.863 4.717H18.863C18.863 3.15119 18.6926 2.03512 18.3936 1.22251C18.0852 0.384468 17.5821 -0.268581 16.8729 -0.601805L15.1718 3.01846ZM14.865 4.62795C14.8347 5.3087 14.5619 5.95618 14.0961 6.4535L17.0154 9.18807C18.1336 7.99432 18.7882 6.44012 18.861 4.80605L14.865 4.62795ZM14.1102 6.4386C13.7014 6.86615 13.4171 7.39723 13.288 7.97452L17.1916 8.84731C17.1617 8.98099 17.0959 9.10397 17.0013 9.20297L14.1102 6.4386ZM13.288 7.97452C13.1589 8.55182 13.19 9.1534 13.3778 9.71434L17.1709 8.44445C17.2143 8.57434 17.2215 8.71364 17.1916 8.84731L13.288 7.97452ZM13.4898 9.98248C14.017 11.0242 14.9494 11.4139 15.6691 11.5552C16.278 11.6747 16.9954 11.666 17.5256 11.666V7.66596C17.2107 7.66596 16.9765 7.66568 16.7764 7.65819C16.5744 7.65063 16.4776 7.63755 16.4397 7.63011C16.4037 7.62302 16.5047 7.63646 16.6527 7.73052C16.7303 7.77983 16.8118 7.84565 16.8877 7.92932C16.9635 8.01292 17.0195 8.09864 17.0588 8.17631L13.4898 9.98248ZM17.5256 11.666H21.5519V7.66596H17.5256V11.666ZM21.5519 11.666C21.3911 11.666 21.2313 11.6267 21.093 11.5588C20.9619 11.4945 20.8797 11.4195 20.8373 11.3736C20.7669 11.2973 20.7743 11.2705 20.7889 11.3212L24.6327 10.2144C24.4942 9.73325 24.2332 9.15553 23.7772 8.66125C23.2955 8.13909 22.5412 7.66596 21.5519 7.66596V11.666ZM20.8211 11.4228C20.8154 11.4065 20.8151 11.3889 20.8201 11.3724L24.6458 12.5405C24.8881 11.7469 24.8723 10.8969 24.6005 10.1129L20.8211 11.4228ZM20.8201 11.3724C20.8252 11.356 20.8353 11.3416 20.849 11.3312L23.2522 14.5288C23.9155 14.0303 24.4035 13.3341 24.6458 12.5405L20.8201 11.3724Z\" fill=\"currentColor\" mask=\"url(#${id}\"/>\n        </svg>\n      `;\n        };\n        this.innerHTML = `\n      <form class=\"exit-feedback__panel\" id=\"exit-feedback__panel\">\n        <div class=\"exit-feedback__page\">\n          <div class=\"exit-feedback__question-container\">\n            <p tabindex=\"-1\">Did Redbox do what you needed it to in this chat?</p>\n            <button type=\"button\" class=\"exit-feedback__button exit-feedback__button--yes\">\n              ${thumbIcon(\"up\")}\n              <span class=\"govuk-visually-hidden\">Yes, Redbox did what I needed it to in this chat</span>\n            </button>\n            <button type=\"button\" class=\"exit-feedback__button exit-feedback__button--no\">\n              ${thumbIcon(\"down\")}\n              <span class=\"govuk-visually-hidden\">Redbox didn't do what I needed it to in this chat</span>\n            </button>\n          </div>\n        </div>\n        <div class=\"exit-feedback__page\">\n          <fieldset class=\"exit-feedback__question-container exit-feedback__question-container--small\">\n            <div>\n              <legend>Did Redbox help save you time?</legend>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-time-yes\" name=\"saved_time\" value=\"Yes\"/>\n              <label for=\"exit-feedback__input-time-yes\">\n                ${thumbIcon(\"up\")}\n                <span class=\"govuk-visually-hidden\">Yes</span>\n              </label>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-time-no\" name=\"saved_time\" value=\"No\"/>\n              <label for=\"exit-feedback__input-time-no\">\n                ${thumbIcon(\"down\")}\n                <span class=\"govuk-visually-hidden\">No</span>\n              </label>\n            </div>\n          </fieldset>\n          <fieldset class=\"exit-feedback__question-container exit-feedback__question-container--small\">\n            <div>\n              <legend>Did Redbox help to improve your work?</legend>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-improve-work-yes\" name=\"improved_work\" value=\"Yes\"/>\n              <label for=\"exit-feedback__input-improve-work-yes\">\n                ${thumbIcon(\"up\")}\n                <span class=\"govuk-visually-hidden\">Yes</span>\n              </label>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-improve-work-no\" name=\"improved_work\" value=\"No\"/>\n              <label for=\"exit-feedback__input-improve-work-no\">\n                ${thumbIcon(\"down\")}\n                <span class=\"govuk-visually-hidden\">No</span>\n              </label>\n            </div>\n          </fieldset>\n          <label class=\"govuk-!-display-block govuk-!-margin-bottom-1 govuk-!-margin-top-2\" for=\"exit-feedback__input-notes\">Do you want to tell us anything more?</label>\n          <textarea class=\"exit-feedback__input-notes govuk-textarea govuk-!-margin-bottom-3\" id=\"exit-feedback__input-notes\" name=\"notes\" rows=\"1\"></textarea>\n          <button type=\"button\" class=\"exit-feedback__send-button govuk-button\">Send</button>\n        </div>\n        <div class=\"exit-feedback__page\">\n          <div class=\"exit-feedback__confirmation-container\">\n            <div class=\"exit-feedback__tick-animation\" aria-hidden=\"true\">\n              <div></div>\n            </div>\n            <div>\n              <p class=\"exit-feedback__confirmation-text govuk-body-s\" tabindex=\"-1\">Thanks for helping to improve Redbox</p>\n              <button type=\"button\" class=\"exit-feedback__dismiss\">Dismiss</button>\n            </div>\n          </div>\n        </div>\n      </form>\n      <button type=\"button\" class=\"exit-feedback__toggle-button\" aria-expanded=\"false\" aria-controls=\"exit-feedback__panel\">\n        <svg class=\"exit-feedback__toggle-button-icon\" aria-hidden=\"true\" focusable=\"false\" width=\"37\" height=\"37\" viewBox=\"0 0 37 37\" fill=\"none\">\n          <path d=\"M9 17L27 12V24L9 20V17Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n          <path d=\"M17.5997 22.8C17.4947 23.1808 17.3156 23.5373 17.0728 23.8489C16.83 24.1605 16.5282 24.4213 16.1847 24.6163C15.8411 24.8113 15.4625 24.9367 15.0704 24.9854C14.6784 25.0341 14.2806 25.0051 13.8997 24.9C13.5189 24.795 13.1625 24.6159 12.8508 24.3731C12.5392 24.1303 12.2784 23.8285 12.0834 23.4849C11.8884 23.1414 11.763 22.7627 11.7143 22.3707C11.6657 21.9786 11.6947 21.5808 11.7997 21.2\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n        </svg>\n        <span class=\"exit-feedback__toggle-button-text\">Feedback</span>\n      </button>\n    `;\n        this.animation = window[\"lottie\"].loadAnimation({\n            container: document.querySelector(\".exit-feedback__tick-animation > div\"),\n            path: \"/static/animations/success_tick_red.json\",\n            renderer: \"svg\",\n            loop: false,\n            autoplay: false\n        });\n        const toggleButton = this.querySelector(\".exit-feedback__toggle-button\");\n        toggleButton?.addEventListener(\"click\", ()=>{\n            if (toggleButton.getAttribute(\"aria-expanded\") === \"true\") toggleButton.setAttribute(\"aria-expanded\", \"false\");\n            else {\n                toggleButton.setAttribute(\"aria-expanded\", \"true\");\n                this.#changePage(0);\n            }\n        });\n        this.querySelector(\".exit-feedback__dismiss\")?.addEventListener(\"click\", ()=>{\n            toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n        });\n        // close menu if focus moves out of it\n        let lastInteractionWasKeyboard = false;\n        document.addEventListener(\"keydown\", ()=>{\n            lastInteractionWasKeyboard = true;\n        });\n        document.addEventListener(\"mousedown\", ()=>{\n            lastInteractionWasKeyboard = false;\n        });\n        this.addEventListener(\"focusout\", ()=>{\n            window.setTimeout(()=>{\n                if (!this.contains(document.activeElement) && lastInteractionWasKeyboard) toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n            }, 100);\n        });\n        // close menu if user clicks away from it\n        document.body.addEventListener(\"click\", (evt)=>{\n            const targetElement = /** @type {HTMLElement | null} */ evt.target;\n            if (!targetElement?.closest(\".exit-feedback\")) toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n        });\n        // page 1\n        this.#changePage(0);\n        this.querySelector(\".exit-feedback__button--yes\")?.addEventListener(\"click\", ()=>{\n            this.formData.set(\"achieved\", \"Yes\");\n            this.#changePage(1);\n            this.#sendFeedback();\n        });\n        this.querySelector(\".exit-feedback__button--no\")?.addEventListener(\"click\", ()=>{\n            this.formData.set(\"achieved\", \"No\");\n            this.#changePage(1);\n            this.#sendFeedback();\n        });\n        // page 2\n        this.querySelector(\".exit-feedback__send-button\")?.addEventListener(\"click\", ()=>{\n            const form = this.querySelector(\"form\");\n            if (!form) return;\n            for (let [key, value] of new FormData(form).entries())this.formData.set(key, value);\n            this.#changePage(2);\n            this.#sendFeedback();\n        });\n    }\n    /**\n   * @param {number} newPage zero-based\n   */ #changePage(newPage) {\n        /** @type {NodeListOf<HTMLElement>} */ let pages = this.querySelectorAll(\".exit-feedback__page\");\n        pages.forEach((page, pageIndex)=>{\n            if (pageIndex === newPage) {\n                page.style.display = \"block\";\n                window.setTimeout(()=>{\n                    /** @type {HTMLElement | null} */ const firstInteractiveElement = page.querySelector('[tabindex=\"-1\"], input, button');\n                    firstInteractiveElement?.focus();\n                }, 100);\n            } else page.style.display = \"none\";\n        });\n        // start animation if final page\n        if (newPage === pages.length - 1) {\n            const userPrefersReducedMotion = window.matchMedia(\"(prefers-reduced-motion: reduce)\").matches;\n            if (userPrefersReducedMotion) this.animation.goToAndStop(this.animation.totalFrames - 1, true);\n            else this.animation.play();\n        }\n    }\n    async #sendFeedback() {\n        try {\n            await fetch(`/chats/${this.dataset.chatid}/update-chat-feedback`, {\n                method: \"POST\",\n                headers: {\n                    \"X-CSRFToken\": this.dataset.csrf || \"\"\n                },\n                body: this.formData\n            });\n        } catch (err) {\n            console.log(\"Error sending exit feedback data\", err);\n        }\n    }\n}\ncustomElements.define(\"exit-feedback\", $8e16970b18dc8c3b$var$ExitFeedback);\n\n\ndocument.addEventListener(\"chat-response-end\", (evt)=>{\n    // Update URL when a new chat is created\n    const sessionId = /** @type{CustomEvent} */ evt.detail.session_id;\n    const sessionTitle = /** @type{CustomEvent} */ evt.detail.title;\n    window.history.pushState({}, \"\", `/chats/${sessionId}`);\n    // And add to chat history\n    document.querySelector(\"chat-history\").addChat(sessionId, sessionTitle);\n});\n\n})();\n//# sourceMappingURL=chats.js.map\n","// @ts-check\n\nclass LoadingMessage extends HTMLElement {\n  connectedCallback() {\n    this.innerHTML = `\n      <div class=\"rb-loading-ellipsis govuk-body-s\" aria-label=\"${\n        this.dataset.dataAriaLabel || this.dataset.message || \"Loading\"\n      }\">\n        ${this.dataset.message || \"Loading\"}\n        <span aria-hidden=\"true\">.</span>\n        <span aria-hidden=\"true\">.</span>\n        <span aria-hidden=\"true\">.</span>\n      </div>\n    `;\n  }\n}\ncustomElements.define(\"loading-message\", LoadingMessage);\n","// @ts-check\n\n/** @type {import ('showdown')} */\nlet showdown = window[\"showdown\"];\n\nexport class MarkdownConverter extends HTMLElement {\n  /**\n   * Takes markdown and inserts as HTML\n   * @param {string} markdown\n   */\n  update(markdown) {\n    let converter = new showdown.Converter({\n      disableForced4SpacesIndentedSublists: true,\n      headerLevelStart: 3,\n      tables: true,\n    });\n    this.innerHTML = converter.makeHtml(markdown);\n  }\n\n  connectedCallback() {\n    this.update(this.textContent || \"\");\n  }\n}\ncustomElements.define(\"markdown-converter\", MarkdownConverter);\n","// @ts-check\n\nclass FileStatus extends HTMLElement {\n  connectedCallback() {\n    const checkStatus = async () => {\n      // UPDATE THESE AS REQUIRED\n      const FILE_STATUS_ENDPOINT = \"/file-status\";\n      const CHECK_INTERVAL_MS = 6000;\n\n      const response = await fetch(\n        `${FILE_STATUS_ENDPOINT}?id=${this.dataset.id}`\n      );\n      const responseObj = await response.json();\n      this.textContent = responseObj.status;\n      this.dataset.status = responseObj.status.toLowerCase();\n\n      if (responseObj.status.toLowerCase() === \"complete\") {\n        const evt = new CustomEvent(\"doc-complete\", {\n          detail: this,\n        });\n        document.body.dispatchEvent(evt);\n      } else {\n        window.setTimeout(checkStatus, CHECK_INTERVAL_MS);\n      }\n    };\n\n    checkStatus();\n  }\n}\ncustomElements.define(\"file-status\", FileStatus);\n","import \"./web-components/chats/chat-controller.js\";\nimport \"./web-components/chats/chat-history.js\";\nimport \"./web-components/chats/chat-history-item.js\";\nimport \"./web-components/chats/chat-message.js\";\nimport \"./web-components/chats/chat-title.js\";\nimport \"./web-components/chats/copy-text.js\";\nimport \"./web-components/chats/document-selector.js\";\nimport \"./web-components/chats/feedback-buttons.js\";\nimport \"./web-components/markdown-converter.js\";\nimport \"./web-components/chats/message-input.js\";\nimport \"./web-components/chats/sources-list.js\";\nimport \"./web-components/chats/canned-prompts\";\nimport \"./web-components/chats/send-message.js\";\nimport \"./web-components/chats/profile-overlay.js\";\nimport \"./web-components/documents/file-status.js\";\nimport \"./web-components/chats/profile-overlay.js\";\nimport \"./web-components/chats/exit-feedback.js\";\n\ndocument.addEventListener(\"chat-response-end\", (evt) => {\n  \n  // Update URL when a new chat is created\n  const sessionId = /** @type{CustomEvent} */ (evt).detail.session_id;\n  const sessionTitle = /** @type{CustomEvent} */ (evt).detail.title;\n  window.history.pushState({}, \"\", `/chats/${sessionId}`);\n\n  // And add to chat history\n  document.querySelector(\"chat-history\").addChat(sessionId, sessionTitle);\n});\n","// @ts-check\n\nclass ChatController extends HTMLElement {\n  connectedCallback() {\n    const messageForm = this.closest(\"form\");\n    const messageContainer = this.querySelector(\".js-message-container\");\n    const insertPosition = this.querySelector(\".js-response-feedback\");\n    const feedbackButtons = /** @type {HTMLElement | null} */ (\n      this.querySelector(\"feedback-buttons\")\n    );\n    let selectedDocuments = [];\n\n    messageForm?.addEventListener(\"submit\", (evt) => {\n      evt.preventDefault();\n      const messageInput = /** @type {MessageInput | null} */ (\n        document.querySelector(\"message-input\")\n      );\n      const userText = messageInput?.getValue();\n      if (!messageInput || !userText) {\n        return;\n      }\n\n      let userMessage = /** @type {import(\"./chat-message\").ChatMessage} */ (\n        document.createElement(\"chat-message\")\n      );\n      userMessage.setAttribute(\"data-text\", userText);\n      userMessage.setAttribute(\"data-role\", \"user\");\n      messageContainer?.insertBefore(userMessage, insertPosition);\n\n      const activites = [\n        `You selected ${selectedDocuments.length || \"no\"} document${selectedDocuments.length === 1 ? \"\" : \"s\"}`,\n        \"You sent this prompt\"\n      ];\n      // add filename to activity if only one file\n      if (selectedDocuments.length === 1) {\n        activites[0] += ` (${selectedDocuments[0].name})`;\n      }\n      activites.forEach((activity) => {\n        userMessage.addActivity(activity, \"user\");\n      });\n\n      let aiMessage = /** @type {import(\"./chat-message\").ChatMessage} */ (\n        document.createElement(\"chat-message\")\n      );\n      aiMessage.setAttribute(\"data-role\", \"ai\");\n      messageContainer?.insertBefore(aiMessage, insertPosition);\n\n      const llm = /** @type {HTMLInputElement | null}*/ (\n        document.querySelector(\"#llm-selector\")\n      )?.value || \"\";\n\n      aiMessage.stream(\n        userText,\n        selectedDocuments.map(doc => doc.id),\n        activites,\n        llm,\n        this.dataset.sessionId,\n        this.dataset.streamUrl || \"\",\n        this\n      );\n      /** @type {HTMLElement | null} */ (\n        aiMessage.querySelector(\".iai-chat-bubble\")\n      )?.focus();\n\n      // reset UI\n      if (feedbackButtons) {\n        feedbackButtons.dataset.status = \"\";\n      }\n      messageInput.reset();\n\n      // if a route has been intentionally specified by a user, send an event to Plausible\n      (() => {\n        let plausible = /** @type {any} */ (window).plausible;\n        if (typeof plausible === \"undefined\") {\n          return;\n        }\n        if (userText.includes(\"@chat\")) {\n          plausible(\"User-specified-route\", { props: { route: \"@chat\" } });\n        }\n        if (userText.includes(\"@chat/documents\")) {\n          plausible(\"User-specified-route\", {\n            props: { route: \"@chat/documents\" },\n          });\n        }\n        if (userText.includes(\"@search\")) {\n          plausible(\"User-specified-route\", { props: { route: \"@search\" } });\n        }\n      })();\n    });\n\n    document.body.addEventListener(\"selected-docs-change\", (evt) => {\n      selectedDocuments = /** @type{CustomEvent} */ (evt).detail;\n    });\n  }\n}\ncustomElements.define(\"chat-controller\", ChatController);\n","// @ts-check\n\nclass ChatHistory extends HTMLElement {\n  connectedCallback() {\n    this.dataset.initialised = \"true\";\n  }\n\n  /**\n   * Creates a \"Today\" heading, if it doesn't already exist\n   */\n  #createTodayHeading() {\n    // Create \"Today\" heading if it doesn't already exist\n    let todayHeadingExists = false;\n    const headings = this.querySelectorAll(\"h3\");\n    headings.forEach((heading) => {\n      if (heading.textContent === \"Today\") {\n        todayHeadingExists = true;\n      }\n    });\n    if (!todayHeadingExists) {\n      let newHeading = /** @type {HTMLTemplateElement} */ (\n        this.querySelector(\"#template-chat_history_heading\")\n      ).content.querySelector(\"div\");\n      let newHeadingText = newHeading?.querySelector(\"h3\");\n      if (!newHeading || !newHeadingText) {\n        return;\n      }\n      newHeadingText.textContent = \"Today\";\n      this.prepend(newHeading);\n    }\n  }\n\n  /**\n   * Internal method for adding the list-item to the chat history\n   * @param {string} chatId\n   * @param {string} title\n   * @returns {HTMLLIElement}\n   */\n  #createItem(chatId, title) {\n    const newItem = /** @type {HTMLTemplateElement} */ (\n      this.querySelector(\"#template-chat_history_item\")\n    ).content\n      .querySelector(\"li\")\n      ?.cloneNode(true);\n    let link = /** @type {HTMLElement} */ (newItem).querySelector(\"a\");\n    let chatHistoryItem = /** @type {HTMLElement} */ (newItem).querySelector(\n      \"chat-history-item\"\n    );\n    if (link) {\n      link.textContent = title;\n      link.setAttribute(\"href\", `/chats/${chatId}`);\n    }\n    /** @type {HTMLElement} */ (newItem).dataset.chatid = chatId;\n    chatHistoryItem?.setAttribute(\"data-chatid\", chatId);\n    return /** @type {HTMLLIElement} */ (newItem);\n  }\n\n  /**\n   * Adds an item to the chat history\n   * @param {string} chatId\n   * @param {string} title\n   */\n  addChat(chatId, title) {\n    this.#createTodayHeading();\n    let item = this.querySelector(`[data-chatid=\"${chatId}\"]`)?.closest(\"li\");\n    if (!item) {\n      item = this.#createItem(chatId, title.substring(0, 30));\n    }\n    this.querySelector(\"ul\")?.prepend(item);\n  }\n}\n\ncustomElements.define(\"chat-history\", ChatHistory);\n","// @ts-check\n\nclass ChatHistoryItem extends HTMLElement {\n\n  constructor() {\n    super();\n    this.initialised = false;\n    /** @type {HTMLButtonElement | null} */\n    this.toggleButton = this.querySelector(\"button[aria-expanded]\");\n    this.chatLink = /** @type {HTMLAnchorElement} */ (this.querySelector(\".rb-chat-history__link\"));\n  }\n\n  connectedCallback() {\n    // So we don't rebind event listeners if this ChatHistoryItem moves\n    if (!this.initialised) {\n      this.#addEventListeners();\n    }\n    this.initialised = true;\n  }\n\n  #addEventListeners = () => {\n    \n    this.toggleButton?.addEventListener(\"click\", () => {\n      if (!this.toggleButton) {\n        return;\n      }\n      if (this.toggleButton.getAttribute(\"aria-expanded\") === \"true\") {\n        this.toggleButton.setAttribute(\"aria-expanded\", \"false\");\n      } else {\n        this.#changePage(\"1\");\n        this.toggleButton.setAttribute(\"aria-expanded\", \"true\");\n      }\n    });\n\n    this.querySelector('[data-action=\"delete\"]')?.addEventListener(\"click\", () => {\n      this.#changePage(\"2\");\n      deleteButton.focus();\n    });\n    this.querySelector('[data-action=\"rename\"]')?.addEventListener(\"click\", () => {\n      this.toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n      this.#toggleChatTitleEdit(true);\n    });\n\n    let deleteButton = /** @type {HTMLButtonElement} */ (this.querySelector('[data-action=\"delete-confirm\"]'));\n    deleteButton.addEventListener(\"click\", async () => {\n      deleteButton.disabled = true;\n      this.#deleteChat();\n      // move focus to nearest item\n      let listItem = this.closest(\"li\");\n      if (listItem?.nextElementSibling) {\n        /** @type {HTMLAnchorElement | null} */ (listItem.nextElementSibling.querySelector(\".rb-chat-history__link\"))?.focus();\n      } else if (listItem?.previousElementSibling) {\n        /** @type {HTMLAnchorElement | null} */ (listItem.previousElementSibling.querySelector(\".rb-chat-history__link\"))?.focus();\n      } else {\n        /** @type {HTMLAnchorElement | null} */ (document.querySelector(\"#new-chat-button\"))?.focus();\n      }\n    });\n    this.querySelector('[data-action=\"delete-cancel\"]')?.addEventListener(\"click\", () => {\n      this.toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n      this.toggleButton?.focus();\n    });\n\n    let chatTitleInput = this.querySelector(\"input\");\n    if (!chatTitleInput) {\n      return;\n    }\n    chatTitleInput.addEventListener(\"change\", () => {\n      if (!chatTitleInput) {\n        return false;\n      }\n      this.#toggleChatTitleEdit(false);\n      this.#updateChatTitle(chatTitleInput.value, true);\n    });\n    chatTitleInput.addEventListener(\"blur\", () => {\n      this.#toggleChatTitleEdit(false);\n    });\n    chatTitleInput.addEventListener(\"keydown\", (evt) => {\n      if (!chatTitleInput) {\n        return false;\n      }\n      switch (/** @type {KeyboardEvent} */ (evt).key) {\n        case \"Escape\":\n          chatTitleInput.value = this.dataset.title || \"\";\n          this.#toggleChatTitleEdit(false);\n          return true;\n        case \"Enter\":\n          evt.preventDefault();\n          this.#updateChatTitle(chatTitleInput.value, true);\n          this.#toggleChatTitleEdit(false);\n          return true;\n        default:\n          return true;\n      }\n    });\n\n    document.addEventListener(\"chat-title-change\", (evt) => {\n      let evtData = /** @type {object} */ (evt).detail;\n      if (evtData.sender !== \"chat-history-item\" && evtData.session_id === this.dataset.chatid) {\n        this.chatLink.textContent = evtData.title;\n        this.#updateChatTitle(evtData.title, false);\n      }\n    });\n\n  };\n\n  /**\n   * @param {string} pageNumber \n   */\n  #changePage = (pageNumber) => {\n    /** @type {NodeListOf<HTMLElement>} */\n    let pages = this.querySelectorAll(\"[data-page]\");\n    pages.forEach((page, pageIndex) => {\n      if (page.dataset.page === pageNumber) {\n        page.style.display = \"block\";\n      } else {\n        page.style.display = \"none\";\n      }\n    });\n  };\n\n  #deleteChat = async () => {\n    const csrfToken =\n        /** @type {HTMLInputElement | null} */ (\n        document.querySelector('[name=\"csrfmiddlewaretoken\"]')\n    )?.value || \"\";\n    await fetch(`/chats/${this.dataset.chatid}/delete-chat`, {\n        method: \"POST\",\n        headers: {\"Content-Type\": \"application/json\", \"X-CSRFToken\": csrfToken},\n    });\n    if (this.dataset.iscurrentchat === \"true\") {\n      window.location.href = \"/chats\";\n    } else {\n      this.closest(\"li\")?.remove();\n    }\n  };\n\n  /**\n   * @param {boolean} show \n   */\n  #toggleChatTitleEdit = (show) => {\n    let chatTitleEdit = /** @type {HTMLElement} */ (this.querySelector(\".rb-chat-history__text-input\"));\n    let chatTitleInput = /** @type {HTMLInputElement} */ (chatTitleEdit.querySelector(\"input\"));\n    if (show) {\n      chatTitleInput.value = this.chatLink.textContent || \"\";\n      this.chatLink.style.display = \"none\";\n      chatTitleEdit.style.display = \"block\";\n      chatTitleInput?.focus();\n    } else {\n      this.chatLink.textContent = chatTitleInput.value;\n      chatTitleEdit.style.display = \"none\";\n      this.chatLink.style.display = \"block\";\n      this.toggleButton?.focus();\n    }\n  };\n\n  /**\n   * @param {string} newTitle \n   * @param {boolean} publishChanges Whether to let other components know about this change\n   */\n  #updateChatTitle = (newTitle, publishChanges) => {\n    const csrfToken =\n      /** @type {HTMLInputElement | null} */ (\n      document.querySelector('[name=\"csrfmiddlewaretoken\"]')\n    )?.value || \"\";\n    fetch(`/chat/${this.dataset.chatid}/title/`, {\n      method: \"POST\",\n      headers: {\"Content-Type\": \"application/json\", \"X-CSRFToken\": csrfToken},\n      body: JSON.stringify({name: newTitle}),\n    });\n    if (publishChanges) {\n      const chatTitleChangeEvent = new CustomEvent(\"chat-title-change\", {\n        detail: {\n          title: newTitle,\n          session_id: this.dataset.chatid,\n          sender: \"chat-history-item\"\n        },\n      });\n      document.dispatchEvent(chatTitleChangeEvent);\n    }\n  };\n\n}\n\ncustomElements.define(\"chat-history-item\", ChatHistoryItem);\n","// @ts-check\n\nimport \"../loading-message.js\";\n\n// Send Plausible data on tool-tip hover\n/**\n *\n * @param {Event} evt\n */\nconst sendTooltipViewEvent = (evt) => {\n  let plausible = /** @type {any} */ (window).plausible;\n  if (typeof plausible !== \"undefined\") {\n    plausible(\"Route-tooltip-view\");\n  }\n  // cancel event listener so events only get sent once\n  let targetElement = /** @type{HTMLElement | null | undefined} */ (evt.target);\n  if (targetElement?.nodeName !== \"TOOL-TIP\") {\n    targetElement = targetElement?.closest(\"tool-tip\");\n  }\n  targetElement?.removeEventListener(\"mouseover\", sendTooltipViewEvent);\n};\n// Do this for any SSR tool-tips on the page\n(() => {\n  const tooltips = document.querySelectorAll(\"tool-tip\");\n  tooltips.forEach((tooltip) => {\n    tooltip.addEventListener(\"mouseover\", sendTooltipViewEvent);\n  });\n})();\n\n\nexport class ChatMessage extends HTMLElement {\n  constructor() {\n    super();\n    this.programmaticScroll = false;\n    this.plausibleRouteDataSent = false;\n  }\n\n  connectedCallback() {\n    const uuid = crypto.randomUUID();\n    this.innerHTML = `\n            <div class=\"iai-chat-bubble govuk-body {{ classes }}\" data-role=\"${\n              this.dataset.role\n            }\" tabindex=\"-1\">\n                <div class=\"iai-chat-bubble__header\">\n                    <div class=\"iai-chat-bubble__role\">${\n                      this.dataset.role === \"ai\" ? \"Redbox\" : \"You\"\n                    }</div>\n                </div>\n                <markdown-converter class=\"iai-chat-bubble__text\">${\n                  this.dataset.text || \"\"\n                }</markdown-converter>\n                ${\n                  !this.dataset.text\n                    ? `\n                      <loading-message data-aria-label=\"Loading message\"></loading-message>\n                      <div class=\"rb-loading-complete govuk-visually-hidden\" aria-live=\"assertive\"></div>\n                    `\n                    : \"\"\n                }\n                <sources-list data-id=\"${uuid}\"></sources-list>\n                <div class=\"govuk-notification-banner govuk-notification-banner--error govuk-!-margin-bottom-3 govuk-!-margin-top-3\" role=\"alert\" aria-labelledby=\"notification-title-${uuid}\" data-module=\"govuk-notification-banner\" hidden>\n                    <div class=\"govuk-notification-banner__header\">\n                        <h3 class=\"govuk-notification-banner__title\" id=\"notification-title-${uuid}\">Error</h3>\n                    </div>\n                    <div class=\"govuk-notification-banner__content\">\n                        <p class=\"govuk-notification-banner__heading\"></p>\n                    </div>\n                </div>\n            </div>\n            <feedback-buttons></feedback-buttons>\n        `;\n\n    // ensure new chat-messages aren't hidden behind the chat-input\n    this.programmaticScroll = true;\n    this.scrollIntoView({ block: \"end\" });\n\n    // Insert route_display HTML\n    const routeTemplate = /** @type {HTMLTemplateElement} */ (\n      document.querySelector(\"#template-route-display\")\n    );\n    const routeClone = document.importNode(routeTemplate.content, true);\n\n    this.querySelector(\".iai-chat-bubble__header\")?.appendChild(routeClone);\n    this.querySelector(\"tool-tip\")?.addEventListener(\n      \"mouseover\",\n      sendTooltipViewEvent\n    );\n  }\n\n  #addFootnotes = (content) => {\n    let footnotes = this.querySelectorAll(\"sources-list a[data-text]\");\n    footnotes.forEach((footnote, footnoteIndex) => {\n      const matchingText = footnote.getAttribute(\"data-text\");\n      if (!matchingText || !this.responseContainer) {\n        return;\n      }\n      /*\n      this.responseContainer?.update(\n        content.replace(matchingText, `${matchingText}<a href=\"#${footnote.id}\" aria-label=\"Footnote ${footnoteIndex + 1}\">[${footnoteIndex + 1}]</a>`)\n      );\n      */\n      this.responseContainer.innerHTML = this.responseContainer.innerHTML.replace(matchingText, `${matchingText}<a class=\"rb-footnote-link\" href=\"#${footnote.id}\" aria-label=\"Footnote ${footnoteIndex + 1}\">${footnoteIndex + 1}</a>`);\n    });\n  };\n\n  /**\n   * Displays an activity above the message\n   * @param {string} message \n   * @param { \"ai\" | \"user\"} type\n   */\n  addActivity = (message, type) => {\n    let activityElement = document.createElement(\"p\");\n    activityElement.classList.add(\"rb-activity\", `rb-activity--${type}`);\n    activityElement.textContent = message;\n    this.insertBefore(activityElement, this.querySelector(\".iai-chat-bubble\"));\n  };\n\n  /**\n   * Streams an LLM response\n   * @param {string} message\n   * @param {string[]} selectedDocuments\n   * @param {string[]} activities\n   * @param {string} llm\n   * @param {string | undefined} sessionId\n   * @param {string} endPoint\n   * @param {HTMLElement} chatControllerRef\n   */\n  stream = (\n    message,\n    selectedDocuments,\n    activities,\n    llm,\n    sessionId,\n    endPoint,\n    chatControllerRef\n  ) => {\n    // Scroll behaviour - depending on whether user has overridden this or not\n    let scrollOverride = false;\n    window.addEventListener(\"scroll\", (evt) => {\n      if (this.programmaticScroll) {\n        this.programmaticScroll = false;\n        return;\n      }\n      scrollOverride = true;\n    });\n\n    this.responseContainer = /** @type {import(\"../markdown-converter\").MarkdownConverter} */ (\n      this.querySelector(\"markdown-converter\")\n    );\n    let sourcesContainer = /** @type SourcesList */ (\n      this.querySelector(\"sources-list\")\n    );\n    /** @type {FeedbackButtons | null} */\n    let feedbackContainer = this.querySelector(\"feedback-buttons\");\n    let responseLoading = /** @type HTMLElement */ (\n      this.querySelector(\".rb-loading-ellipsis\")\n    );\n    let responseComplete = this.querySelector(\".rb-loading-complete\");\n    let webSocket = new WebSocket(endPoint);\n    let streamedContent = \"\";\n\n    // Stop streaming on escape-key or stop-button press\n    const stopStreaming = () => {\n      this.dataset.status = \"stopped\";\n      webSocket.close();\n    };\n    this.addEventListener(\"keydown\", (evt) => {\n      if (evt.key === \"Escape\" && this.dataset.status === \"streaming\") {\n        stopStreaming();\n      }\n    });\n    document.addEventListener(\"stop-streaming\", stopStreaming);\n\n    webSocket.onopen = (event) => {\n      webSocket.send(\n        JSON.stringify({\n          message: message,\n          sessionId: sessionId,\n          selectedFiles: selectedDocuments,\n          activities: activities,\n          llm: llm,\n        })\n      );\n      this.dataset.status = \"streaming\";\n      const chatResponseStartEvent = new CustomEvent(\"chat-response-start\");\n      document.dispatchEvent(chatResponseStartEvent);\n    };\n\n    webSocket.onerror = (event) => {\n      if (!this.responseContainer) {\n        return;\n      }\n      this.responseContainer.innerHTML =\n        \"There was a problem. Please try sending this message again.\";\n      this.dataset.status = \"error\";\n    };\n\n    webSocket.onclose = (event) => {\n      responseLoading.style.display = \"none\";\n      if (responseComplete) {\n        responseComplete.textContent = \"Response complete\";\n      }\n      if (this.dataset.status !== \"stopped\") {\n        this.dataset.status = \"complete\";\n      }\n      const stopStreamingEvent = new CustomEvent(\"stop-streaming\");\n      document.dispatchEvent(stopStreamingEvent);\n    };\n\n    webSocket.onmessage = (event) => {\n      let response;\n      try {\n        response = JSON.parse(event.data);\n      } catch (err) {\n        console.log(\"Error getting JSON response\", err);\n      }\n\n      if (response.type === \"text\") {\n        streamedContent += response.data;\n        this.responseContainer?.update(streamedContent);\n      } else if (response.type === \"session-id\") {\n        chatControllerRef.dataset.sessionId = response.data;\n      } else if (response.type === \"source\") {\n        sourcesContainer.add(\n          response.data.file_name,\n          response.data.url,\n          response.data.text_in_answer\n        );\n      } else if (response.type === \"route\") {\n        let route = this.querySelector(\".iai-chat-bubble__route\");\n        let routeText = route?.querySelector(\".iai-chat-bubble__route-text\");\n        if (route && routeText) {\n          routeText.textContent = response.data;\n          route.removeAttribute(\"hidden\");\n        }\n\n        // send route to Plausible\n        let plausible = /** @type {any} */ (window).plausible;\n        if (typeof plausible !== \"undefined\" && !this.plausibleRouteDataSent) {\n          plausible(\"Chat-message-route\", { props: { route: response.data } });\n          this.plausibleRouteDataSent = true;\n        }\n      } else if (response.type === \"activity\") {\n        this.addActivity(response.data, \"ai\");\n      } else if (response.type === \"end\") {\n        sourcesContainer.showCitations(response.data.message_id);\n        feedbackContainer?.showFeedback(response.data.message_id);\n        this.#addFootnotes(streamedContent);\n        const chatResponseEndEvent = new CustomEvent(\"chat-response-end\", {\n          detail: {\n            title: response.data.title,\n            session_id: response.data.session_id,\n          },\n        });\n        document.dispatchEvent(chatResponseEndEvent);\n      } else if (response.type === \"error\") {\n        this.querySelector(\".govuk-notification-banner\")?.removeAttribute(\n          \"hidden\"\n        );\n        let errorContentContainer = this.querySelector(\".govuk-notification-banner__heading\");\n        if (errorContentContainer) {\n          errorContentContainer.innerHTML = response.data;\n        }\n      }\n\n      // ensure new content isn't hidden behind the chat-input\n      // but stop scrolling if message is at the top of the screen\n      if (!scrollOverride) {\n        const TOP_POSITION = 88;\n        const boxInfo = this.getBoundingClientRect()\n        const newTopPosition = boxInfo.top - ( boxInfo.height - ( this.previousHeight || boxInfo.height ) );\n        this.previousHeight = boxInfo.height;\n        if (newTopPosition > TOP_POSITION) {\n          this.programmaticScroll = true;\n          this.scrollIntoView({ block: \"end\" });\n        } else {\n          scrollOverride = true;\n          this.scrollIntoView();\n          window.scrollBy(0, -TOP_POSITION);\n        }\n        \n      }\n    };\n  };\n}\ncustomElements.define(\"chat-message\", ChatMessage);\n","// @ts-check\n\nexport class ChatTitle extends HTMLElement {\n    connectedCallback() {\n        this.innerHTML = `\n            <div class=\"chat-title__heading-container\">\n                <div class=\"chat-title__heading-container-inner\">\n                ${\n                    this.dataset.title\n                        ? `\n                    <h2 class=\"chat-title__heading govuk-heading-m\">${this.dataset.title}</h2>\n                `\n                        : `\n                    <h2 class=\"chat-title__heading govuk-heading-s govuk-visually-hidden\">Current chat</h2>\n                `\n                }\n                <button class=\"chat-title__edit-btn\" type=\"button\">\n                    <svg width=\"16\" height=\"16\" viewBox=\"0 0 25 24\" fill=\"none\" aria-hidden=\"true\" focusable=\"false\">\n                    <path d=\"M11.9766 4H4.97656C4.44613 4 3.93742 4.21071 3.56235 4.58579C3.18728 4.96086 2.97656 5.46957 2.97656 6V20C2.97656 20.5304 3.18728 21.0391 3.56235 21.4142C3.93742 21.7893 4.44613 22 4.97656 22H18.9766C19.507 22 20.0157 21.7893 20.3908 21.4142C20.7658 21.0391 20.9766 20.5304 20.9766 20V13\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    <path d=\"M19.4766 2.49998C19.8744 2.10216 20.414 1.87866 20.9766 1.87866C21.5392 1.87866 22.0787 2.10216 22.4766 2.49998C22.8744 2.89781 23.0979 3.43737 23.0979 3.99998C23.0979 4.56259 22.8744 5.10216 22.4766 5.49998L12.9766 15L8.97656 16L9.97656 12L19.4766 2.49998Z\" stroke=\"currentColor\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                    </svg>\n                    Edit\n                    <span class=\"govuk-visually-hidden\"> chat title</span>\n                </button>\n                </div>\n            </div>\n            <div class=\"chat-title__form-container\" hidden>\n                <label for=\"chat-title\" class=\"govuk-visually-hidden\">Chat Title</label>\n                <input type=\"text\" class=\"chat-title__input\" id=\"chat-title\" maxlength=\"${\n                    this.dataset.titleLength\n                }\" value=\"${this.dataset.title}\" tabindex=\"-1\"/>\n            </div>\n        `;\n\n        this.headingContainer = this.querySelector(\n            \".chat-title__heading-container\"\n        );\n        this.formContainer = this.querySelector(\".chat-title__form-container\");\n        /** @type {HTMLButtonElement | null} */\n        this.editButton = this.querySelector(\".chat-title__edit-btn\");\n        /** @type {HTMLInputElement | null} */\n        this.input = this.querySelector(\".chat-title__input\");\n        this.heading = this.querySelector(\".chat-title__heading\");\n\n        this.editButton?.addEventListener(\"click\", this.showForm);\n        this.heading?.addEventListener(\"click\", this.showForm);\n        this.input?.addEventListener(\"keydown\", (e) => {\n            if (!this.input) {\n                return false;\n            }\n            switch (/** @type {KeyboardEvent} */ (e).key) {\n                case \"Escape\":\n                    this.input.value = this.dataset.title || \"\";\n                    this.hideForm();\n                    return true;\n                case \"Enter\":\n                    e.preventDefault();\n                    this.update(true);\n                    return true;\n                default:\n                    return true;\n            }\n        });\n        this.input?.addEventListener(\"change\", (e) => {\n            this.update(true);\n        });\n        this.input?.addEventListener(\"blur\", (e) => {\n            this.update(true);\n        });\n\n        if (!this.dataset.sessionId) {\n            document.addEventListener(\"chat-response-end\", this.#onFirstResponse);\n        }\n\n        document.addEventListener(\"chat-title-change\", (evt) => {\n            let evtData = /** @type {object} */ (evt).detail;\n            if (evtData.sender !== \"chat-title\" && evtData.session_id === this.dataset.sessionId) {\n                if (this.input) {\n                    this.input.value = evtData.title;\n                }\n                this.update(false);\n            }\n        });\n\n    }\n\n    showForm = () => {\n        this.headingContainer?.setAttribute(\"hidden\", \"\");\n        this.formContainer?.removeAttribute(\"hidden\");\n        this.input?.focus();\n    };\n\n    hideForm = () => {\n        this.headingContainer?.removeAttribute(\"hidden\");\n        this.formContainer?.setAttribute(\"hidden\", \"\");\n        this.editButton?.focus();\n    };\n\n    #onFirstResponse = (e) => {\n        this.dataset.title = e.detail.title;\n        this.dataset.sessionId = e.detail.session_id;\n        document.removeEventListener(\"chat-response-end\", this.#onFirstResponse);\n        if (this.input && this.heading) {\n            this.input.value = e.detail.title;\n            this.heading.textContent = `${e.detail.title}`;\n            this.heading.classList.remove(\"govuk-visually-hidden\");\n            window.scrollBy(0, this.heading.getBoundingClientRect().height); // to prevent message jumping when this is made visible\n        }\n    };\n\n    /**\n     * @param {boolean} publishChanges Whether to let other components know about this change\n     */\n    update = (publishChanges) => {\n        const newTitle = this.input?.value;\n        this.send(newTitle);\n        this.dataset.title = newTitle;\n        if (this.heading) {\n            this.heading.textContent = newTitle || \"\";\n        }\n        this.hideForm();\n        if (publishChanges) {\n            const chatTitleChangeEvent = new CustomEvent(\"chat-title-change\", {\n                detail: {\n                    title: newTitle,\n                    session_id: this.dataset.sessionId,\n                    sender: \"chat-title\"\n                },\n            });\n            document.dispatchEvent(chatTitleChangeEvent);\n        }\n    };\n\n    send = (newTitle) => {\n        const csrfToken =\n            /** @type {HTMLInputElement | null} */ (\n            document.querySelector('[name=\"csrfmiddlewaretoken\"]')\n        )?.value || \"\";\n        fetch(`/chat/${this.dataset.sessionId}/title/`, {\n            method: \"POST\",\n            headers: {\"Content-Type\": \"application/json\", \"X-CSRFToken\": csrfToken},\n            body: JSON.stringify({name: newTitle}),\n        });\n    };\n}\n\ncustomElements.define(\"chat-title\", ChatTitle);\n","// @ts-check\n\nclass CopyText extends HTMLElement {\n  connectedCallback() {\n    this.innerHTML = `\n        <button class=\"iai-chat-bubble__button\" type=\"button\">\n          <svg width=\"19\" height=\"18\" viewBox=\"0 0 19 18\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\">\n            <path d=\"M6.875 3H5C4.17157 3 3.5 3.67157 3.5 4.5V15C3.5 15.8284 4.17157 16.5 5 16.5H14C14.8284 16.5 15.5 15.8284 15.5 15V4.5C15.5 3.67157 14.8284 3 14 3H12.125\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\n            <path d=\"M6.5 4.8V3.375C6.5 3.16789 6.66789 3 6.875 3C7.08211 3 7.25317 2.83203 7.28864 2.62798C7.39976 1.98878 7.83049 0.75 9.5 0.75C11.1695 0.75 11.6002 1.98878 11.7114 2.62798C11.7468 2.83203 11.9179 3 12.125 3C12.3321 3 12.5 3.16789 12.5 3.375V4.8C12.5 5.04853 12.2985 5.25 12.05 5.25H6.95C6.70147 5.25 6.5 5.04853 6.5 4.8Z\" stroke=\"currentColor\" stroke-width=\"1.5\" stroke-linecap=\"round\"/>\n          </svg>\n          Copy to clipboard\n        </button>\n    `;\n\n    const copyToClip = (html, text) => {\n      function listener(evt) {\n        evt.clipboardData.setData(\"text/html\", html);\n        evt.clipboardData.setData(\"text/plain\", text);\n        evt.preventDefault();\n      }\n      document.addEventListener(\"copy\", listener);\n      document.execCommand(\"copy\");\n      document.removeEventListener(\"copy\", listener);\n    };\n\n    this.querySelector(\"button\")?.addEventListener(\"click\", () => {\n      const textEl = this.closest(\".iai-chat-bubble\")?.querySelector(\n        \".iai-chat-bubble__text\"\n      );\n      copyToClip(textEl?.innerHTML, textEl?.innerText);\n    });\n  }\n}\ncustomElements.define(\"copy-text\", CopyText);\n","// @ts-check\n\nclass DocumentSelector extends HTMLElement {\n  connectedCallback() {\n    const documents = /** @type {NodeListOf<HTMLInputElement>} */ (\n      this.querySelectorAll('input[type=\"checkbox\"]')\n    );\n\n    const getSelectedDocuments = () => {\n      let selectedDocuments = [];\n      documents.forEach((document) => {\n        if (document.checked) {\n          selectedDocuments.push({\n            id: document.value,\n            name: this.querySelector(`[for=\"${document.id}\"]`)?.textContent\n          });\n        }\n      });\n      const evt = new CustomEvent(\"selected-docs-change\", {\n        detail: selectedDocuments,\n      });\n      document.body.dispatchEvent(evt);\n    };\n\n    // update on page load\n    getSelectedDocuments();\n\n    // update on any selection change\n    documents.forEach((document) => {\n      document.addEventListener(\"change\", getSelectedDocuments);\n    });\n\n    // listen for completed docs\n    document.body.addEventListener(\"doc-complete\", (evt) => {\n      const completedDoc = /** @type{CustomEvent} */ (evt).detail.closest(\n        \".govuk-checkboxes__item\"\n      );\n      completedDoc.querySelector(\"file-status\").remove();\n      this.querySelector(\".govuk-checkboxes\")?.appendChild(completedDoc);\n    });\n  }\n}\ncustomElements.define(\"document-selector\", DocumentSelector);\n","// @ts-check\n\nclass FeedbackButtons extends HTMLElement {\n  showFeedback(messageId) {\n    let collectedData = {\n      rating: 0,\n      text: \"\",\n      chips: /** @type {string[]}*/ ([]),\n    };\n\n    const starIcon = `\n        <svg width=\"25\" height=\"25\" viewBox=\"0 0 25 25\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\">\n            <path d=\"M12.0172 1.68381C12.1639 1.21711 12.8244 1.21711 12.9711 1.68381L15.1648 8.66018C15.3613 9.28511 15.9406 9.71024 16.5957 9.71024H23.7624C24.2428 9.71024 24.4468 10.3217 24.0626 10.6101L18.2088 15.0049C17.7002 15.3867 17.4877 16.0477 17.6784 16.6544L19.901 23.7227C20.0468 24.1863 19.5124 24.5643 19.1238 24.2726L13.3947 19.9714C12.8612 19.5708 12.1271 19.5708 11.5936 19.9714L5.86446 24.2726C5.47585 24.5643 4.94152 24.1863 5.08728 23.7227L7.30983 16.6544C7.50059 16.0477 7.28806 15.3867 6.77949 15.0049L0.925668 10.6101C0.5415 10.3217 0.745481 9.71024 1.22586 9.71024H8.3926C9.0477 9.71024 9.62702 9.28511 9.82353 8.66017L12.0172 1.68381Z\" fill=\"currentColor\" stroke=\"#BEBEBE\"/>\n        </svg>\n    `;\n\n    this.innerHTML = `\n        <div class=\"feedback__container feedback__container--1\" tabindex=\"-1\">\n            <h3 class=\"feedback__heading\">Rate this response:</h3>\n            <div class=\"feedback__star-container\">\n                <span class=\"feedback__star-help-text\" aria-hidden=\"true\">Not helpful</span>\n                <button class=\"feedback__star-button\" data-rating=\"1\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">1 star out of 5 (not helpful)</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"2\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">2 star out of 5</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"3\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">3 star out of 5</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"4\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">4 star out of 5</span>\n                </button>\n                <button class=\"feedback__star-button\" data-rating=\"5\" type=\"button\">\n                    ${starIcon}\n                    <span class=\"govuk-visually-hidden\">5 star out of 5 (very helpful)</span>\n                </button>\n                <span class=\"feedback__star-help-text\" aria-hidden=\"true\">Very helpful</span>\n            </div>\n        </div>\n        <div class=\"feedback__container feedback__container--2\" hidden tabindex=\"-1\">\n            <div class=\"feedback__response-container\">\n                <img src=\"/static/icons/thumbs-up.svg\" alt=\"\"/>\n                <span class=\"feedback__negative\">Sorry this didn't meet your expectations</span>\n                <span class=\"feedback__positive\">Thanks for the feedback</span>\n            </div>\n            <button class=\"feedback__improve-response-btn\" type=\"button\">Help improve the response</button>\n        </div>\n        <div class=\"feedback__container feedback__container--3\" hidden tabindex=\"-1\">\n            <fieldset class=\"feedback__chips-container feedback__negative\">\n                <legend class=\"feedback__chips-legend\">How would you describe the response?</legend>\n                <div class=\"feedback__chips-inner-container\">\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip1-negative-${messageId}\" data-testid=\"Inaccurate\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip1-negative-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Inaccurate</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip2-negative-${messageId}\" data-testid=\"Incomplete\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip2-negative-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Incomplete</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip3-negative-${messageId}\" data-testid=\"Bad quality\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip3-negative-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Bad quality</label>\n                </div>\n            </fieldset>\n            <fieldset class=\"feedback__chips-container feedback__positive\">\n                <legend class=\"feedback__chips-legend\">How would you describe the response?</legend>\n                <div class=\"feedback__chips-inner-container\">\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip1-positive-${messageId}\" data-testid=\"Accurate\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip1-positive-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Accurate</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip2-positive-${messageId}\" data-testid=\"Complete\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip2-positive-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Complete</label>\n                    <input class=\"feedback__chip\" type=\"checkbox\" id=\"chip3-positive-${messageId}\" data-testid=\"Good quality\"/>\n                    <label class=\"feedback__chip-label\" for=\"chip3-positive-${messageId}\"><img src=\"/static/icons/Chip_tick.svg\" alt=\"\"/> Good quality</label>\n                </div>\n            </fieldset>\n            <label for=\"text-${messageId}\">Or describe with your own words:</label>\n            <textarea class=\"feedback__text-input\" id=\"text-${messageId}\" rows=\"1\"></textarea>\n            <button class=\"feedback__submit-btn\" type=\"button\">Submit</button>\n        </div>\n        <div class=\"feedback__container feedback__container--4\" hidden tabindex=\"-1\">\n           <span>Thanks for helping improve this response</span>\n           <button class=\"feedback__rate-again-btn\" type=\"button\">Rate response again</button> \n        </div>\n    `;\n\n    /**\n     * Posts data back to the server\n     */\n    const sendFeedback = async (retry = 0) => {\n      const MAX_RETRIES = 10;\n      const RETRY_INTERVAL_SECONDS = 10;\n      const csrfToken =\n        /** @type {HTMLInputElement | null} */ (\n          document.querySelector('[name=\"csrfmiddlewaretoken\"]')\n        )?.value || \"\";\n      try {\n        await fetch(`/ratings/${messageId}/`, {\n          method: \"POST\",\n          headers: {\n            \"Content-Type\": \"application/json\",\n            \"X-CSRFToken\": csrfToken,\n          },\n          body: JSON.stringify(collectedData),\n        });\n      } catch (err) {\n        if (retry < MAX_RETRIES) {\n          window.setTimeout(() => {\n            sendFeedback(retry + 1);\n          }, RETRY_INTERVAL_SECONDS * 1000);\n        }\n      }\n    };\n\n    /**\n     * @param {number} panelIndex - zero based\n     */\n    const showPanel = (panelIndex) => {\n      /** @type {NodeListOf<HTMLElement>} */\n      let panels = this.querySelectorAll(\".feedback__container\");\n      panels.forEach((panel) => {\n        panel.setAttribute(\"hidden\", \"\");\n      });\n      panels[panelIndex].removeAttribute(\"hidden\");\n      panels[panelIndex].focus();\n      if (collectedData.rating >= 3) {\n        panels[panelIndex].classList.remove(\"feedback__container--negative\");\n        panels[panelIndex].classList.add(\"feedback__container--positive\");\n      } else {\n        panels[panelIndex].classList.add(\"feedback__container--negative\");\n        panels[panelIndex].classList.remove(\"feedback__container--positive\");\n      }\n    };\n\n    /* Panel 1 - stars rating */\n    let starButtons = /** @type {NodeListOf<HTMLElement>} */ (\n      this.querySelectorAll(\".feedback__star-button\")\n    );\n    starButtons.forEach((starButton, buttonIndex) => {\n      starButton.addEventListener(\"click\", () => {\n        collectedData.rating = parseInt(starButton.dataset.rating || \"0\");\n        sendFeedback();\n        showPanel(1);\n      });\n      starButton.addEventListener(\"mouseover\", () => {\n        starButtons.forEach((btn) => {\n          btn.classList.remove(\"feedback__star-button--hover\");\n        });\n        for (let i = 0; i <= buttonIndex; i++) {\n          starButtons[i].classList.add(\"feedback__star-button--hover\");\n        }\n      });\n      starButton.addEventListener(\"mouseleave\", () => {\n        starButtons.forEach((btn) => {\n          btn.classList.remove(\"feedback__star-button--hover\");\n        });\n      });\n    });\n\n    /* Panel 2 - help improve response */\n    this.querySelector(\".feedback__improve-response-btn\")?.addEventListener(\n      \"click\",\n      () => {\n        showPanel(2);\n      }\n    );\n\n    /* Panel 3 - text and chips */\n    /** @type {HTMLTextAreaElement | null} */\n    const textInput = this.querySelector(`#text-${messageId}`);\n    this.querySelector(\".feedback__submit-btn\")?.addEventListener(\n      \"click\",\n      (evt) => {\n        evt.preventDefault();\n        /** @type {NodeListOf<HTMLInputElement>} */\n        let chips = this.querySelectorAll(\".feedback__chip\");\n        chips.forEach((chip) => {\n          if (chip.checked) {\n            const text = this.querySelector(`[for=\"${chip.id}\"]`)?.textContent;\n            if (text) {\n              collectedData.chips.push(text);\n            }\n          }\n        });\n        collectedData.text = textInput?.value || \"\";\n        sendFeedback();\n        showPanel(3);\n      }\n    );\n    textInput?.addEventListener(\"input\", () => {\n      textInput.style.height = \"auto\";\n      textInput.style.height = `${textInput.scrollHeight}px`;\n    });\n\n    /* Panel 4 - thank you */\n    this.querySelector(\".feedback__rate-again-btn\")?.addEventListener(\n      \"click\",\n      () => {\n        showPanel(0);\n      }\n    );\n  }\n\n  // If the messageID already exists (e.g. for SSR messages), render the feedback HTML immediately\n  connectedCallback() {\n    if (this.dataset.id) {\n      this.showFeedback(this.dataset.id);\n    }\n  }\n}\ncustomElements.define(\"feedback-buttons\", FeedbackButtons);\n","// @ts-check\n\nclass MessageInput extends HTMLElement {\n\n    constructor() {\n        super();\n        this.textarea = this.querySelector(\"textarea\");\n    }\n\n    connectedCallback() {\n\n        if (!this.textarea) {\n            return;\n        }\n\n        // Submit form on enter-key press (providing shift isn't being pressed)\n        this.textarea.addEventListener('keypress', (evt) => {\n            if (evt.key === 'Enter' && !evt.shiftKey && this.textarea) {\n                evt.preventDefault();\n                if (this.textarea.value.trim()) {\n                    this.closest('form')?.requestSubmit();\n                }\n            }\n        });\n\n        // expand textarea as user adds lines\n        this.textarea.addEventListener('input', () => {\n            this.#adjustHeight();\n        });\n\n    }\n\n    #adjustHeight = () => {\n        if (!this.textarea) {\n            return;\n        }\n        this.textarea.style.height = 'auto';\n        this.textarea.style.height = `${this.textarea.scrollHeight}px`;\n    };\n\n    /**\n     * Returns the current message\n     * @returns string\n     */\n    getValue = () => {\n        return this.querySelector(\"textarea\")?.value.trim() || \"\";\n    }\n\n    /**\n     * Clears the message and resets to starting height\n     */\n    reset = () => {\n        if (!this.textarea) {\n            return;\n        }\n        this.textarea.value = \"\";\n        this.#adjustHeight();\n    }\n  \n}\ncustomElements.define('message-input', MessageInput);","// @ts-check\n\nclass SourcesList extends HTMLElement {\n  constructor() {\n    super();\n    this.sources = [];\n  }\n\n  /**\n   * Adds a source to the current message\n   * @param {string} fileName\n   * @param {string} url\n   * @param {string} matchingText\n   */\n  add = (fileName, url, matchingText) => {\n\n    // prevent duplicate sources\n    if (this.sources.some((source) => source.fileName === fileName)) {\n      return;\n    }\n\n    this.sources.push({\n      fileName: fileName,\n      url: url,\n      matchingText: matchingText\n    });\n\n    let html = `\n            <h3 class=\"iai-chat-bubble__sources-heading govuk-heading-s govuk-!-margin-bottom-1\">Sources</h3>\n            <div class=\"iai-display-flex-from-desktop\">\n            <ol class=\"rb-footnote-list govuk-!-margin-bottom-0\">\n        `;\n    this.sources.forEach((source) => {\n      html += `\n                <li class=\"govuk-!-margin-bottom-0\">\n                    <a class=\"iai-chat-bubbles__sources-link govuk-link\" href=\"${source.url}\" id=\"footnote-${this.getAttribute('data-id')}-${this.sources.length}\" data-text=\"${source.matchingText}\">${source.fileName || source.url}</a>\n                </li>\n            `;\n    });\n    html += `</div></ol>`;\n\n    this.innerHTML = html;\n  };\n\n  /**\n   * Shows to citations link/button\n   * @param {string} chatId\n   */\n  showCitations = (chatId) => {\n    if (!chatId) {\n      return;\n    }\n    if (this.sources.length) {\n      const html = `\n        <div class=\"iai-chat-bubble__citations-button-container\">\n          <copy-text></copy-text>\n          <a class=\"iai-chat-bubble__button\" href=\"/citations/${chatId}\">\n            <svg width=\"20\" height=\"19\" viewBox=\"0 0 20 19\" fill=\"none\" focusable=\"false\" aria-hidden=\"true\">\n                <path d=\"M1.5 9.62502C1.5 9.62502 4.59036 3.55359 10 3.55359C15.4084 3.55359 18.5 9.62502 18.5 9.62502C18.5 9.62502 15.4084 15.6964 10 15.6964C4.59036 15.6964 1.5 9.62502 1.5 9.62502Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n                <path d=\"M9.99993 10.8392C10.322 10.8392 10.6308 10.7113 10.8586 10.4836C11.0863 10.2558 11.2142 9.94698 11.2142 9.62493C11.2142 9.30288 11.0863 8.99402 10.8586 8.7663C10.6308 8.53858 10.322 8.41064 9.99993 8.41064C9.67788 8.41064 9.36902 8.53858 9.1413 8.7663C8.91358 8.99402 8.78564 9.30288 8.78564 9.62493C8.78564 9.94698 8.91358 10.2558 9.1413 10.4836C9.36902 10.7113 9.67788 10.8392 9.99993 10.8392Z\" stroke=\"currentColor\" stroke-width=\"2\" stroke-linecap=\"round\" stroke-linejoin=\"round\"/>\n            </svg>\n            See the response info\n          </a>\n        </div>\n      `;\n      /** @type {HTMLElement} */ (\n        this.querySelector(\".iai-display-flex-from-desktop\")\n      ).innerHTML += html;\n    } else {\n      this.innerHTML = `<copy-text></copy-text>`;\n    }\n  };\n}\ncustomElements.define(\"sources-list\", SourcesList);\n","// @ts-check\n\nclass CannedPrompts extends HTMLElement {\n  connectedCallback() {\n    this.innerHTML = `\n      <h3 class=\"chat-options__heading govuk-heading-m\">What would you like to ask your Redbox?</h3>\n      <div class=\"chat-options__options\">\n          <button class=\"chat-options__option chat-options__option_agenda plausible-event-name--canned+prompt+draft+meeting+agenda\" type=\"button\">\n              <img src=\"/static/icons/icon_square_doc.svg\" alt=\"\"/>\n              Draft an agenda for a team meeting\n          </button>\n          <button class=\"chat-options__option chat-options__option_objectives plausible-event-name--canned+prompt+set+work+objectives\" type=\"button\">\n              <img src=\"/static/icons/archery.svg\" alt=\"\"/>\n              Help me set my work objectives\n          </button>\n          <button class=\"chat-options__option chat-options__option_ps_role plausible-event-name--canned+prompt+describe+role+permanent+secretary\" type=\"button\">\n              <img src=\"/static/icons/person.svg\" alt=\"\"/>\n              Describe the role of a Permanent Secretary\n          </button>\n      </div>\n      <p class=\"chat-options__info-text\">Or type any question below</p>\n    `;\n\n    let buttons = this.querySelectorAll(\"button\");\n    buttons.forEach((button) => {\n      button.addEventListener(\"click\", () => {\n        this.#prepopulateMessageBox(button.textContent?.trim() || \"\");\n      });\n    });\n\n    window.setTimeout(() => {\n      this.scrollIntoView({ block: \"end\" });\n    }, 100);\n  }\n\n  /**\n   * @param {string} prompt\n   */\n  #prepopulateMessageBox = (prompt) => {\n    /** @type HTMLInputElement | null */\n    let chatInput = document.querySelector(\".iai-chat-input__input\");\n    if (chatInput) {\n      chatInput.value = prompt;\n      chatInput.focus();\n      chatInput.selectionStart = chatInput.value.length;\n    }\n  };\n}\ncustomElements.define(\"canned-prompts\", CannedPrompts);\n","// @ts-check\n\nclass SendMessage extends HTMLElement {\n  connectedCallback() {\n    const stopButtonHtml = `\n      <button class=\"iai-chat-input__button iai-icon-button rb-send-button\" type=\"button\">\n        <div class=\"rb-square-icon\"></div>\n        Stop\n      </button>\n    `;\n    this.innerHTML += stopButtonHtml;\n\n    let buttonSend = /** @type {HTMLButtonElement} */ (\n      this.querySelector(\"button:nth-child(1)\")\n    );\n    let buttonStop = /** @type {HTMLButtonElement} */ (\n      this.querySelector(\"button:nth-child(2)\")\n    );\n\n    buttonStop.style.display = \"none\";\n    buttonStop.addEventListener(\"click\", () => {\n      const stopStreamingEvent = new CustomEvent(\"stop-streaming\");\n      document.dispatchEvent(stopStreamingEvent);\n    });\n\n    document.addEventListener(\"chat-response-start\", () => {\n      buttonSend.style.display = \"none\";\n      buttonStop.style.display = \"flex\";\n    });\n    const showSendButton = () => {\n      buttonSend.style.display = \"flex\";\n      buttonStop.style.display = \"none\";\n    };\n    document.addEventListener(\"chat-response-end\", showSendButton);\n    document.addEventListener(\"stop-streaming\", showSendButton);\n  }\n}\ncustomElements.define(\"send-message\", SendMessage);\n","// @ts-check\n\nclass ProfileOverlay extends HTMLElement {\n  constructor() {\n    super();\n    this.currentPage = 0;\n  }\n  connectedCallback() {\n    const dialog = this.querySelector(\"dialog\");\n    if (!dialog) {\n      return;\n    }\n\n    // display dialog on page load?\n    if (this.dataset.show === \"true\") {\n      dialog.showModal();\n    }\n\n    // Success animation\n    let animation = window[\"lottie\"].loadAnimation({\n      container: document.querySelector(\".profile__success-animation\"),\n      path: \"/static/animations/animation_1722611146876.json\",\n      renderer: \"svg\",\n      loop: false,\n      autoplay: false,\n    });\n\n    const changePage = (newPageIndex) => {\n      let pages = this.querySelectorAll(\".profile__page\");\n      pages.forEach((page, pageIndex) => {\n        if (pageIndex === newPageIndex) {\n          page.classList.remove(\"profile--hidden\");\n          /** @type {HTMLInputElement | null} */\n          const firstInteractiveElement = page.querySelector(\n            `input[type=\"text\"], input[checked], textarea, .profile__button-finish`\n          );\n          firstInteractiveElement?.focus();\n        } else {\n          page.classList.add(\"profile--hidden\");\n        }\n      });\n      // play animation if it's the final page\n      if (newPageIndex === pages.length - 1) {\n        console.log(\"Time to deal with animation\");\n        const userPrefersReducedMotion = window.matchMedia(\n          \"(prefers-reduced-motion: reduce)\"\n        ).matches;\n        if (userPrefersReducedMotion) {\n          animation.goToAndStop(animation.totalFrames - 1, true);\n        } else {\n          animation.play();\n        }\n      }\n    };\n    changePage(this.currentPage);\n\n    let nextButtons = this.querySelectorAll(`button[data-action=\"next\"]`);\n    nextButtons.forEach((nextButton) => {\n      nextButton.addEventListener(\"click\", () => {\n        let checksPassed = true;\n        /** @type {NodeListOf<HTMLInputElement> | undefined} */\n        let inputs = nextButton\n          .closest(\".profile-page\")\n          ?.querySelectorAll(\"input, textarea\");\n        inputs?.forEach((input) => {\n          if (!input.checkValidity()) {\n            input.reportValidity();\n            checksPassed = false;\n          }\n        });\n        if (checksPassed) {\n          this.currentPage++;\n          changePage(this.currentPage);\n        }\n      });\n    });\n\n    let previousButtons = this.querySelectorAll(\n      `button[data-action=\"previous\"]`\n    );\n    previousButtons.forEach((previousButton) => {\n      previousButton.addEventListener(\"click\", () => {\n        this.currentPage--;\n        changePage(this.currentPage);\n      });\n    });\n\n    let skipButtons = this.querySelectorAll(`button[data-action=\"skip\"]`);\n    skipButtons.forEach((skipButton) => {\n      skipButton.addEventListener(\"click\", () => {\n        this.currentPage++;\n        changePage(this.currentPage);\n      });\n    });\n\n    // Send data on dialog close\n    dialog.addEventListener(\"close\", () => {\n      this.currentPage = 0;\n\n      /**\n       * Sends data to endpoint, retrying if necessary\n       * @param {FormData} data\n       * @param {number} retry\n       */\n      const sendData = async (data, retry = 0) => {\n        const MAX_RETRIES = 10;\n        const RETRY_INTERVAL_SECONDS = 10;\n        const csrfToken =\n          /** @type {HTMLInputElement | null} */ (\n            this.querySelector('[name=\"csrfmiddlewaretoken\"]')\n          )?.value || \"\";\n        try {\n          await fetch(`/update-demographics`, {\n            method: \"POST\",\n            headers: {\n              \"X-CSRFToken\": csrfToken,\n            },\n            body: data,\n          });\n        } catch (err) {\n          if (retry < MAX_RETRIES) {\n            window.setTimeout(() => {\n              sendData(data, retry + 1);\n            }, RETRY_INTERVAL_SECONDS * 1000);\n          }\n        }\n      };\n\n      // Format and send data\n      const formData = new FormData(this.querySelector(\"form\") || undefined);\n      sendData(formData);\n    });\n\n    let closeButtons = this.querySelectorAll(`button[data-action=\"close\"]`);\n    closeButtons.forEach((closeButton) => {\n      closeButton.addEventListener(\"click\", () => {\n        this.querySelector(\"dialog\")?.close();\n      });\n    });\n  }\n}\ncustomElements.define(\"profile-overlay\", ProfileOverlay);\n","// @ts-check\n\nclass ExitFeedback extends HTMLElement {\n  constructor() {\n    super();\n    this.formData = new FormData();\n  }\n  connectedCallback() {\n    /**\n     * @param {\"up\" | \"down\"} direction\n     * @returns\n     */\n    const thumbIcon = (direction) => {\n      const id = crypto.randomUUID();\n      return `\n        <svg class=\"exit-feedback__thumb-icon exit-feedback__thumb-icon--${direction}\" width=\"24\" height=\"26\" viewBox=\"0 0 24 26\" fill=\"none\" aria-hidden=\"true\" focusable=\"false\">\n          <path class=\"exit-feedback__thumb-icon-fill\" d=\"M9 22L6.5 22H6V24.5H1L1 10L6 10V12.5H8L11 8.5L13.5 6L15 3.5L15.5 1H17L18 3.5L17.5 6L16 8.5L16.5 9L22.5 9L24 11.5L23 13.5L23.5 15L22.5 17L23 19L21.5 20.5L22 22L20.5 23L11.5 23L9 22Z\" fill=\"none\"/>\n          <mask id=\"${id}\" fill=\"white\">\n            <path d=\"M23.8519 10.4389C23.7381 9.90599 23.4504 9.42597 23.0341 9.07434C22.6178 8.7227 22.0964 8.5194 21.5519 8.4964C21.5519 8.4964 16.8606 8.4964 16.5757 8.47859C17.4904 7.4348 18.012 6.10437 18.0504 4.717C18.0504 2.11191 17.5517 0.612267 16.5258 0.13257C16.1683 -0.000888383 15.7812 -0.0343755 15.4061 0.0357093C15.031 0.105794 14.682 0.2768 14.3969 0.530339L14.1843 0.708444V0.983914C14.0949 2.46652 13.6139 3.89889 12.7903 5.13496C12.0292 6.37375 11.0232 7.44407 9.83379 8.2803L7.07672 12.0407H5.93685V9.66596H0V25.1018H5.93685V22.727H8.06936L11.0022 23.874L19.2235 23.9144C19.7173 23.9345 20.2069 23.8153 20.6362 23.5705C21.0656 23.3257 21.4174 22.9651 21.6517 22.5299C21.7817 22.2688 21.8554 21.9832 21.8681 21.6917C21.8808 21.4003 21.8321 21.1094 21.7253 20.8379C22.0321 20.6709 22.3014 20.4426 22.5165 20.1673C22.7315 19.892 22.8878 19.5755 22.9756 19.2373C23.0648 18.895 23.0833 18.538 23.0298 18.1883C22.9763 17.8385 22.852 17.5034 22.6645 17.2034C22.9524 17.0006 23.1973 16.7429 23.3854 16.4453C23.5735 16.1476 23.7009 15.8157 23.7604 15.4686C23.8136 15.1192 23.7941 14.7625 23.7032 14.4209C23.6123 14.0793 23.4519 13.7602 23.2321 13.4833C23.5847 13.0699 23.8266 12.5737 23.9352 12.0412C24.0438 11.5088 24.0155 10.9575 23.8531 10.4389H23.8519ZM4.74948 23.9144H1.18737V10.8533H4.74948V23.9144ZM22.0506 12.93L21.3596 13.361L21.983 13.8871C22.198 14.0454 22.3672 14.2579 22.4732 14.5031C22.5792 14.7482 22.6181 15.0171 22.5861 15.2822C22.5297 15.5576 22.4022 15.8134 22.2164 16.0244C22.0307 16.2354 21.793 16.3942 21.527 16.485L20.64 16.8472L21.3572 17.48C21.565 17.6538 21.7193 17.8829 21.8023 18.1407C21.8853 18.3985 21.8936 18.6746 21.8262 18.9369C21.7602 19.1899 21.6239 19.4191 21.4331 19.5979C21.2423 19.7767 21.0048 19.8978 20.7481 19.9474L19.8279 20.1457L20.4038 20.8913C20.5406 21.0385 20.6309 21.2229 20.6633 21.4213C20.6956 21.6197 20.6685 21.8232 20.5854 22.0063C20.446 22.2398 20.2452 22.4304 20.0048 22.5575C19.7644 22.6846 19.4937 22.7433 19.2223 22.727H11.3311L8.39589 21.58L5.93685 21.548V13.2281H7.68584L10.5925 9.19695C11.8704 8.2855 12.9534 7.12816 13.7782 5.79276C14.6684 4.45432 15.2103 2.91488 15.3551 1.314C15.4511 1.24726 15.5611 1.20309 15.6766 1.18479C15.7922 1.16649 15.9104 1.17454 16.0224 1.20833C16.2195 1.30094 16.863 1.82576 16.863 4.717C16.8114 5.87441 16.3478 6.97525 15.5557 7.82079C15.3986 7.98506 15.2894 8.18911 15.2398 8.41092C15.1902 8.63273 15.2022 8.86387 15.2743 9.0794C15.5712 9.66596 16.3073 9.66596 17.5256 9.66596H21.5519C22.1741 9.66596 22.5576 10.2359 22.7108 10.7678C22.8439 11.1517 22.8516 11.5679 22.733 11.9565C22.6143 12.3451 22.3754 12.6859 22.0506 12.93Z\"/>\n          </mask>\n          <path d=\"M23.8519 10.4389L21.8959 10.8565L22.2338 12.4389H23.8519V10.4389ZM21.5519 8.4964L21.6364 6.49818L21.5942 6.4964L21.5519 6.4964L21.5519 8.4964ZM16.5757 8.47859L15.0716 7.1604L12.3894 10.2208L16.4509 10.4747L16.5757 8.47859ZM18.0504 4.717L20.0496 4.77229L20.0504 4.74465V4.717L18.0504 4.717ZM16.5258 0.13257L17.373 -1.67915L17.3004 -1.7131L17.2253 -1.74113L16.5258 0.13257ZM14.3969 0.530339L15.6814 2.06326L15.7038 2.0445L15.7257 2.02508L14.3969 0.530339ZM14.1843 0.708444L12.8997 -0.824482L12.1843 -0.224965V0.708444H14.1843ZM14.1843 0.983914L16.1807 1.10431L16.1843 1.04416V0.983914H14.1843ZM12.7903 5.13496L11.1259 4.02601L11.1055 4.05664L11.0863 4.08799L12.7903 5.13496ZM9.83379 8.2803L8.68348 6.64421L8.41496 6.833L8.22087 7.09772L9.83379 8.2803ZM7.07672 12.0407V14.0407H8.09032L8.68964 13.2233L7.07672 12.0407ZM5.93685 12.0407H3.93685V14.0407H5.93685V12.0407ZM5.93685 9.66596H7.93685V7.66596H5.93685V9.66596ZM0 9.66596V7.66596H-2V9.66596H0ZM0 25.1018H-2V27.1018H0V25.1018ZM5.93685 25.1018V27.1018H7.93685V25.1018H5.93685ZM5.93685 22.727V20.727H3.93685V22.727H5.93685ZM8.06936 22.727L8.79782 20.8644L8.44654 20.727H8.06936V22.727ZM11.0022 23.874L10.2737 25.7366L10.6202 25.8722L10.9923 25.874L11.0022 23.874ZM19.2235 23.9144L19.3047 21.916L19.2691 21.9146L19.2333 21.9144L19.2235 23.9144ZM21.6517 22.5299L23.4128 23.4778L23.4279 23.4498L23.442 23.4213L21.6517 22.5299ZM21.7253 20.8379L20.769 19.0813L19.2171 19.9262L19.8643 21.5704L21.7253 20.8379ZM22.9756 19.2373L21.0403 18.7329L21.0398 18.7347L22.9756 19.2373ZM22.6645 17.2034L21.5126 15.5684L19.9655 16.6584L20.9684 18.2633L22.6645 17.2034ZM23.7604 15.4686L25.7317 15.8067L25.7349 15.7881L25.7377 15.7694L23.7604 15.4686ZM23.2321 13.4833L21.7103 12.1856L20.6422 13.4381L21.6659 14.7272L23.2321 13.4833ZM23.8531 10.4389L25.7616 9.84091L25.3223 8.43893H23.8531V10.4389ZM4.74948 23.9144V25.9144H6.74948V23.9144H4.74948ZM1.18737 23.9144H-0.812631V25.9144H1.18737V23.9144ZM1.18737 10.8533V8.85333H-0.812631V10.8533H1.18737ZM4.74948 10.8533H6.74948V8.85333H4.74948V10.8533ZM22.0506 12.93L23.1091 14.627L23.1828 14.581L23.2522 14.5288L22.0506 12.93ZM21.3596 13.361L20.3012 11.6641L17.9702 13.1179L20.0698 14.8896L21.3596 13.361ZM21.983 13.8871L20.6932 15.4156L20.7439 15.4584L20.7974 15.4978L21.983 13.8871ZM22.5861 15.2822L24.5454 15.684L24.5619 15.6035L24.5717 15.5219L22.5861 15.2822ZM21.527 16.485L20.8805 14.5924L20.8252 14.6113L20.771 14.6334L21.527 16.485ZM20.64 16.8472L19.884 14.9956L16.8998 16.214L19.3167 18.3468L20.64 16.8472ZM21.3572 17.48L20.0339 18.9796L20.0537 18.9971L20.074 19.0141L21.3572 17.48ZM21.8262 18.9369L23.7613 19.4423L23.7634 19.4343L21.8262 18.9369ZM20.7481 19.9474L20.3691 17.9836L20.3479 17.9877L20.3268 17.9923L20.7481 19.9474ZM19.8279 20.1457L19.4066 18.1906L16.3068 18.8585L18.245 21.3681L19.8279 20.1457ZM20.4038 20.8913L18.8208 22.1138L18.8769 22.1863L18.9393 22.2534L20.4038 20.8913ZM20.5854 22.0063L22.3027 23.0315L22.3602 22.9352L22.4066 22.833L20.5854 22.0063ZM19.2223 22.727L19.3419 20.7306L19.2822 20.727H19.2223V22.727ZM11.3311 22.727L10.6031 24.5898L10.9542 24.727H11.3311V22.727ZM8.39589 21.58L9.12383 19.7172L8.78534 19.5849L8.42196 19.5802L8.39589 21.58ZM5.93685 21.548H3.93685V23.5221L5.91077 23.5478L5.93685 21.548ZM5.93685 13.2281V11.2281H3.93685V13.2281H5.93685ZM7.68584 13.2281V15.2281H8.70943L9.30809 14.3978L7.68584 13.2281ZM10.5925 9.19695L9.43114 7.56869L9.16294 7.75999L8.97027 8.0272L10.5925 9.19695ZM13.7782 5.79276L12.1129 4.68523L12.0943 4.7132L12.0766 4.74178L13.7782 5.79276ZM15.3551 1.314L14.2141 -0.32859L13.4472 0.204067L13.3632 1.13394L15.3551 1.314ZM16.0224 1.20833L16.8729 -0.601805L16.7403 -0.664117L16.6 -0.706437L16.0224 1.20833ZM16.863 4.717L18.861 4.80605L18.863 4.76155V4.717H16.863ZM15.5557 7.82079L17.0013 9.20297L17.0083 9.19556L17.0154 9.18807L15.5557 7.82079ZM15.2743 9.0794L13.3778 9.71434L13.424 9.85249L13.4898 9.98248L15.2743 9.0794ZM22.7108 10.7678L20.7889 11.3212L20.8036 11.3724L20.8211 11.4228L22.7108 10.7678ZM25.8078 10.0214C25.6015 9.05479 25.0797 8.18416 24.3246 7.5464L21.7436 10.6023C21.8212 10.6678 21.8747 10.7572 21.8959 10.8565L25.8078 10.0214ZM24.3246 7.5464C23.5695 6.90863 22.6239 6.53991 21.6364 6.49818L21.4675 10.4946C21.5689 10.4989 21.6661 10.5368 21.7436 10.6023L24.3246 7.5464ZM21.5519 8.4964C21.5519 6.4964 21.5519 6.4964 21.5519 6.4964C21.5519 6.4964 21.5518 6.4964 21.5517 6.4964C21.5516 6.4964 21.5514 6.4964 21.5511 6.4964C21.5506 6.4964 21.5497 6.4964 21.5486 6.4964C21.5464 6.4964 21.543 6.4964 21.5386 6.4964C21.5297 6.4964 21.5166 6.4964 21.4994 6.49639C21.4651 6.49639 21.4147 6.49638 21.3503 6.49636C21.2217 6.49633 21.0376 6.49626 20.8157 6.49612C20.3719 6.49584 19.7775 6.49529 19.1744 6.49418C18.5708 6.49306 17.9603 6.4914 17.4839 6.48891C16.9568 6.48616 16.6971 6.48227 16.7004 6.48248L16.4509 10.4747C16.6735 10.4886 18.0218 10.4921 19.167 10.4942C19.7723 10.4953 20.3685 10.4958 20.8132 10.4961C21.0356 10.4963 21.2202 10.4963 21.3493 10.4964C21.4138 10.4964 21.4644 10.4964 21.4989 10.4964C21.5162 10.4964 21.5294 10.4964 21.5383 10.4964C21.5428 10.4964 21.5462 10.4964 21.5485 10.4964C21.5496 10.4964 21.5505 10.4964 21.5511 10.4964C21.5513 10.4964 21.5516 10.4964 21.5517 10.4964C21.5518 10.4964 21.5518 10.4964 21.5519 10.4964C21.5519 10.4964 21.5519 10.4964 21.5519 8.4964ZM18.0798 9.79678C19.3017 8.40256 19.9984 6.62545 20.0496 4.77229L16.0511 4.66172C16.0257 5.5833 15.6792 6.46705 15.0716 7.1604L18.0798 9.79678ZM20.0504 4.717C20.0504 3.31825 19.9205 2.04875 19.5706 0.996643C19.2162 -0.0690195 18.5575 -1.12528 17.373 -1.67915L15.6787 1.94429C15.52 1.87011 15.6236 1.80353 15.775 2.25889C15.9309 2.7278 16.0504 3.51066 16.0504 4.717H20.0504ZM17.2253 -1.74113C16.5272 -2.00174 15.7712 -2.06713 15.0388 -1.93027L15.7734 2.00169C15.7911 1.99837 15.8094 1.99996 15.8263 2.00627L17.2253 -1.74113ZM15.0388 -1.93027C14.3063 -1.79342 13.6249 -1.45949 13.068 -0.964401L15.7257 2.02508C15.7392 2.01309 15.7557 2.005 15.7734 2.00169L15.0388 -1.93027ZM13.1123 -1.00259L12.8997 -0.824482L15.4689 2.24137L15.6814 2.06326L13.1123 -1.00259ZM12.1843 0.708444V0.983914H16.1843V0.708444H12.1843ZM12.1879 0.86352C12.1198 1.99305 11.7534 3.08431 11.1259 4.02601L14.4547 6.2439C15.4744 4.71347 16.07 2.93998 16.1807 1.10431L12.1879 0.86352ZM11.0863 4.08799C10.4677 5.09476 9.65009 5.9646 8.68348 6.64421L10.9841 9.91639C12.3962 8.92353 13.5908 7.65274 14.4944 6.18192L11.0863 4.08799ZM8.22087 7.09772L5.4638 10.8581L8.68964 13.2233L11.4467 9.46287L8.22087 7.09772ZM7.07672 10.0407H5.93685V14.0407H7.07672V10.0407ZM7.93685 12.0407V9.66596H3.93685V12.0407H7.93685ZM5.93685 7.66596H0V11.666H5.93685V7.66596ZM-2 9.66596V25.1018H2V9.66596H-2ZM0 27.1018H5.93685V23.1018H0V27.1018ZM7.93685 25.1018V22.727H3.93685V25.1018H7.93685ZM5.93685 24.727H8.06936V20.727H5.93685V24.727ZM7.3409 24.5896L10.2737 25.7366L11.7306 22.0114L8.79782 20.8644L7.3409 24.5896ZM10.9923 25.874L19.2137 25.9144L19.2333 21.9144L11.012 21.874L10.9923 25.874ZM19.1423 25.9127C20.0108 25.948 20.8717 25.7385 21.6268 25.3079L19.6456 21.8331C19.542 21.8921 19.4239 21.9209 19.3047 21.916L19.1423 25.9127ZM21.6268 25.3079C22.3819 24.8774 23.0008 24.2432 23.4128 23.4778L19.8906 21.582C19.8341 21.687 19.7492 21.774 19.6456 21.8331L21.6268 25.3079ZM23.442 23.4213C23.6969 22.9095 23.8414 22.3499 23.8662 21.7787L19.87 21.6048C19.8695 21.6165 19.8665 21.628 19.8613 21.6385L23.442 23.4213ZM23.8662 21.7787C23.8911 21.2075 23.7957 20.6374 23.5863 20.1054L19.8643 21.5704C19.8686 21.5814 19.8705 21.5931 19.87 21.6048L23.8662 21.7787ZM22.6816 22.5945C23.2288 22.2966 23.709 21.8895 24.0926 21.3985L20.9403 18.9361C20.8938 18.9957 20.8355 19.0452 20.769 19.0813L22.6816 22.5945ZM24.0926 21.3985C24.4761 20.9075 24.7548 20.343 24.9114 19.74L21.0398 18.7347C21.0208 18.8079 20.9869 18.8765 20.9403 18.9361L24.0926 21.3985ZM24.9109 19.7418C25.0688 19.1361 25.1014 18.5046 25.0068 17.8859L21.0528 18.4907C21.0651 18.5714 21.0609 18.6538 21.0403 18.7329L24.9109 19.7418ZM25.0068 17.8859C24.9122 17.2672 24.6923 16.6743 24.3606 16.1435L20.9684 18.2633C21.0117 18.3325 21.0404 18.4099 21.0528 18.4907L25.0068 17.8859ZM23.8164 18.8384C24.3194 18.484 24.7476 18.0337 25.0763 17.5135L21.6946 15.3771C21.6471 15.4522 21.5853 15.5172 21.5126 15.5684L23.8164 18.8384ZM25.0763 17.5135C25.4049 16.9932 25.6277 16.4132 25.7317 15.8067L21.7892 15.1306C21.7742 15.2182 21.742 15.3019 21.6946 15.3771L25.0763 17.5135ZM25.7377 15.7694C25.8322 15.148 25.7976 14.5139 25.6359 13.9065L21.7705 14.9353C21.7907 15.0111 21.795 15.0903 21.7832 15.1679L25.7377 15.7694ZM25.6359 13.9065C25.4743 13.2992 25.1891 12.7317 24.7982 12.2395L21.6659 14.7272C21.7147 14.7886 21.7503 14.8595 21.7705 14.9353L25.6359 13.9065ZM24.7539 14.7811C25.326 14.1101 25.7186 13.305 25.8948 12.441L21.9756 11.6415C21.9346 11.8424 21.8433 12.0296 21.7103 12.1856L24.7539 14.7811ZM25.8948 12.441C26.0711 11.577 26.0252 10.6824 25.7616 9.84091L21.9446 11.037C22.0059 11.2326 22.0165 11.4406 21.9756 11.6415L25.8948 12.441ZM23.8531 8.43893H23.8519V12.4389H23.8531V8.43893ZM4.74948 21.9144H1.18737V25.9144H4.74948V21.9144ZM3.18737 23.9144V10.8533H-0.812631V23.9144H3.18737ZM1.18737 12.8533H4.74948V8.85333H1.18737V12.8533ZM2.74948 10.8533V23.9144H6.74948V10.8533H2.74948ZM20.9922 11.2331L20.3012 11.6641L22.418 15.058L23.1091 14.627L20.9922 11.2331ZM20.0698 14.8896L20.6932 15.4156L23.2727 12.3585L22.6494 11.8325L20.0698 14.8896ZM20.7974 15.4978C20.7272 15.4461 20.672 15.3767 20.6374 15.2968L24.309 13.7094C24.0624 13.1392 23.6689 12.6446 23.1685 12.2763L20.7974 15.4978ZM20.6374 15.2968C20.6028 15.2168 20.5901 15.129 20.6005 15.0425L24.5717 15.5219C24.6462 14.9051 24.5555 14.2796 24.309 13.7094L20.6374 15.2968ZM20.6269 14.8804C20.6404 14.8145 20.671 14.7532 20.7154 14.7027L23.7175 17.3461C24.1335 16.8737 24.4189 16.3007 24.5454 15.684L20.6269 14.8804ZM20.7154 14.7027C20.7599 14.6522 20.8168 14.6141 20.8805 14.5924L22.1735 18.3776C22.7692 18.1742 23.3014 17.8186 23.7175 17.3461L20.7154 14.7027ZM20.771 14.6334L19.884 14.9956L21.396 18.6988L22.283 18.3366L20.771 14.6334ZM19.3167 18.3468L20.0339 18.9796L22.6805 15.9804L21.9634 15.3476L19.3167 18.3468ZM20.074 19.0141C19.9921 18.9456 19.9312 18.8553 19.8985 18.7536L23.7061 17.5278C23.5073 16.9105 23.1379 16.362 22.6404 15.9459L20.074 19.0141ZM19.8985 18.7536C19.8658 18.6519 19.8625 18.543 19.8891 18.4396L23.7634 19.4343C23.9247 18.8062 23.9048 18.1452 23.7061 17.5278L19.8985 18.7536ZM19.8911 18.4316C19.9204 18.3194 19.9808 18.2179 20.0654 18.1386L22.8007 21.0571C23.2669 20.6203 23.5999 20.0604 23.7613 19.4423L19.8911 18.4316ZM20.0654 18.1386C20.15 18.0593 20.2553 18.0056 20.3691 17.9836L21.1271 21.9112C21.7544 21.7901 22.3346 21.494 22.8007 21.0571L20.0654 18.1386ZM20.3268 17.9923L19.4066 18.1906L20.2492 22.1008L21.1694 21.9025L20.3268 17.9923ZM18.245 21.3681L18.8208 22.1138L21.9867 19.6689L21.4108 18.9232L18.245 21.3681ZM18.9393 22.2534C18.8074 22.1117 18.7204 21.9341 18.6893 21.743L22.6372 21.0997C22.5414 20.5118 22.2739 19.9654 21.8682 19.5293L18.9393 22.2534ZM18.6893 21.743C18.6582 21.5519 18.6843 21.3558 18.7643 21.1796L22.4066 22.833C22.6528 22.2907 22.733 21.6876 22.6372 21.0997L18.6893 21.743ZM18.8682 20.9811C18.9166 20.8999 18.9864 20.8337 19.07 20.7895L20.9397 24.3256C21.504 24.0272 21.9754 23.5796 22.3027 23.0315L18.8682 20.9811ZM19.07 20.7895C19.1535 20.7453 19.2476 20.7249 19.3419 20.7306L19.1028 24.7234C19.7399 24.7616 20.3754 24.624 20.9397 24.3256L19.07 20.7895ZM19.2223 20.727H11.3311V24.727H19.2223V20.727ZM12.059 20.8642L9.12383 19.7172L7.66794 23.4428L10.6031 24.5898L12.059 20.8642ZM8.42196 19.5802L5.96292 19.5481L5.91077 23.5478L8.36981 23.5798L8.42196 19.5802ZM7.93685 21.548V13.2281H3.93685V21.548H7.93685ZM5.93685 15.2281H7.68584V11.2281H5.93685V15.2281ZM9.30809 14.3978L12.2148 10.3667L8.97027 8.0272L6.06359 12.0583L9.30809 14.3978ZM11.7539 10.8252C13.2484 9.75919 14.5152 8.4056 15.4798 6.84374L12.0766 4.74178C11.3917 5.85073 10.4923 6.81181 9.43114 7.56869L11.7539 10.8252ZM15.4436 6.90029C16.518 5.28468 17.1723 3.42645 17.3469 1.49407L13.3632 1.13394C13.2484 2.4033 12.8187 3.62395 12.1129 4.68523L15.4436 6.90029ZM16.4961 2.95659C16.3447 3.06175 16.1715 3.13134 15.9894 3.16017L15.3638 -0.790593C14.9506 -0.725165 14.5576 -0.567232 14.2141 -0.32859L16.4961 2.95659ZM15.9894 3.16017C15.8074 3.189 15.6212 3.17633 15.4447 3.12309L16.6 -0.706437C16.1995 -0.827253 15.7769 -0.856022 15.3638 -0.790593L15.9894 3.16017ZM15.1718 3.01846C14.6598 2.77785 14.577 2.43352 14.6396 2.60385C14.7117 2.79961 14.863 3.39157 14.863 4.717H18.863C18.863 3.15119 18.6926 2.03512 18.3936 1.22251C18.0852 0.384468 17.5821 -0.268581 16.8729 -0.601805L15.1718 3.01846ZM14.865 4.62795C14.8347 5.3087 14.5619 5.95618 14.0961 6.4535L17.0154 9.18807C18.1336 7.99432 18.7882 6.44012 18.861 4.80605L14.865 4.62795ZM14.1102 6.4386C13.7014 6.86615 13.4171 7.39723 13.288 7.97452L17.1916 8.84731C17.1617 8.98099 17.0959 9.10397 17.0013 9.20297L14.1102 6.4386ZM13.288 7.97452C13.1589 8.55182 13.19 9.1534 13.3778 9.71434L17.1709 8.44445C17.2143 8.57434 17.2215 8.71364 17.1916 8.84731L13.288 7.97452ZM13.4898 9.98248C14.017 11.0242 14.9494 11.4139 15.6691 11.5552C16.278 11.6747 16.9954 11.666 17.5256 11.666V7.66596C17.2107 7.66596 16.9765 7.66568 16.7764 7.65819C16.5744 7.65063 16.4776 7.63755 16.4397 7.63011C16.4037 7.62302 16.5047 7.63646 16.6527 7.73052C16.7303 7.77983 16.8118 7.84565 16.8877 7.92932C16.9635 8.01292 17.0195 8.09864 17.0588 8.17631L13.4898 9.98248ZM17.5256 11.666H21.5519V7.66596H17.5256V11.666ZM21.5519 11.666C21.3911 11.666 21.2313 11.6267 21.093 11.5588C20.9619 11.4945 20.8797 11.4195 20.8373 11.3736C20.7669 11.2973 20.7743 11.2705 20.7889 11.3212L24.6327 10.2144C24.4942 9.73325 24.2332 9.15553 23.7772 8.66125C23.2955 8.13909 22.5412 7.66596 21.5519 7.66596V11.666ZM20.8211 11.4228C20.8154 11.4065 20.8151 11.3889 20.8201 11.3724L24.6458 12.5405C24.8881 11.7469 24.8723 10.8969 24.6005 10.1129L20.8211 11.4228ZM20.8201 11.3724C20.8252 11.356 20.8353 11.3416 20.849 11.3312L23.2522 14.5288C23.9155 14.0303 24.4035 13.3341 24.6458 12.5405L20.8201 11.3724Z\" fill=\"currentColor\" mask=\"url(#${id}\"/>\n        </svg>\n      `;\n    };\n\n    this.innerHTML = `\n      <form class=\"exit-feedback__panel\" id=\"exit-feedback__panel\">\n        <div class=\"exit-feedback__page\">\n          <div class=\"exit-feedback__question-container\">\n            <p tabindex=\"-1\">Did Redbox do what you needed it to in this chat?</p>\n            <button type=\"button\" class=\"exit-feedback__button exit-feedback__button--yes\">\n              ${thumbIcon(\"up\")}\n              <span class=\"govuk-visually-hidden\">Yes, Redbox did what I needed it to in this chat</span>\n            </button>\n            <button type=\"button\" class=\"exit-feedback__button exit-feedback__button--no\">\n              ${thumbIcon(\"down\")}\n              <span class=\"govuk-visually-hidden\">Redbox didn't do what I needed it to in this chat</span>\n            </button>\n          </div>\n        </div>\n        <div class=\"exit-feedback__page\">\n          <fieldset class=\"exit-feedback__question-container exit-feedback__question-container--small\">\n            <div>\n              <legend>Did Redbox help save you time?</legend>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-time-yes\" name=\"saved_time\" value=\"Yes\"/>\n              <label for=\"exit-feedback__input-time-yes\">\n                ${thumbIcon(\"up\")}\n                <span class=\"govuk-visually-hidden\">Yes</span>\n              </label>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-time-no\" name=\"saved_time\" value=\"No\"/>\n              <label for=\"exit-feedback__input-time-no\">\n                ${thumbIcon(\"down\")}\n                <span class=\"govuk-visually-hidden\">No</span>\n              </label>\n            </div>\n          </fieldset>\n          <fieldset class=\"exit-feedback__question-container exit-feedback__question-container--small\">\n            <div>\n              <legend>Did Redbox help to improve your work?</legend>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-improve-work-yes\" name=\"improved_work\" value=\"Yes\"/>\n              <label for=\"exit-feedback__input-improve-work-yes\">\n                ${thumbIcon(\"up\")}\n                <span class=\"govuk-visually-hidden\">Yes</span>\n              </label>\n            </div>\n            <div class=\"exit-feedback__radio-container\">\n              <input type=\"radio\" id=\"exit-feedback__input-improve-work-no\" name=\"improved_work\" value=\"No\"/>\n              <label for=\"exit-feedback__input-improve-work-no\">\n                ${thumbIcon(\"down\")}\n                <span class=\"govuk-visually-hidden\">No</span>\n              </label>\n            </div>\n          </fieldset>\n          <label class=\"govuk-!-display-block govuk-!-margin-bottom-1 govuk-!-margin-top-2\" for=\"exit-feedback__input-notes\">Do you want to tell us anything more?</label>\n          <textarea class=\"exit-feedback__input-notes govuk-textarea govuk-!-margin-bottom-3\" id=\"exit-feedback__input-notes\" name=\"notes\" rows=\"1\"></textarea>\n          <button type=\"button\" class=\"exit-feedback__send-button govuk-button\">Send</button>\n        </div>\n        <div class=\"exit-feedback__page\">\n          <div class=\"exit-feedback__confirmation-container\">\n            <div class=\"exit-feedback__tick-animation\" aria-hidden=\"true\">\n              <div></div>\n            </div>\n            <div>\n              <p class=\"exit-feedback__confirmation-text govuk-body-s\" tabindex=\"-1\">Thanks for helping to improve Redbox</p>\n              <button type=\"button\" class=\"exit-feedback__dismiss\">Dismiss</button>\n            </div>\n          </div>\n        </div>\n      </form>\n      <button type=\"button\" class=\"exit-feedback__toggle-button\" aria-expanded=\"false\" aria-controls=\"exit-feedback__panel\">\n        <svg class=\"exit-feedback__toggle-button-icon\" aria-hidden=\"true\" focusable=\"false\" width=\"37\" height=\"37\" viewBox=\"0 0 37 37\" fill=\"none\">\n          <path d=\"M9 17L27 12V24L9 20V17Z\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n          <path d=\"M17.5997 22.8C17.4947 23.1808 17.3156 23.5373 17.0728 23.8489C16.83 24.1605 16.5282 24.4213 16.1847 24.6163C15.8411 24.8113 15.4625 24.9367 15.0704 24.9854C14.6784 25.0341 14.2806 25.0051 13.8997 24.9C13.5189 24.795 13.1625 24.6159 12.8508 24.3731C12.5392 24.1303 12.2784 23.8285 12.0834 23.4849C11.8884 23.1414 11.763 22.7627 11.7143 22.3707C11.6657 21.9786 11.6947 21.5808 11.7997 21.2\" stroke=\"black\" stroke-linecap=\"round\" stroke-linejoin=\"round\"></path>\n        </svg>\n        <span class=\"exit-feedback__toggle-button-text\">Feedback</span>\n      </button>\n    `;\n\n    this.animation = window[\"lottie\"].loadAnimation({\n      container: document.querySelector(\".exit-feedback__tick-animation > div\"),\n      path: \"/static/animations/success_tick_red.json\",\n      renderer: \"svg\",\n      loop: false,\n      autoplay: false,\n    });\n\n    const toggleButton = this.querySelector(\".exit-feedback__toggle-button\");\n    toggleButton?.addEventListener(\"click\", () => {\n      if (toggleButton.getAttribute(\"aria-expanded\") === \"true\") {\n        toggleButton.setAttribute(\"aria-expanded\", \"false\");\n      } else {\n        toggleButton.setAttribute(\"aria-expanded\", \"true\");\n        this.#changePage(0);\n      }\n    });\n\n    this.querySelector(\".exit-feedback__dismiss\")?.addEventListener(\n      \"click\",\n      () => {\n        toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n      }\n    );\n    // close menu if focus moves out of it\n    let lastInteractionWasKeyboard = false;\n    document.addEventListener(\"keydown\", () => {\n      lastInteractionWasKeyboard = true;\n    });\n    document.addEventListener(\"mousedown\", () => {\n      lastInteractionWasKeyboard = false;\n    });\n    this.addEventListener(\"focusout\", () => {\n      window.setTimeout(() => {\n        if (\n          !this.contains(document.activeElement) &&\n          lastInteractionWasKeyboard\n        ) {\n          toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n        }\n      }, 100);\n    });\n    // close menu if user clicks away from it\n    document.body.addEventListener(\"click\", (evt) => {\n      const targetElement = /** @type {HTMLElement | null} */ (evt.target);\n      if (!targetElement?.closest(\".exit-feedback\")) {\n        toggleButton?.setAttribute(\"aria-expanded\", \"false\");\n      }\n    });\n\n    // page 1\n    this.#changePage(0);\n    this.querySelector(\".exit-feedback__button--yes\")?.addEventListener(\n      \"click\",\n      () => {\n        this.formData.set(\"achieved\", \"Yes\");\n        this.#changePage(1);\n        this.#sendFeedback();\n      }\n    );\n    this.querySelector(\".exit-feedback__button--no\")?.addEventListener(\n      \"click\",\n      () => {\n        this.formData.set(\"achieved\", \"No\");\n        this.#changePage(1);\n        this.#sendFeedback();\n      }\n    );\n\n    // page 2\n    this.querySelector(\".exit-feedback__send-button\")?.addEventListener(\n      \"click\",\n      () => {\n        const form = this.querySelector(\"form\");\n        if (!form) {\n          return;\n        }\n        for (let [key, value] of new FormData(form).entries()) {\n          this.formData.set(key, value);\n        }\n        this.#changePage(2);\n        this.#sendFeedback();\n      }\n    );\n  }\n\n  /**\n   * @param {number} newPage zero-based\n   */\n  #changePage(newPage) {\n    /** @type {NodeListOf<HTMLElement>} */\n    let pages = this.querySelectorAll(\".exit-feedback__page\");\n    pages.forEach((page, pageIndex) => {\n      if (pageIndex === newPage) {\n        page.style.display = \"block\";\n        window.setTimeout(() => {\n          /** @type {HTMLElement | null} */\n          const firstInteractiveElement = page.querySelector(\n            '[tabindex=\"-1\"], input, button'\n          );\n          firstInteractiveElement?.focus();\n        }, 100);\n      } else {\n        page.style.display = \"none\";\n      }\n    });\n\n    // start animation if final page\n    if (newPage === pages.length - 1) {\n      const userPrefersReducedMotion = window.matchMedia(\n        \"(prefers-reduced-motion: reduce)\"\n      ).matches;\n      if (userPrefersReducedMotion) {\n        this.animation.goToAndStop(this.animation.totalFrames - 1, true);\n      } else {\n        this.animation.play();\n      }\n    }\n  }\n\n  async #sendFeedback() {\n    try {\n      await fetch(`/chats/${this.dataset.chatid}/update-chat-feedback`, {\n        method: \"POST\",\n        headers: {\n          \"X-CSRFToken\": this.dataset.csrf || \"\",\n        },\n        body: this.formData,\n      });\n    } catch (err) {\n      console.log(\"Error sending exit feedback data\", err);\n    }\n  }\n}\ncustomElements.define(\"exit-feedback\", ExitFeedback);\n"],"names":["$parcel$global","globalThis","$parcel$modules","$parcel$inits","parcelRequire","id","exports","init","module","call","err","Error","code","register","parcelRegister","$533de1f10e763f67$var$LoadingMessage","HTMLElement","connectedCallback","innerHTML","dataset","dataAriaLabel","message","customElements","define","$5b2c93a1b6249a89$var$showdown","window","$5b2c93a1b6249a89$export$d1a54e697d9f304d","update","markdown","converter","Converter","disableForced4SpacesIndentedSublists","headerLevelStart","tables","makeHtml","textContent","$f372dfae70b38cba$var$FileStatus","checkStatus","response","fetch","responseObj","json","status","toLowerCase","evt","CustomEvent","detail","document","body","dispatchEvent","setTimeout","$24de8e8650e1bf2a$var$ChatController","messageForm","closest","messageContainer","querySelector","insertPosition","feedbackButtons","selectedDocuments","addEventListener","plausible","preventDefault","messageInput","userText","getValue","userMessage","createElement","setAttribute","insertBefore","activites","length","name","forEach","activity","addActivity","aiMessage","llm","value","stream","map","doc","sessionId","streamUrl","focus","reset","includes","props","route","$c569433c9121ba83$var$ChatHistory","initialised","todayHeadingExists","headings","querySelectorAll","heading","newHeading","content","newHeadingText","prepend","chatId","title","newItem","cloneNode","link","chatHistoryItem","chatid","addChat","item","substring","$37ac9aa4659230fd$var$ChatHistoryItem","constructor","toggleButton","chatLink","getAttribute","deleteButton","disabled","listItem","nextElementSibling","previousElementSibling","chatTitleInput","key","evtData","sender","session_id","pageNumber","pages","page","pageIndex","style","display","csrfToken","method","headers","iscurrentchat","location","href","remove","show","chatTitleEdit","newTitle","publishChanges","JSON","stringify","chatTitleChangeEvent","$dd0dd28c27b0c621$var$sendTooltipViewEvent","targetElement","target","nodeName","removeEventListener","tooltips","tooltip","$dd0dd28c27b0c621$export$423c13fd52bec8ad","programmaticScroll","plausibleRouteDataSent","uuid","crypto","randomUUID","role","text","scrollIntoView","block","routeTemplate","routeClone","importNode","appendChild","footnotes","footnote","footnoteIndex","matchingText","responseContainer","replace","type","activityElement","classList","add","activities","endPoint","chatControllerRef","scrollOverride","sourcesContainer","feedbackContainer","responseLoading","responseComplete","webSocket","WebSocket","streamedContent","stopStreaming","close","onopen","event","send","selectedFiles","chatResponseStartEvent","onerror","onclose","stopStreamingEvent","onmessage","parse","data","console","log","file_name","url","text_in_answer","routeText","removeAttribute","showCitations","message_id","showFeedback","chatResponseEndEvent","errorContentContainer","boxInfo","getBoundingClientRect","newTopPosition","top","height","previousHeight","scrollBy","$523b4c7e9644c494$export$4ff9f55b560a7a19","titleLength","headingContainer","formContainer","editButton","input","showForm","e","hideForm","$d1cd430a26d0f01f$var$CopyText","copyToClip","html","listener","clipboardData","setData","execCommand","textEl","innerText","$18ba9063b4048b1a$var$DocumentSelector","documents","getSelectedDocuments","document1","checked","push","completedDoc","$f4d16ddf50b4860a$var$FeedbackButtons","messageId","collectedData","rating","chips","starIcon","sendFeedback","retry","RETRY_INTERVAL_SECONDS","showPanel","panelIndex","panels","panel","starButtons","starButton","buttonIndex","parseInt","btn","i","textInput","chip","scrollHeight","$3c2eec46b81f3aa7$var$MessageInput","textarea","shiftKey","trim","requestSubmit","$27a22c5ba7efffc8$var$SourcesList","sources","fileName","some","source","$4862d4424575218f$var$CannedPrompts","buttons","button","prompt","chatInput","selectionStart","$cf2b3c4cbed047e5$var$SendMessage","stopButtonHtml","buttonSend","buttonStop","showSendButton","$c05bc429e9c442d7$var$ProfileOverlay","currentPage","dialog","showModal","animation","loadAnimation","container","path","renderer","loop","autoplay","changePage","newPageIndex","firstInteractiveElement","matchMedia","matches","goToAndStop","totalFrames","play","nextButtons","nextButton","checksPassed","inputs","checkValidity","reportValidity","previousButtons","previousButton","skipButtons","skipButton","sendData","FormData","undefined","closeButtons","closeButton","$8e16970b18dc8c3b$var$ExitFeedback","formData","thumbIcon","direction","lastInteractionWasKeyboard","contains","activeElement","set","form","entries","newPage","csrf","sessionTitle","history","pushState"],"version":3,"file":"chats.js.map"}