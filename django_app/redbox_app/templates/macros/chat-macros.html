{% macro route_display(route=None) %}
  <div class="iai-chat-bubble__route" {% if not route %}hidden{% endif %}>
    <tool-tip class="iai-tooltip">
      <div class="iai-tooltip__button" tabindex="0">
        <span>Response generated using <strong>@<span class="iai-chat-bubble__route-text">{{ route }}</span></strong> route</span>
        <img src="{{ static('icons/question-mark.svg') }}" alt="" width="14"/>
      </div>
      <div class="iai-tooltip__content">
        <h3 class="iai-chat-bubble__route-heading">
          <img src="{{ static('icons/question-mark.svg') }}" alt="" width="24"/>
          <span>Redbox uses different paths to generate the best response</span>
        </h3>
        <ul class="iai-chat-bubble__route-list">
          <li class="iai-chat-bubble__route-list-item">I can help you <strong>@search</strong> over selected documents and do Q&amp;A on them</li>
          <li class="iai-chat-bubble__route-list-item">I can help you <strong>@summarise</strong> selected documents</li>
          <li class="iai-chat-bubble__route-list-item">I can help you <strong>@extract</strong> information from selected documents</li>
          <li class="iai-chat-bubble__route-list-item">I can <strong>@chat</strong> about general questions, not related to your documents</li>
        </ul>
      </div>
    </tool-tip>
  </div>
{% endmacro %}



{% macro message_box(id, role, route, text, source_files, show_route=False, classes=None) %}

    {% set role_text = role %}
    {% if role == "ai" %}
        {% set role_text = "Redbox" %}
    {% elif role == "user" %}
        {% set role_text = "You" %}
    {% endif %}

    <div class="iai-chat-bubble iai-chat-bubble--{% if role == 'user' %}right{% else %}left{% endif %} govuk-body {{ classes }}" data-role="{{ role }}" tabindex="-1">
      <div class="iai-chat-bubble__header">
        <div class="iai-chat-bubble__role">{% if role == "ai" %}Redbox{% else %}You{% endif %}</div>
        {% if route and show_route %}
          {{ route_display(route) }}
        {% endif %}
      </div>  
      
      <markdown-converter class="iai-chat-bubble__text">{{ text }}</markdown-converter>
      {% if source_files %}
          <h3 class="iai-chat-bubble__sources-heading govuk-heading-s govuk-!-margin-bottom-1">Sources</h3>
          <div class="iai-display-flex-from-desktop">
              <ul class="govuk-list govuk-list--bullet govuk-!-margin-bottom-0">
                {% for source_file in source_files %}
                  <li class="govuk-!-margin-bottom-0">
                    {% if source_file.get_status_text() == "Complete" %}
                      <a class="iai-chat-bubbles__sources-link govuk-link"
                        href="{{ source_file.url }}">{{ source_file.original_file_name }}</a>
                    {% else %}
                      <span class="iai-chat-bubbles__sources-link">{{ source_file.original_file_name }}</span>
                    {% endif %}
                  </li>
                  {% endfor %}
              </ul>
              <a class="iai-chat-bubble__citations-button govuk-!-margin-left-2" href="{{url('citations', id)}}">View information behind this answer</a>
          </div>
        <br/>
      {% endif %}
    </div>

{% endmacro %}
